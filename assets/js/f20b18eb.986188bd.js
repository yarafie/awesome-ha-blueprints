"use strict";(globalThis.webpackChunkawesome_ha_library_website=globalThis.webpackChunkawesome_ha_library_website||[]).push([[5447],{18256(e,t,r){r.r(t),r.d(t,{default:()=>k});var l=r(71299),o=r(47627),i=r(85296),a=r(45112),n=r(71463),s=r(89644),d=r(61667),c=r(27772),p=r(22783),u=r(78973),x=r(11405),y=r(6711),g=r(1916),b=r(15442),h=r(41929),m=r(41778),f=r(84433),L=r(4784);let w=null;const _=()=>{if(w)return w;const e=(L.default?.customFields||{}).env||{},t=e.SUPABASE_URL||process.env.SUPABASE_URL,r=e.SUPABASE_ANON_KEY||process.env.SUPABASE_ANON_KEY;if(t&&r)try{w=(0,f.UU)(t,r)}catch(l){console.error("Supabase init failed",l)}return w},j=async e=>{const t=_();if(!t)throw new Error("Supabase Client not initialized");const r={p_days:e.days,p_category:e.category||null,p_library:e.library||null,p_release:e.release||null,p_id:e.id||null},{data:l,error:o}=await t.rpc("get_library_downloads_daily",r);return o?(console.error("RPC Error (Daily):",o),[]):(l||[]).map(e=>({day:e.day,total:Number(e.total||0)}))};var A=r(36259);const S=e=>Number.isFinite(e)?e.toLocaleString():"0",v=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString(void 0,{timeZone:"UTC",year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},C=(e,t)=>{const r=new Map;e.forEach(e=>{r.set(e.day,Number(e.total??0))});const l=[],o=new Date,i=new Date(Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()));for(let a=t-1;a>=0;a--){const e=new Date(i);e.setUTCDate(i.getUTCDate()-a);const t=e.toISOString().substring(0,10),o=r.get(t)??0;l.push({label:e.toLocaleDateString(void 0,{month:"short",day:"numeric",timeZone:"UTC"}),total:o})}return l},k=()=>{const[e,t]=(0,l.useState)({totalDownloads:0,byCategory:[],aggregates:[],daily:[]}),[r,f]=(0,l.useState)(!0),[L,w]=(0,l.useState)(!1),[k,B]=(0,l.useState)(void 0),[$,D]=(0,l.useState)(15),[T,P]=(0,l.useState)(10),[E,z]=(0,l.useState)("ALL"),[M,R]=(0,l.useState)("ALL"),[U,N]=(0,l.useState)("ALL"),[W,K]=(0,l.useState)("ALL"),[I,O]=(0,l.useState)([]),[F,Y]=(0,l.useState)(!1),[Z,H]=(0,l.useState)({key:"total",direction:"desc"}),[V,G]=(0,l.useState)(!1),q=(0,h.A)(m.A),Q=(0,h.A)(m.A),{totalDownloads:X,byCategory:J,aggregates:ee,daily:te}=e;(0,l.useEffect)(()=>{const e=()=>{const e=document.documentElement.getAttribute("data-theme");G("dark"===e)};e();const t=new MutationObserver(t=>{for(const r of t)"attributes"===r.type&&"data-theme"===r.attributeName&&e()});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[]),(0,l.useEffect)(()=>{if("undefined"==typeof window)return;const e=new URLSearchParams(window.location.search),t=e.get("days"),r=e.get("top"),l=e.get("category"),o=e.get("blueprint"),i=e.get("library"),a=e.get("libraries"),n=e.get("release");if(t&&/^\d+$/.test(t)&&D(Number(t)),r&&/^\d+$/.test(r)&&P(Number(r)),l&&z("ALL"===l?"ALL":l),o&&N("ALL"===o?"ALL":o),n&&K("ALL"===n?"ALL":n),a){const e=a.split(",").map(e=>e.trim()).filter(Boolean);e.length>0&&(O(e),R("ALL"))}else i&&(R(i),O([]))},[]),(0,l.useEffect)(()=>{if("undefined"==typeof window)return;const e=new URLSearchParams(window.location.search);e.set("days",String($)),e.set("top",String(T)),e.set("category",String(E)),e.set("blueprint",String(U)),e.set("release",String(W)),I.length>0?(e.set("libraries",I.join(",")),e.delete("library")):(e.delete("libraries"),e.set("library",String(M)));const t=`${window.location.pathname}?${e.toString()}`;window.history.replaceState({},"",t)},[$,T,E,U,M,I,W]);const re={bg:V?"#1b1b1d":"#f9fafb",cardBg:V?"#242526":"#ffffff",textPrimary:V?"#e5e7eb":"#1f2937",textSecondary:V?"#9ca3af":"#6b7280",gridLine:V?"#444":"#e5e7eb",tooltipBg:V?"#242526":"#ffffff",tooltipBorder:V?"#444":"#ccc",tooltipText:V?"#e5e7eb":"#333",accentColor:"#4f46e5"},le={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},oe={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"};if("undefined"!=typeof window){window.matchMedia("(max-width: 768px)").matches&&(le.gridTemplateColumns="1fr",oe.gridTemplateColumns="1fr")}const ie={backgroundColor:re.cardBg,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:re.textPrimary,minWidth:"0",border:V?"1px solid #333":"none"},ae=e=>({backgroundColor:e,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),ne={padding:"16px",borderBottom:`1px solid ${re.gridLine}`,margin:0,fontSize:"1.25rem",color:re.textPrimary,fontWeight:"bold"},se=({active:e,payload:t,label:r})=>{if(e&&t&&t.length){const e=t.find(e=>"Downloads"===e.dataKey||"total"===e.dataKey),l=e?.value??t[0]?.value??0,o=t[0]?.payload?.name??t[0]?.payload?.id??r??"Value";return(0,A.jsxs)("div",{style:{padding:"10px",backgroundColor:re.tooltipBg,border:`1px solid ${re.tooltipBorder}`,borderRadius:"5px",color:re.tooltipText},children:[(0,A.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:o}),(0,A.jsxs)("p",{children:["Downloads: ",S(l)]})]})}return null},de=e=>{const{x:t,y:r,payload:l}=e;return(0,A.jsx)("g",{transform:`translate(${t},${r})`,children:(0,A.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:re.textSecondary,fontSize:10,title:l.value,children:l.value})})},ce=({current:e,onSelect:t,isDailyLoading:r})=>{const l=t=>({padding:"6px 12px",margin:"0 4px",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontWeight:"bold",backgroundColor:e===t?re.accentColor:re.cardBg,color:e===t?"white":re.textPrimary,border:`1px solid ${e===t?re.accentColor:re.gridLine}`,transition:"all 0.2s",boxShadow:e===t?"0 2px 4px rgba(0,0,0,0.2)":"none",fontSize:"14px",opacity:r&&e!==t?.6:1});return(0,A.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:"20px",paddingTop:"10px"},children:[1,7,15,30,90].map(e=>(0,A.jsxs)("button",{onClick:()=>t(e),style:l(e),disabled:r,children:[e,"D"]},e))})},pe=e=>{let t="desc";Z.key===e&&"desc"===Z.direction&&(t="asc"),H({key:e,direction:t})},ue=({sortKey:e})=>Z.key!==e?(0,A.jsx)("span",{style:{fontSize:"0.7em",marginLeft:"5px",opacity:.4},dangerouslySetInnerHTML:{__html:"&#x25B2;&#x25BC;"}}):(0,A.jsx)("span",{style:{fontSize:"0.7em",marginLeft:"5px",color:re.accentColor},dangerouslySetInnerHTML:{__html:"asc"===Z.direction?"&#x25B2;":"&#x25BC;"}}),xe=({data:e})=>(0,A.jsxs)("div",{style:{padding:"24px 16px 16px 16px"},children:[(0,A.jsx)("h3",{style:{fontSize:"1.25rem",color:re.textPrimary,fontWeight:"bold",marginBottom:"15px",textAlign:"center"},children:$e}),(0,A.jsx)("div",{style:{overflowX:"auto"},children:(0,A.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed",fontSize:"14px",margin:"0"},children:[(0,A.jsxs)("colgroup",{children:[(0,A.jsx)("col",{style:{width:"auto"}}),(0,A.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,A.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,A.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,A.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,A.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}})]}),(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{style:{backgroundColor:V?"#333":"#f3f4f6"},children:[(0,A.jsxs)("th",{onClick:()=>pe("id"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:re.textPrimary,borderBottom:`2px solid ${re.accentColor}`},children:["Blueprint ID ",(0,A.jsx)(ue,{sortKey:"id"})]}),(0,A.jsxs)("th",{onClick:()=>pe("category"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:re.textPrimary,borderBottom:`2px solid ${re.accentColor}`,whiteSpace:"nowrap"},children:["Category ",(0,A.jsx)(ue,{sortKey:"category"})]}),(0,A.jsxs)("th",{onClick:()=>pe("library"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:re.textPrimary,borderBottom:`2px solid ${re.accentColor}`,whiteSpace:"nowrap"},children:["Library ",(0,A.jsx)(ue,{sortKey:"library"})]}),(0,A.jsxs)("th",{onClick:()=>pe("release"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:re.textPrimary,borderBottom:`2px solid ${re.accentColor}`,whiteSpace:"nowrap"},children:["Release ",(0,A.jsx)(ue,{sortKey:"release"})]}),(0,A.jsxs)("th",{onClick:()=>pe("total"),style:{padding:"12px 8px",textAlign:"center",cursor:"pointer",color:re.textPrimary,borderBottom:`2px solid ${re.accentColor}`,whiteSpace:"nowrap"},children:["Downloads ",(0,A.jsx)(ue,{sortKey:"total"})]}),(0,A.jsxs)("th",{onClick:()=>pe("lastDownloaded"),style:{padding:"12px 8px",textAlign:"right",cursor:"pointer",color:re.textPrimary,borderBottom:`2px solid ${re.accentColor}`,whiteSpace:"nowrap"},children:["Last Downloaded ",(0,A.jsx)(ue,{sortKey:"lastDownloaded"})]})]})}),(0,A.jsx)("tbody",{children:e.map((e,t)=>(0,A.jsxs)("tr",{style:{borderBottom:`1px solid ${re.gridLine}`,backgroundColor:t%2==0?re.cardBg:V?"#2d2d2f":"#fcfcfc"},children:[(0,A.jsx)("td",{style:{padding:"10px 8px",wordBreak:"break-word",color:re.textPrimary,textAlign:"left"},children:e.blueprint_id}),(0,A.jsx)("td",{style:{padding:"10px 8px",color:q(e.blueprint_category),textAlign:"left",whiteSpace:"nowrap"},children:e.blueprint_category}),(0,A.jsx)("td",{style:{padding:"10px 8px",textAlign:"left",color:re.textPrimary,whiteSpace:"nowrap"},children:e.blueprint_library??("ALL"!==M?M:"-")}),(0,A.jsx)("td",{style:{padding:"10px 8px",textAlign:"left",color:re.textPrimary,whiteSpace:"nowrap"},children:e.blueprint_release??"-"}),(0,A.jsx)("td",{style:{padding:"10px 8px",textAlign:"center",fontWeight:"bold",color:re.textPrimary,whiteSpace:"nowrap"},children:S(e.total)}),(0,A.jsx)("td",{style:{padding:"10px 8px",textAlign:"right",color:re.textPrimary,whiteSpace:"nowrap"},children:v(e.last_downloaded)})]},`${e.blueprint_category}:${e.blueprint_id}:${e.blueprint_library??"ALL"}:${e.blueprint_release??"ALL"}`))})]})}),0===e.length&&(0,A.jsx)("p",{style:{textAlign:"center",padding:"20px",color:re.textSecondary},children:"No detailed data found for the current selection."})]}),ye=(0,l.useMemo)(()=>"ALL"===E?"category":"ALL"===U?"blueprint":"ALL"===M?"library":"ALL"===W?"release":"detail",[E,U,M,W]),ge=(0,l.useMemo)(()=>{const e=new Set;return ee.forEach(t=>e.add(t.blueprint_category)),Array.from(e).sort()},[ee]),be=(0,l.useMemo)(()=>{const e=new Set;return ee.forEach(t=>{"ALL"!==E&&t.blueprint_category!==E||e.add(t.blueprint_id)}),Array.from(e).sort()},[ee,E]),he=(0,l.useMemo)(()=>{const e=new Set;return ee.forEach(t=>{"ALL"!==E&&t.blueprint_category!==E||"ALL"!==U&&t.blueprint_id!==U||t.blueprint_library&&e.add(t.blueprint_library)}),Array.from(e).sort()},[ee,E,U]),me=(0,l.useMemo)(()=>{const e=new Set;return ee.forEach(t=>{if(!("ALL"!==E&&t.blueprint_category!==E||"ALL"!==U&&t.blueprint_id!==U)){if(I.length>0){if(!t.blueprint_library||!I.includes(t.blueprint_library))return}else if("ALL"!==M&&t.blueprint_library!==M)return;t.blueprint_release&&e.add(t.blueprint_release)}}),Array.from(e).sort()},[ee,E,U,M,I]),fe=(0,l.useMemo)(()=>J.map(e=>({name:e.blueprint_category,category:e.blueprint_category,value:e.total,total:e.total,label:e.blueprint_category})),[J]),Le=(0,l.useCallback)((e,t,r)=>{const l=new Map;return e.forEach(e=>{const o=t(e),i=l.get(o);i?(i.total+=e.total,e.last_downloaded&&(!i.last_downloaded||e.last_downloaded>i.last_downloaded)&&(i.last_downloaded=e.last_downloaded)):l.set(o,r(e))}),Array.from(l.values())},[]),we=(0,l.useMemo)(()=>ee.filter(e=>{if("ALL"!==E&&e.blueprint_category!==E)return!1;if("ALL"!==U&&e.blueprint_id!==U)return!1;if(I.length>0){if(!e.blueprint_library||!I.includes(e.blueprint_library))return!1}else if("ALL"!==M&&e.blueprint_library!==M)return!1;return"ALL"===W||e.blueprint_release===W}),[ee,E,U,M,I,W]),_e=(0,l.useMemo)(()=>"category"===ye||"blueprint"===ye?Le(we,e=>`${e.blueprint_category}::${e.blueprint_id}`,e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:null,blueprint_release:null,total:e.total,last_downloaded:e.last_downloaded})):"library"===ye?Le(we,e=>`${e.blueprint_category}::${e.blueprint_id}::${e.blueprint_library??""}`,e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:e.blueprint_library,blueprint_release:null,total:e.total,last_downloaded:e.last_downloaded})):"release"===ye?Le(we,e=>`${e.blueprint_category}::${e.blueprint_id}::${e.blueprint_library??""}::${e.blueprint_release??""}`,e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:e.blueprint_library,blueprint_release:e.blueprint_release,total:e.total,last_downloaded:e.last_downloaded})):we.map(e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:e.blueprint_library,blueprint_release:e.blueprint_release,total:e.total,last_downloaded:e.last_downloaded})),[Le,we,ye]),je=(0,l.useMemo)(()=>{const e=[..._e];return e.sort((e,t)=>{let r=0;const l=Z.key;if("total"===l)r=e.total-t.total;else if("id"===l)r=e.blueprint_id.localeCompare(t.blueprint_id);else if("category"===l)r=e.blueprint_category.localeCompare(t.blueprint_category);else if("library"===l){const l=e.blueprint_library??"",o=t.blueprint_library??"";r=l.localeCompare(o)}else if("release"===l){const l=e.blueprint_release??"",o=t.blueprint_release??"";r=l.localeCompare(o)}else if("lastDownloaded"===l){r=(e.last_downloaded?new Date(e.last_downloaded).getTime():0)-(t.last_downloaded?new Date(t.last_downloaded).getTime():0)}return"asc"===Z.direction?r:-r}),e},[_e,Z]),Ae=(0,l.useMemo)(()=>je.slice(0,T).map(e=>{const t=[e.blueprint_id];"library"!==ye&&"release"!==ye&&"detail"!==ye||e.blueprint_library&&t.push(e.blueprint_library),"release"!==ye&&"detail"!==ye||e.blueprint_release&&t.push(e.blueprint_release);const r=t.join(" \u2022 "),l=r.length>60?`${r.substring(0,57)}...`:r;return{id:e.blueprint_id,label:l,blueprint_library:e.blueprint_library??null,blueprint_release:e.blueprint_release??null,Downloads:e.total}}),[je,T,ye]),Se=(0,l.useCallback)(()=>{z("ALL"),N("ALL"),R("ALL"),K("ALL")},[]),ve=(0,l.useCallback)(()=>{N("ALL"),R("ALL"),K("ALL")},[]),Ce=(0,l.useCallback)(()=>{R("ALL"),K("ALL")},[]),ke=(0,l.useCallback)(()=>{K("ALL")},[]),Be=()=>{Se()},$e=(0,l.useMemo)(()=>"category"===ye?"Top Blueprints (all categories)":"blueprint"===ye?`Top Blueprints (${E})`:"library"===ye?`Libraries for ${U}`:"release"===ye?`Releases for ${U} \u2192 ${M}`:`Release details: ${U} \u2192 ${M} \u2192 ${W}`,[ye,E,U,M,I,W]),De=(0,l.useMemo)(()=>{const e=[{label:"Categories",onClick:Se}];return"ALL"!==E&&e.push({label:E,onClick:ve}),"ALL"!==U&&e.push({label:U,onClick:Ce}),"ALL"!==M&&e.push({label:M,onClick:ke}),"ALL"!==W&&e.push({label:W,onClick:()=>{}}),e},[ve,Se,Ce,ke,E,U,M,I,W]),Te=(0,l.useCallback)(()=>{if("undefined"==typeof window)return!1;const e=window?.env||{};return Boolean(e.SUPABASE_URL&&e.SUPABASE_ANON_KEY)},[]);return(0,l.useEffect)(()=>{if("undefined"!=typeof window){if(!Te()){const e=[{blueprint_category:"controllers",blueprint_id:"mock-ikea_e2001_e2002",blueprint_library:"EPMatt",blueprint_release:"awesome",total:1e4,last_downloaded:"2025-11-19T10:30:00Z"},{blueprint_category:"controllers",blueprint_id:"mock-ikea_e2001_e2002",blueprint_library:"yarafie",blueprint_release:"anything",total:5e3,last_downloaded:"2025-11-21T10:30:00Z"},{blueprint_category:"hooks",blueprint_id:"mock-light",blueprint_library:"EPMatt",blueprint_release:"awesome",total:5e3,last_downloaded:"2025-11-18T10:30:00Z"},{blueprint_category:"automations",blueprint_id:"mock-addon_update_notification",blueprint_library:"EPMatt",blueprint_release:"awesome",total:250,last_downloaded:"2025-11-22T10:30:00Z"}],r=e.reduce((e,t)=>e+t.total,0),l=new Map;e.forEach(e=>{l.set(e.blueprint_category,(l.get(e.blueprint_category)??0)+e.total)});const o=Array.from(l.entries()).map(([e,t])=>({blueprint_category:e,total:t}));return t(t=>({...t,totalDownloads:r,byCategory:o,aggregates:e})),B("Supabase variables missing. Showing mock aggregate data instead."),void f(!1)}(async()=>{try{const e=await(async e=>{const t=_();if(!t)throw new Error("Supabase Client not initialized (Check Env Vars)");const r={p_category:e.category||null,p_library:e.library||null,p_release:e.release||null,p_id:e.id||null},{data:l,error:o}=await t.rpc("get_library_downloads_aggregates",r);if(o)throw new Error(`RPC Error: ${o.message} (Details: ${o.details})`);return(l||[]).map(e=>({blueprint_category:e.blueprint_category,blueprint_library:e.blueprint_library,blueprint_release:e.blueprint_release,blueprint_id:e.blueprint_id,total:Number(e.total_downloads||0),last_downloaded:e.last_downloaded}))})({}),r=e.reduce((e,t)=>e+t.total,0),l=new Map;e.forEach(e=>{l.set(e.blueprint_category,(l.get(e.blueprint_category)??0)+e.total)});const o=Array.from(l.entries()).map(([e,t])=>({blueprint_category:e,total:t}));t(t=>({...t,totalDownloads:r,byCategory:o,aggregates:e})),B(void 0)}catch(e){B(`Failed to load aggregate metrics: ${e?.message||"Unknown error."}`)}finally{f(!1)}})()}},[Te]),(0,l.useEffect)(()=>{if(r)return;if("undefined"==typeof window)return;if(!Te()){const e=[{day:new Date(Date.now()-864e6).toISOString().substring(0,10),total:10},{day:new Date(Date.now()-432e6).toISOString().substring(0,10),total:20},{day:(new Date).toISOString().substring(0,10),total:22}],r=C(e,$);return t(e=>({...e,daily:r})),void w(!1)}w(!0);const e="ALL"===E?null:E,l="ALL"===U?null:U,o=I.length?I:"ALL"===M?[]:[M];(async()=>{try{let r=[];if(o.length<=1){const t=I.length?I:"ALL"===M?[]:[M];if(t.length<=1){const o=1===t.length?t[0]:null;r=await j({days:$,category:e,id:l,library:o,release:"ALL"!==W?W:null})}else{const o=await Promise.all(t.map(t=>j({days:$,category:e,id:l,library:t,release:"ALL"!==W?W:null}))),i=new Map;for(const e of o)for(const t of e)i.set(t.day,(i.get(t.day)??0)+Number(t.total??0));r=Array.from(i.entries()).sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>({day:e,total:t}))}}else{const t=await Promise.all(o.map(t=>j({days:$,category:e,id:l,library:t,release:"ALL"!==W?W:null}))),i=new Map;for(const e of t)for(const t of e)i.set(t.day,(i.get(t.day)??0)+Number(t.total??0));r=Array.from(i.entries()).sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>({day:e,total:t}))}const i=C(r,$);t(e=>({...e,daily:i}))}catch(r){B(`Failed to load daily metrics: ${r?.message||"Unknown error."}`)}finally{w(!1)}})()},[Te,r,$,E,U,M,I,W]),(0,A.jsx)(o.A,{title:"Library Downloads Metrics",description:"Enhanced metrics dashboard with library-aware analytics",children:(0,A.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:re.bg,transition:"background-color 0.3s ease",minHeight:"100vh",padding:"2rem"},children:[(0,A.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold",color:re.textPrimary},children:"Library Download Metrics Dashboard"}),r&&(0,A.jsx)("div",{style:{textAlign:"center",color:re.textPrimary},children:"Loading core metrics..."}),!r&&k&&(0,A.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,A.jsx)("h4",{className:"alert__heading",children:"Metrics Notice"}),(0,A.jsx)("p",{children:k})]}),!r&&(0,A.jsxs)("div",{style:{width:"100%"},children:[(0,A.jsxs)("section",{style:le,children:[(0,A.jsxs)("div",{style:ie,children:[(0,A.jsx)("div",{style:ae(re.accentColor),children:"Total Downloads"}),(0,A.jsx)("div",{style:{padding:"24px",textAlign:"center"},children:(0,A.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:re.accentColor,margin:0},children:S(X)})})]}),(0,A.jsxs)("div",{style:ie,children:[(0,A.jsx)("div",{style:ae("#9333ea"),children:"Tracked Blueprints (rows)"}),(0,A.jsx)("div",{style:{padding:"24px",textAlign:"center"},children:(0,A.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:S(ee.length)})})]})]}),(0,A.jsxs)("section",{style:{...ie,marginBottom:"24px"},children:[(0,A.jsx)("div",{style:ae("#0ea5e9"),children:"Library View - Selection"}),(0,A.jsxs)("div",{style:{padding:"16px"},children:[(0,A.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",alignItems:"center"},children:[De.map((e,t)=>(0,A.jsxs)(l.Fragment,{children:[(0,A.jsx)("button",{type:"button",onClick:e.onClick,style:{padding:"6px 10px",borderRadius:"6px",border:`1px solid ${re.gridLine}`,background:re.cardBg,color:re.textPrimary,cursor:t===De.length-1?"default":"pointer",opacity:t===De.length-1?.9:1,fontWeight:t===De.length-1?"bold":"normal"},disabled:t===De.length-1,children:e.label}),t<De.length-1&&(0,A.jsx)("span",{style:{color:re.textSecondary},children:"\u203a"})]},e.label)),(0,A.jsx)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px",flexWrap:"wrap"},children:(0,A.jsx)("button",{type:"button",onClick:Be,style:{padding:"6px 10px",borderRadius:"6px",border:`1px solid ${re.gridLine}`,background:V?"#2d2d2f":"#f3f4f6",color:re.textPrimary,cursor:"pointer",fontWeight:"bold"},children:"Reset"})})]}),(0,A.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:"12px",marginTop:"14px"},children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{style:{fontSize:"12px",color:re.textSecondary,marginBottom:"6px"},children:"Category"}),(0,A.jsxs)("select",{value:E,onChange:e=>{const t=e.target.value;z(t),N("ALL"),R("ALL"),K("ALL")},style:{width:"100%",padding:"8px",borderRadius:"6px"},children:[(0,A.jsx)("option",{value:"ALL",children:"ALL"}),ge.map(e=>(0,A.jsx)("option",{value:e,children:e},e))]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{style:{fontSize:"12px",color:re.textSecondary,marginBottom:"6px"},children:"Blueprint"}),(0,A.jsxs)("select",{value:U,onChange:e=>{const t=e.target.value;N(t),R("ALL"),K("ALL")},style:{width:"100%",padding:"8px",borderRadius:"6px"},disabled:"ALL"===E,children:[(0,A.jsx)("option",{value:"ALL",children:"ALL"}),be.map(e=>(0,A.jsx)("option",{value:e,children:e},e))]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{style:{fontSize:"12px",color:re.textSecondary,marginBottom:"6px"},children:"Library"}),(0,A.jsxs)("select",{value:M,onChange:e=>{const t=e.target.value;R(t),K("ALL")},style:{width:"100%",padding:"8px",borderRadius:"6px"},disabled:"ALL"===E||"ALL"===U,children:[(0,A.jsx)("option",{value:"ALL",children:"ALL"}),he.map(e=>(0,A.jsx)("option",{value:e,children:e},e))]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{style:{fontSize:"12px",color:re.textSecondary,marginBottom:"6px"},children:"Release"}),(0,A.jsxs)("select",{value:W,onChange:e=>K(e.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px"},disabled:"ALL"===E||"ALL"===U||"ALL"===M||I.length>1,children:[(0,A.jsx)("option",{value:"ALL",children:"ALL"}),me.map(e=>(0,A.jsx)("option",{value:e,children:e},e))]}),(0,A.jsx)("div",{style:{marginTop:"8px"},children:(0,A.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",color:re.textSecondary},title:"Optional: enable only if you later add a version-aware analytics RPC",children:[(0,A.jsx)("input",{type:"checkbox",checked:F,onChange:e=>Y(e.target.checked),disabled:!0}),"Version (optional)"]})})]})]})]})]}),(0,A.jsxs)("section",{style:oe,children:[(0,A.jsxs)("div",{style:ie,children:[(0,A.jsxs)("h3",{style:ne,children:["Daily Downloads (Last ",$," Days)"]}),(0,A.jsx)(ce,{current:$,onSelect:D,isDailyLoading:L}),(0,A.jsxs)("div",{style:{height:"350px",padding:"10px",position:"relative"},children:[L&&(0,A.jsx)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:V?"rgba(36, 37, 38, 0.8)":"rgba(255, 255, 255, 0.8)",zIndex:10,borderRadius:"4px",color:re.textPrimary,fontSize:"1.2rem",fontWeight:"bold"},children:"Updating chart..."}),(0,A.jsx)(i.u,{width:"100%",height:"100%",children:(0,A.jsxs)(a.Q,{data:te,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,A.jsx)("stop",{offset:"5%",stopColor:re.accentColor,stopOpacity:.8}),(0,A.jsx)("stop",{offset:"95%",stopColor:re.accentColor,stopOpacity:0})]})}),(0,A.jsx)(n.d,{strokeDasharray:"3 3",stroke:re.gridLine,vertical:!1}),(0,A.jsx)(s.W,{dataKey:"label",stroke:re.textSecondary,tick:{fontSize:10,fill:re.textSecondary}}),(0,A.jsx)(d.h,{allowDecimals:!1,stroke:re.textSecondary,tick:{fontSize:10,fill:re.textSecondary},tickFormatter:S}),(0,A.jsx)(c.m,{content:(0,A.jsx)(se,{})}),(0,A.jsx)(p.Gk,{type:"monotone",dataKey:"total",stroke:re.accentColor,strokeWidth:3,fill:"url(#colorTotal)"})]})})]})]}),(0,A.jsxs)("div",{style:ie,children:[(0,A.jsx)("h3",{style:ne,children:"Category Distribution (Click to filter)"}),(0,A.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,A.jsx)(i.u,{width:"100%",height:"100%",children:(0,A.jsxs)(u.r,{children:[(0,A.jsx)(x.Fq,{data:fe.map(e=>({...e,fill:q(e.category),stroke:V?"#242526":"#fff",fillOpacity:"ALL"===E||E===e.category?1:.4})),dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,labelLine:!1,label:({percent:e})=>`${(100*e).toFixed(0)}%`,onClick:e=>{const t=e?.category;t&&(z(e=>e===t?"ALL":t),N("ALL"),R("ALL"),K("ALL"))},style:{cursor:"pointer"}}),(0,A.jsx)(c.m,{content:(0,A.jsx)(se,{})}),(0,A.jsx)(y.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:re.textPrimary}})]})})})]})]}),(0,A.jsxs)("section",{style:{...ie,paddingBottom:"20px",marginBottom:"32px"},children:[(0,A.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",borderBottom:`1px solid ${re.gridLine}`,flexWrap:"wrap",gap:"8px"},children:[(0,A.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1,minWidth:0},children:[(0,A.jsx)("h3",{style:{...ne,borderBottom:"none",paddingLeft:0,margin:0},children:"ALL"===E?`Top ${T} Blueprints`:I.length>0?`Top ${T} Blueprints (Libraries: ${I.length})`:"ALL"!==M?`Top ${T} Blueprints (${M})`:`Top ${T} ${E.charAt(0).toUpperCase()+E.slice(1)} Blueprints`}),he.length>0&&(0,A.jsxs)("div",{style:{margin:"8px 0 8px 0"},children:[(0,A.jsx)("label",{style:{fontSize:"0.85rem",marginRight:"8px",color:re.textSecondary},children:"Library:"}),(0,A.jsxs)("select",{value:M,onChange:e=>{const t=e.target.value;R(t),O([]),"ALL"===t&&K("ALL")},style:{padding:"4px 8px",fontSize:"0.85rem",borderRadius:"4px",border:`1px solid ${re.gridLine}`,background:"var(--ifm-navbar-background-color)",color:"var(--ifm-font-color-base)"},children:[(0,A.jsx)("option",{value:"ALL",children:"All Libraries"}),he.map(e=>(0,A.jsx)("option",{value:e,children:e},e))]}),(0,A.jsxs)("div",{style:{marginTop:"10px"},children:[(0,A.jsx)("div",{style:{fontSize:"0.8rem",color:re.textSecondary,marginBottom:"6px"},children:"Compare libraries (multi-select):"}),(0,A.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",maxHeight:"84px",overflowY:"auto",padding:"6px",border:`1px solid ${re.gridLine}`,borderRadius:"6px"},children:[he.map(e=>{const t=I.includes(e);return(0,A.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:"6px",fontSize:"0.8rem",cursor:"pointer",userSelect:"none"},children:[(0,A.jsx)("input",{type:"checkbox",checked:t,onChange:()=>{O(r=>{const l=t?r.filter(t=>t!==e):[...r,e];return 1===l.length?R(l[0]):R("ALL"),1!==l.length&&K("ALL"),l})}}),(0,A.jsx)("span",{style:{color:re.textPrimary},children:e})]},e)}),0===he.length&&(0,A.jsx)("span",{style:{color:re.textSecondary},children:"No libraries found for current selection."})]}),I.length>1&&(0,A.jsx)("div",{style:{marginTop:"6px",fontSize:"0.75rem",color:re.textSecondary},children:"Release drill-down is disabled while comparing multiple libraries."})]})]})]}),(0,A.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,A.jsxs)("div",{style:{position:"relative"},children:[(0,A.jsx)("select",{value:T,onChange:e=>P(Number(e.target.value)),style:{appearance:"none",padding:"6px 32px 6px 10px",fontSize:"14px",cursor:"pointer",backgroundColor:"var(--ifm-navbar-background-color)",color:"var(--ifm-font-color-base)",border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:"6px"},children:[5,10,15,20,25,30,40,50].map(e=>(0,A.jsxs)("option",{value:e,children:["Top ",e]},e))}),(0,A.jsx)("svg",{style:{position:"absolute",right:"10px",top:"50%",width:"14px",height:"14px",transform:"translateY(-50%)",opacity:.7,pointerEvents:"none"},viewBox:"0 0 24 24",children:(0,A.jsx)("path",{fill:"currentColor",d:"M7 10l5 5 5-5z"})})]}),("ALL"!==E||"ALL"!==M)&&(0,A.jsx)("button",{onClick:Be,style:{fontSize:"12px",padding:"6px 10px",borderRadius:"4px",backgroundColor:"#ef4444",color:"white",border:"none",cursor:"pointer",fontWeight:"bold",transition:"background-color 0.2s",whiteSpace:"nowrap"},title:"Clear category/library filters",children:"Clear Filters"})]})]}),(0,A.jsx)("div",{style:{height:Math.max(400,40*Ae.length)},children:Ae.length>0?(0,A.jsx)(i.u,{width:"100%",height:"100%",children:(0,A.jsxs)(g.E,{onClick:e=>{const t=e?.id;if(t){if("ALL"===E){const e=ee.find(e=>e.blueprint_id===t);e&&z(e.blueprint_category)}N(t),R("ALL"),K("ALL")}},data:Ae,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,A.jsx)(n.d,{strokeDasharray:"3 3",horizontal:!1,stroke:re.gridLine}),(0,A.jsx)(s.W,{type:"number",tickFormatter:S,stroke:re.textSecondary}),(0,A.jsx)(d.h,{dataKey:"label",type:"category",width:100,tick:(0,A.jsx)(de,{})}),(0,A.jsx)(c.m,{content:(0,A.jsx)(se,{}),cursor:{fill:re.accentColor,opacity:.1}}),(0,A.jsx)(b.yP,{dataKey:"Downloads",name:"# of Downloads",barSize:20,shape:e=>{const{x:t,y:r,width:l,height:o,payload:i}=e,a=U===i.id,n="ALL"===U||a?1:.4;return(0,A.jsx)("rect",{x:t,y:r,width:l,height:o,fill:Q(i.id),fillOpacity:n,stroke:a?re.accentColor:"none",strokeWidth:a?2:0,rx:4,style:{transition:"all 0.3s ease",cursor:"pointer"}})}})]})}):(0,A.jsx)("p",{style:{textAlign:"center",padding:"50px",color:re.textSecondary},children:"No top blueprints found for the current selection."})})]}),(0,A.jsx)("section",{style:{...ie,overflow:"visible"},children:(0,A.jsx)(xe,{data:je})})]})]})})}}}]);