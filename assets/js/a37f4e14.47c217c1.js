"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var r=a(3303),s=a(1153),l=a(6285),o=a(4538),i=a(162),n=a(656),d=a(351),c=a(6605),x=a(9441),h=a(2782),m=a(7342),b=a(2941),g=a(2454),p=a(7263),u=a(50),y=a(1929),f=a(1778),j=a(7711);const w=()=>{const[e,t]=(0,r.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),{loading:a,error:w,totalDownloads:v,byCategory:N,topBlueprints:k,daily:S}=e,_=(0,y.A)(f.A);(0,r.useEffect)(()=>{const e=window?.env?.SUPABASE_URL,a=window?.env?.SUPABASE_ANON_KEY;if(!e||!a)return void t(e=>({...e,loading:!1,error:"Supabase environment variables are not available. Check SUPABASE_URL and SUPABASE_ANON_KEY."}));const r={"Content-Type":"application/json",apikey:a,Authorization:`Bearer ${a}`},s=async(e,t,a=3)=>{for(let r=0;r<a;r++)try{const s=await fetch(e,t);if(s.ok)return s;if(429===s.status&&r<a-1){const e=1e3*Math.pow(2,r)+1e3*Math.random();await new Promise(t=>setTimeout(t,e));continue}{const e=await s.text();throw new Error(`HTTP error! Status: ${s.status}. Response: ${e.substring(0,100)}...`)}}catch(w){if(r===a-1)throw w}};!async function(){try{const[a,l,o,i]=await Promise.all([s(`${e}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:r,body:JSON.stringify({})}),s(`${e}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:r,body:JSON.stringify({})}),s(`${e}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:r,body:JSON.stringify({})}),s(`${e}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:r,body:JSON.stringify({p_days:30})})]),n=await a.json(),d=await l.json(),c=await o.json(),x=await i.json();let h=0;Array.isArray(n)&&n.length>0?h=Number(n[0].total):"number"==typeof n&&(h=n);const m=Array.isArray(d)?d:[],b=Array.isArray(c)?c:[],g=Array.isArray(x)?x.map(e=>({label:new Date(e.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(e.total)})).sort((e,t)=>{const a=new Date(e.label),r=new Date(t.label);return a.getTime()-r.getTime()}):[];t({loading:!1,error:void 0,totalDownloads:h,byCategory:m,topBlueprints:b,daily:g})}catch(a){console.error("Error fetching download metrics",a),t(e=>({...e,loading:!1,error:`Failed to load metrics from Supabase. Error: ${a.message||"Unknown error."}`}))}}()},[]);const A=e=>e.toLocaleString(),D=N.map(e=>({name:e.blueprint_category,category:e.blueprint_category,value:Number(e.total),total:Number(e.total),label:e.blueprint_category})),T=k.slice(0,10).map(e=>({id:e.blueprint_id,name:e.blueprint_id.length>40?e.blueprint_id.substring(0,37)+"...":e.blueprint_id,value:Number(e.total)})).reverse(),E=({active:e,payload:t,label:a})=>{if(e&&t&&t.length){const e=t[0].payload;return(0,j.jsxs)("div",{className:"p-3 bg-white border border-gray-300 shadow-xl rounded-lg text-sm text-gray-700",children:[(0,j.jsx)("p",{className:"font-bold text-indigo-600 mb-1",children:e.name||e.id||a}),(0,j.jsxs)("p",{children:[(0,j.jsx)("span",{className:"font-semibold",children:"Downloads:"})," ",A(e.value||t[0].value)]})]})}return null},$=e=>{const{x:t,y:a,payload:r}=e;return(0,j.jsx)("g",{transform:`translate(${t},${a})`,children:(0,j.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:"#6b7280",fontSize:10,title:r.value,children:r.value})})};return(0,j.jsx)(s.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,j.jsxs)("main",{className:"container mx-auto p-4 md:p-8",children:[(0,j.jsx)("h1",{className:"text-center mb-8 text-3xl font-extrabold text-gray-900",children:"Blueprint Metrics Dashboard"}),a&&(0,j.jsxs)("div",{className:"text-center my-6 p-6 bg-indigo-50 border-2 border-indigo-300 rounded-xl shadow-lg animate-pulse",children:[(0,j.jsx)("div",{className:"mb-2 text-xl font-semibold text-indigo-700",children:"Loading Data..."}),(0,j.jsx)("small",{className:"text-indigo-500",children:"Fetching all metrics. Please wait."})]}),!a&&w&&(0,j.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-lg",role:"alert",children:[(0,j.jsx)("h4",{className:"font-bold",children:"Error loading metrics"}),(0,j.jsx)("p",{children:w})]}),!a&&!w&&(0,j.jsxs)("div",{className:"space-y-8 md:space-y-12",children:[(0,j.jsxs)("section",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6",children:[(0,j.jsxs)("div",{className:"card shadow-2xl bg-white border-b-4 border-indigo-600 transition-all hover:scale-[1.01] duration-300 rounded-xl p-4",children:[(0,j.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Total Downloads"}),(0,j.jsx)("p",{className:"mt-1 text-3xl md:text-4xl font-extrabold text-indigo-800",children:A(v)})]}),(0,j.jsxs)("div",{className:"card shadow-2xl bg-white border-b-4 border-teal-600 transition-all hover:scale-[1.01] duration-300 rounded-xl p-4",children:[(0,j.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Unique Categories"}),(0,j.jsx)("p",{className:"mt-1 text-3xl md:text-4xl font-extrabold text-teal-800",children:A(N.length)})]}),(0,j.jsxs)("div",{className:"card shadow-2xl bg-white border-b-4 border-purple-600 transition-all hover:scale-[1.01] duration-300 rounded-xl p-4 col-span-2 md:col-span-1",children:[(0,j.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Tracked Blueprints"}),(0,j.jsx)("p",{className:"mt-1 text-3xl md:text-4xl font-extrabold text-purple-800",children:A(k.length)})]})]}),(0,j.jsxs)("section",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8",children:[(0,j.jsxs)("div",{className:"w-full shadow-2xl bg-white p-4 rounded-xl border border-gray-100",children:[(0,j.jsx)("h3",{className:"font-bold text-xl mb-4 text-gray-800 border-b pb-2",children:"Daily Downloads (Last 30 Days)"}),(0,j.jsx)("div",{style:{height:350},children:0===S.length?(0,j.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500 text-base",children:"No recent download data available."}):(0,j.jsx)(i.u,{width:"100%",height:"100%",children:(0,j.jsxs)(u.Q,{data:S,margin:{top:10,right:0,left:-10,bottom:0},children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,j.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb",vertical:!1}),(0,j.jsx)(m.W,{dataKey:"label",stroke:"#9ca3af",tick:{fontSize:10},padding:{left:10,right:10}}),(0,j.jsx)(b.h,{allowDecimals:!1,stroke:"#9ca3af",tick:{fontSize:10},tickFormatter:A}),(0,j.jsx)(o.m,{content:(0,j.jsx)(E,{})}),(0,j.jsx)(x.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)",dot:!1,activeDot:{r:6,fill:"#fff",stroke:"#4f46e5",strokeWidth:2}})]})})})]}),(0,j.jsxs)("div",{className:"w-full shadow-2xl bg-white p-4 rounded-xl border border-gray-100",children:[(0,j.jsx)("h3",{className:"font-bold text-xl mb-4 text-gray-800 border-b pb-2",children:"Download Distribution by Category"}),(0,j.jsx)("div",{style:{height:350},children:0===D.length?(0,j.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500 text-base",children:"No category data available."}):(0,j.jsx)(i.u,{width:"100%",height:"100%",children:(0,j.jsxs)(p.r,{children:[(0,j.jsx)(d.F,{data:D,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({name:e,percent:t})=>`${e}: ${(100*t).toFixed(1)}%`,children:D.map((e,t)=>(0,j.jsx)(n.f,{fill:_(e.category),stroke:"#fff"},`cell-${t}`))}),(0,j.jsx)(o.m,{content:(0,j.jsx)(E,{})}),(0,j.jsx)(l.s,{layout:"vertical",verticalAlign:"middle",align:"right",iconType:"circle",wrapperStyle:{fontSize:"12px"}})]})})})]})]}),(0,j.jsxs)("section",{className:"w-full shadow-2xl bg-white p-4 rounded-xl border border-gray-100",children:[(0,j.jsx)("h3",{className:"font-bold text-xl mb-4 text-gray-800 border-b pb-2",children:"Top 10 Blueprint Downloads (Ranking)"}),(0,j.jsx)("div",{style:{height:Math.max(400,40*T.length)},children:0===T.length?(0,j.jsx)("p",{className:"text-gray-500 text-base p-4",children:"No individual blueprint download data recorded yet."}):(0,j.jsx)(i.u,{width:"100%",height:"100%",children:(0,j.jsxs)(g.E,{data:T,layout:"vertical",margin:{top:20,right:30,left:100,bottom:5},children:[(0,j.jsx)(c.d,{strokeDasharray:"3 3",vertical:!1}),(0,j.jsx)(m.W,{type:"number",stroke:"#9ca3af",tick:{fontSize:10},tickFormatter:A}),(0,j.jsx)(b.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,j.jsx)($,{})}),(0,j.jsx)(o.m,{content:(0,j.jsx)(E,{})}),(0,j.jsx)(h.y,{dataKey:"value",fill:_("top10"),barSize:20,radius:[10,10,0,0]})]})})})]})]})]})})}}}]);