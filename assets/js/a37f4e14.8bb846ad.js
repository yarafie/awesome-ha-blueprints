"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,o)=>{o.r(e),o.d(e,{default:()=>w});var r=o(3303),i=o(1153),a=o(6285),n=o(4538),l=o(162),s=o(656),d=o(351),c=o(6605),p=o(9441),y=o(2782),h=o(7342),g=o(2941),u=o(2454),x=o(7263),b=o(50),f=o(1929),m=o(1778),j=o(7711);const w=()=>{const[t,e]=(0,r.useState)({totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),[o,w]=(0,r.useState)(!0),[S,v]=(0,r.useState)(!0),[k,_]=(0,r.useState)(void 0),[C,A]=(0,r.useState)(15),[B,D]=(0,r.useState)(!1),[T,P]=(0,r.useState)(null),{totalDownloads:z,byCategory:E,topBlueprints:N,daily:L}=t,$=(0,f.A)(m.A),O=t=>t.toISOString().split("T")[0],W=t=>t.toLocaleString(),R=(t,e)=>{const o=new Map(t.map(t=>[t.day,Number(t.total)])),r=[],i=new Date;for(let a=e-1;a>=0;a--){const t=new Date(i);t.setDate(i.getDate()-a);const e=O(t),n=o.get(e)||0;r.push({label:t.toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:n})}return r},U=(0,r.useCallback)(async(t,e,o=3)=>{for(let r=0;r<o;r++)try{const i=await fetch(t,e);if(i.ok)return i;if(429===i.status&&r<o-1){const t=1e3*Math.pow(2,r)+1e3*Math.random();await new Promise(e=>setTimeout(e,t));continue}{const t=await i.text();throw new Error(`HTTP error! Status: ${i.status}. Response: ${t.substring(0,100)}...`)}}catch(k){if(r===o-1)throw k}},[]);(0,r.useEffect)(()=>{const t=()=>{const t=document.documentElement.getAttribute("data-theme");D("dark"===t)};t();const e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"data-theme"===e.attributeName&&t()})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,r.useEffect)(()=>{const t=window?.env?.SUPABASE_URL,o=window?.env?.SUPABASE_ANON_KEY,r={"Content-Type":"application/json",apikey:o,Authorization:"Bearer "+o};if(!t||!o)return e(t=>({...t,totalDownloads:1234567,byCategory:[{blueprint_category:"controllers",total:"900000"},{blueprint_category:"hooks",total:"280000"},{blueprint_category:"utilities",total:"50000"},{blueprint_category:"layouts",total:"5000"}],topBlueprints:[{blueprint_category:"hooks",blueprint_id:"use_auth_token_v3",total:"50000"},{blueprint_category:"hooks",blueprint_id:"use_global_state_mgmt",total:"40000"},{blueprint_category:"controllers",blueprint_id:"http_request_worker",total:"10000"}]})),_("Supabase variables missing. Showing mock data."),void w(!1);!async function(){try{const[o,i,a]=await Promise.all([U(`${t}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:r,body:JSON.stringify({})}),U(`${t}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:r,body:JSON.stringify({})}),U(`${t}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:r,body:JSON.stringify({})})]),n=await o.json(),l=await i.json(),s=await a.json();let d=0;Array.isArray(n)&&n.length>0?d=Number(n[0].total):"number"==typeof n&&(d=n),e(t=>({...t,totalDownloads:d,byCategory:Array.isArray(l)?l:[],topBlueprints:Array.isArray(s)?s:[]})),_(void 0)}catch(o){console.error("Error fetching static metrics",o),_(`Failed to load static metrics: ${o.message||"Unknown error."}`)}finally{w(!1)}}()},[U]),(0,r.useEffect)(()=>{if(!o){v(!0);const t=window?.env?.SUPABASE_URL,r=window?.env?.SUPABASE_ANON_KEY,i={"Content-Type":"application/json",apikey:r,Authorization:"Bearer "+r};if(!t||!r){const n=[{day:O(new Date(Date.now()-864e6)),total:"10"},{day:O(new Date(Date.now()-432e6)),total:"20"},{day:O(new Date),total:"22"}],l=R(n,C);return e(t=>({...t,daily:l})),void v(!1)}async function a(){try{const o=await U(`${t}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:i,body:JSON.stringify({p_days:C})}),r=await o.json(),a=R(Array.isArray(r)?r:[],C);e(t=>({...t,daily:a}))}catch(o){console.error("Error fetching daily metrics",o),_(`Failed to load daily metrics: ${o.message||"Unknown error."}`)}finally{v(!1)}}a()}},[C,o,U]);const F=({current:t,onSelect:e,isDailyLoading:o})=>{const r=e=>({padding:"6px 12px",margin:"0 4px",borderRadius:"4px",cursor:o?"not-allowed":"pointer",fontWeight:"bold",backgroundColor:t===e?"#4f46e5":I.cardBg,color:t===e?"white":I.textPrimary,border:`1px solid ${t===e?"#4f46e5":I.gridLine}`,transition:"all 0.2s",boxShadow:t===e?"0 2px 4px rgba(0,0,0,0.2)":"none",fontSize:"14px",opacity:o&&t!==e?.6:1});return(0,j.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:"20px",paddingTop:"10px"},children:[7,15,30,90].map(t=>(0,j.jsxs)("button",{onClick:()=>e(t),style:r(t),disabled:o,children:[t,"D"]},t))})},K=({active:t,payload:e,label:o})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,j.jsxs)("div",{style:{padding:"10px",backgroundColor:I.tooltipBg,border:`1px solid ${I.tooltipBorder}`,borderRadius:"5px",color:I.tooltipText},children:[(0,j.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:t.name||t.id||o}),(0,j.jsxs)("p",{children:["Downloads: ",W(t.value||e[0].value)]})]})}return null},M=t=>{const{x:e,y:o,payload:r}=t;return(0,j.jsx)("g",{transform:`translate(${e},${o})`,children:(0,j.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:I.textSecondary,fontSize:10,title:r.value,children:r.value})})},I={bg:B?"#1b1b1d":"#f9fafb",cardBg:B?"#242526":"#ffffff",textPrimary:B?"#e5e7eb":"#1f2937",textSecondary:B?"#9ca3af":"#6b7280",gridLine:B?"#444":"#e5e7eb",tooltipBg:B?"#242526":"#ffffff",tooltipBorder:B?"#444":"#ccc",tooltipText:B?"#e5e7eb":"#333"},J={backgroundColor:I.cardBg,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:I.textPrimary,minWidth:"0",border:B?"1px solid #333":"none"},G=t=>({backgroundColor:t,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),H={padding:"24px",textAlign:"center"},Y={padding:"16px",borderBottom:`1px solid ${I.gridLine}`,margin:0,fontSize:"1.25rem",color:I.textPrimary,fontWeight:"bold"},q=E.map(t=>({name:t.blueprint_category,category:t.blueprint_category,value:Number(t.total),total:Number(t.total),label:t.blueprint_category})),Q=(T?N.filter(t=>t.blueprint_category===T):N).slice(0,10).map(t=>({id:t.blueprint_id,name:t.blueprint_id.length>40?t.blueprint_id.substring(0,37)+"...":t.blueprint_id,value:Number(t.total)}));return(0,j.jsx)(i.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,j.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:I.bg,transition:"background-color 0.3s ease",minHeight:"100vh",padding:"2rem"},children:[(0,j.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold",color:I.textPrimary},children:"Blueprint Metrics Dashboard"}),o&&(0,j.jsx)("div",{style:{textAlign:"center",color:I.textPrimary},children:"Loading core metrics..."}),!o&&k&&(0,j.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,j.jsx)("h4",{className:"alert__heading",children:"Error loading metrics"}),(0,j.jsx)("p",{children:k})]}),!o&&(0,j.jsxs)("div",{style:{width:"100%",overflowX:"auto"},children:[(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:J,children:[(0,j.jsx)("div",{style:G("#4f46e5"),children:"Total Downloads"}),(0,j.jsx)("div",{style:H,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#4f46e5",margin:0},children:W(z)})})]}),(0,j.jsxs)("div",{style:J,children:[(0,j.jsx)("div",{style:G("#9333ea"),children:"Tracked Blueprints"}),(0,j.jsx)("div",{style:H,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:W(N.length)})})]})]}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:J,children:[(0,j.jsxs)("h3",{style:Y,children:["Daily Downloads (Last ",C," Days)"]}),(0,j.jsx)(F,{current:C,onSelect:A,isDailyLoading:S}),(0,j.jsxs)("div",{style:{height:"350px",padding:"10px",position:"relative"},children:[S&&(0,j.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:B?"rgba(36, 37, 38, 0.8)":"rgba(255, 255, 255, 0.8)",zIndex:10,borderRadius:"4px",color:I.textPrimary,fontSize:"1.2rem",fontWeight:"bold"},children:"Updating chart..."}),(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(b.Q,{data:L,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,j.jsx)(c.d,{strokeDasharray:"3 3",stroke:I.gridLine,vertical:!1}),(0,j.jsx)(h.W,{dataKey:"label",stroke:I.textSecondary,tick:{fontSize:10,fill:I.textSecondary}}),(0,j.jsx)(g.h,{allowDecimals:!1,stroke:I.textSecondary,tick:{fontSize:10,fill:I.textSecondary},tickFormatter:W}),(0,j.jsx)(n.m,{content:(0,j.jsx)(K,{})}),(0,j.jsx)(p.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)"})]})})]})]}),(0,j.jsxs)("div",{style:J,children:[(0,j.jsx)("h3",{style:Y,children:"Category Distribution (Click to filter)"}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(x.r,{children:[(0,j.jsx)(d.F,{data:q,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:t})=>`${(100*t).toFixed(0)}%`,onClick:t=>{const e=t.category;P(t=>t===e?null:e)},style:{cursor:"pointer"},children:q.map((t,e)=>(0,j.jsx)(s.f,{fill:$(t.category),stroke:B?"#242526":"#fff",opacity:null===T||T===t.category?1:.4},`cell-${e}`))}),(0,j.jsx)(n.m,{content:(0,j.jsx)(K,{})}),(0,j.jsx)(a.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:I.textPrimary}})]})})})]})]}),(0,j.jsxs)("section",{style:{...J,paddingBottom:"20px"},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:"16px"},children:[(0,j.jsx)("h3",{style:{...Y,borderBottom:"none"},children:T?`Top 10 Blueprints in '${T}' Category`:"Top 10 Blueprints (Overall)"}),T&&(0,j.jsx)("button",{onClick:()=>{P(null)},style:{fontSize:"12px",padding:"6px 10px",borderRadius:"4px",backgroundColor:"#ef4444",color:"white",border:"none",cursor:"pointer",fontWeight:"bold",transition:"background-color 0.2s"},title:"Click to view all blueprints",children:"Clear Filter"})]}),(0,j.jsx)("div",{style:{height:Math.max(400,40*Q.length)},children:Q.length>0?(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(u.E,{data:Q,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,j.jsx)(c.d,{strokeDasharray:"3 3",horizontal:!1,stroke:I.gridLine}),(0,j.jsx)(h.W,{type:"number",stroke:I.textSecondary,tick:{fontSize:10,fill:I.textSecondary},tickFormatter:W,domain:[0,"auto"],allowDecimals:!1}),(0,j.jsx)(g.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,j.jsx)(M,{})}),(0,j.jsx)(n.m,{content:(0,j.jsx)(K,{})}),(0,j.jsx)(y.y,{dataKey:"value",fill:$(T||"top10"),barSize:20,radius:[0,4,4,0]})]})}):(0,j.jsxs)("p",{style:{textAlign:"center",padding:"50px",color:I.textSecondary},children:["No blueprints found for the selected category:"," ",T]})})]})]})]})})}}}]);