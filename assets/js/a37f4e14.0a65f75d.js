"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,r)=>{r.r(e),r.d(e,{default:()=>D});var a=r(3303),o=r(1153),i=r(6285),n=r(4538),l=r(162),s=r(656),c=r(351),d=r(6605),h=r(9441),p=r(2782),g=r(7342),x=r(2941),y=r(2454),m=r(7263),u=r(50),b=r(1929),v=r(1778),j=r(7711);const f=t=>t.toLocaleString(),_=t=>t.map(t=>{return{label:(e=t.day,new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric"})),total:Number(t.total),ts:new Date(t.day).getTime()};var e}).sort((t,e)=>t.ts-e.ts),k=({active:t,payload:e,label:r})=>{if(!t||!e||0===e.length)return null;const a=e[0].payload;return(0,j.jsxs)("div",{style:{padding:10,backgroundColor:"var(--chart-tooltip-bg)",border:"1px solid var(--chart-tooltip-border)",borderRadius:6,color:"var(--chart-tooltip-text)"},children:[(0,j.jsx)("strong",{children:a.name||r}),(0,j.jsxs)("p",{style:{margin:0},children:["Downloads: ",f(a.value)]})]})},w=({children:t,style:e})=>(0,j.jsx)("div",{style:{borderRadius:8,overflow:"hidden",border:"1px solid var(--chart-border)",backgroundColor:"var(--chart-card-bg)",transition:"var(--chart-transition)",...e},children:t}),S=({color:t,children:e})=>(0,j.jsx)("div",{style:{backgroundColor:t,color:"#ffffff",padding:"12px 16px",textTransform:"uppercase",fontWeight:"bold",fontSize:14,letterSpacing:"0.05em"},children:e}),A=({children:t})=>(0,j.jsx)("div",{style:{padding:24,textAlign:"center"},children:t}),D=()=>{const[t,e]=(0,a.useState)({loading:!0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),r=(0,a.useMemo)(()=>(0,b.A)(v.A),[]);(0,a.useEffect)(()=>{const t=window,r=t?.env?.SUPABASE_URL,a=t?.env?.SUPABASE_ANON_KEY;if(!r||!a){const t=Array.from({length:7}).map((t,e)=>({day:new Date(Date.now()-864e5*(6-e)).toISOString().split("T")[0],total:String(12+4*e)}));return void e({loading:!1,error:"Supabase variables missing \u2014 mock data enabled.",totalDownloads:42e4,byCategory:[{blueprint_category:"controllers",total:"232000"},{blueprint_category:"hooks",total:"140000"},{blueprint_category:"templates",total:"48000"}],topBlueprints:[{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"35000"}],daily:_(t)})}const o={"Content-Type":"application/json",apikey:a,Authorization:`Bearer ${a}`},i=async(t,e={})=>{const a=await fetch(`${r}/rest/v1/rpc/${t}`,{method:"POST",headers:o,body:JSON.stringify(e)});if(!a.ok)throw new Error(await a.text());return a.json()};(async()=>{try{const[t,r,a,o]=await Promise.all([i("get_total_downloads"),i("get_downloads_by_category"),i("get_top_blueprints"),i("get_daily_downloads",{p_days:30})]),n=Array.isArray(t)&&t.length>0?Number(t[0].total):Number(t);e({loading:!1,totalDownloads:n,byCategory:r,topBlueprints:a,daily:_(o)})}catch(t){e(e=>({...e,loading:!1,error:t.message||"Error loading metrics."}))}})()},[]);const{loading:D,error:C,totalDownloads:B,byCategory:T,topBlueprints:z,daily:W}=t,N=(0,a.useMemo)(()=>T.map(t=>({name:t.blueprint_category,category:t.blueprint_category,value:Number(t.total)})),[T]),E=(0,a.useMemo)(()=>z.slice(0,10).map(t=>({name:t.blueprint_id.length>40?`${t.blueprint_id.slice(0,37)}\u2026`:t.blueprint_id,value:Number(t.total)})).reverse(),[z]);return(0,j.jsx)(o.A,{title:"Blueprint Download Metrics",description:"Download metrics overview",children:(0,j.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:"var(--chart-bg)",padding:"2rem",minHeight:"100vh",color:"var(--chart-text-primary)",transition:"var(--chart-transition)"},children:[(0,j.jsx)("h1",{style:{textAlign:"center",marginBottom:32,fontWeight:"bold"},children:"Blueprint Metrics Dashboard"}),D&&(0,j.jsx)("p",{style:{textAlign:"center"},children:"Loading metrics..."}),!D&&C&&(0,j.jsxs)("div",{className:"alert alert--danger",children:[(0,j.jsx)("strong",{children:"Error loading metrics: "}),C]}),!D&&!C&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[(0,j.jsxs)(w,{children:[(0,j.jsx)(S,{color:"var(--chart-accent-1)",children:"Total Downloads"}),(0,j.jsx)(A,{children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:900,color:"var(--chart-accent-1)",margin:0},children:f(B)})})]}),(0,j.jsxs)(w,{children:[(0,j.jsx)(S,{color:"var(--chart-accent-2)",children:"Unique Categories"}),(0,j.jsx)(A,{children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:900,color:"var(--chart-accent-2)",margin:0},children:f(T.length)})})]}),(0,j.jsxs)(w,{children:[(0,j.jsx)(S,{color:"var(--chart-accent-3)",children:"Tracked Blueprints"}),(0,j.jsx)(A,{children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:900,color:"var(--chart-accent-3)",margin:0},children:f(z.length)})})]})]}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:24,marginTop:32},children:[(0,j.jsxs)(w,{children:[(0,j.jsx)("div",{style:{padding:"16px 16px",borderBottom:"1px solid var(--chart-border)",fontWeight:"bold"},children:"Daily Downloads"}),(0,j.jsx)("div",{style:{height:350,padding:10},children:(0,j.jsx)(l.u,{children:(0,j.jsxs)(u.Q,{data:W,children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"areaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:"var(--chart-accent-1)",stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:"var(--chart-accent-1)",stopOpacity:0})]})}),(0,j.jsx)(d.d,{stroke:"var(--chart-border)",strokeDasharray:"3 3"}),(0,j.jsx)(g.W,{dataKey:"label",stroke:"var(--chart-text-secondary)",tick:{fill:"var(--chart-text-secondary)",fontSize:10}}),(0,j.jsx)(x.h,{stroke:"var(--chart-text-secondary)",tick:{fill:"var(--chart-text-secondary)",fontSize:10},tickFormatter:f}),(0,j.jsx)(n.m,{content:(0,j.jsx)(k,{})}),(0,j.jsx)(h.Gk,{type:"monotone",dataKey:"total",stroke:"var(--chart-accent-1)",strokeWidth:3,fill:"url(#areaGradient)",isAnimationActive:!1})]})})})]}),(0,j.jsxs)(w,{children:[(0,j.jsx)("div",{style:{padding:"16px 16px",borderBottom:"1px solid var(--chart-border)",fontWeight:"bold"},children:"Category Distribution"}),(0,j.jsx)("div",{style:{height:350,padding:10},children:(0,j.jsx)(l.u,{children:(0,j.jsxs)(m.r,{children:[(0,j.jsx)(c.F,{data:N,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,label:({percent:t})=>`${(100*t).toFixed(0)}%`,labelLine:!1,isAnimationActive:!1,children:N.map((t,e)=>(0,j.jsx)(s.f,{fill:r(t.category),stroke:"var(--chart-pie-stroke)"},e))}),(0,j.jsx)(n.m,{content:(0,j.jsx)(k,{})}),(0,j.jsx)(i.s,{wrapperStyle:{fontSize:12}})]})})})]})]}),(0,j.jsx)("section",{style:{marginTop:32},children:(0,j.jsxs)(w,{children:[(0,j.jsx)("div",{style:{padding:"16px 16px",borderBottom:"1px solid var(--chart-border)",fontWeight:"bold"},children:"Top 10 Blueprints"}),(0,j.jsx)("div",{style:{height:Math.max(40*E.length,400),padding:10},children:(0,j.jsx)(l.u,{children:(0,j.jsxs)(y.E,{data:E,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,j.jsx)(d.d,{stroke:"var(--chart-border)",strokeDasharray:"3 3"}),(0,j.jsx)(g.W,{type:"number",tickFormatter:f,stroke:"var(--chart-text-secondary)",tick:{fill:"var(--chart-text-secondary)",fontSize:10}}),(0,j.jsx)(x.h,{dataKey:"name",type:"category",width:100,tick:{fill:"var(--chart-text-secondary)",fontSize:12},axisLine:!1,tickLine:!1}),(0,j.jsx)(n.m,{content:(0,j.jsx)(k,{})}),(0,j.jsx)(p.y,{dataKey:"value",fill:"var(--chart-accent-1)",barSize:20,radius:[0,4,4,0],isAnimationActive:!1})]})})})]})})]})]})})}}}]);