"use strict";(globalThis.webpackChunkawesome_ha_library_website=globalThis.webpackChunkawesome_ha_library_website||[]).push([[3825],{48654(e,t,r){r.r(t),r.d(t,{default:()=>S});var n=r(82128),i=r(95556),a=r(19527),s=r(77900);const l=({authState:e,authDispatch:t})=>{const{siteConfig:r}=(0,a.A)(),{SUPABASE_URL:l,SUPABASE_ANON_KEY:o}=r.customFields.env||{};if(!l||!o)throw new Error("Supabase environment variables are not configured");const d=(0,n.useMemo)(()=>(0,i.UU)(l,o),[l,o]),c=async()=>{t({type:"AUTH_START"});const{error:e}=await d.auth.signInWithOAuth({provider:"github",options:{redirectTo:window.location.origin+r.baseUrl+"contributors"}});e&&t({type:"AUTH_ERROR",error:e.message})};return(0,s.jsxs)("div",{className:"container padding-vert--lg",children:[(0,s.jsx)("h1",{children:"Welcome to Awesome HA Library Contributors Page"}),(0,s.jsxs)("div",{style:{marginTop:24,padding:24,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:8,maxWidth:520},children:["unauthenticated"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{children:"GitHub Authentication"}),(0,s.jsx)("p",{children:"Authenticate with GitHub to contribute. Authentication is handled using GitHub OAuth."}),(0,s.jsx)("button",{className:"button button--primary",onClick:c,children:"Authenticate with GitHub"})]}),"authenticating"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{children:"Authenticating\u2026"}),(0,s.jsx)("p",{children:"Please wait while GitHub authentication completes."})]}),"authenticated"===e.status&&e.user&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{children:"Authenticated"}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.user.avatar_url&&(0,s.jsx)("img",{src:e.user.avatar_url,alt:e.user.login,width:48,height:48,style:{borderRadius:"50%"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:e.user.name??e.user.login}),(0,s.jsx)("div",{children:(0,s.jsxs)("a",{href:e.user.html_url,target:"_blank",rel:"noopener noreferrer",children:["@",e.user.login]})})]})]}),(0,s.jsx)("div",{style:{marginTop:16},children:(0,s.jsx)("button",{className:"button button--secondary",onClick:async()=>{await d.auth.signOut(),t({type:"AUTH_LOGOUT"})},children:"Logout"})})]}),"error"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{children:"Authentication Error"}),(0,s.jsx)("p",{style:{color:"var(--ifm-color-danger)"},children:e.error}),(0,s.jsx)("button",{className:"button button--primary",onClick:c,children:"Try Again"})]})]})]})},o=[{type:"automation:new",label:"New Automation",description:"Submit a brand new automation blueprint"},{type:"controller:new",label:"New Controller",description:"Add support for a new physical controller device"},{type:"hook:new",label:"New Hook",description:"Create a reusable hook blueprint"},{type:"blueprint:update",label:"Update Existing Blueprint",description:"Improve or fix an existing blueprint"}],d=({disabled:e,onSelect:t})=>(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("h2",{children:"Choose Contribution Type"}),(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:16,marginTop:16,maxWidth:900},children:o.map(r=>(0,s.jsxs)("button",{disabled:e,onClick:()=>t(r.type),style:{textAlign:"left",padding:16,borderRadius:8,border:"1px solid var(--ifm-color-emphasis-300)",background:"var(--ifm-background-color)",cursor:e?"not-allowed":"pointer",opacity:e?.6:1},children:[(0,s.jsx)("strong",{children:r.label}),(0,s.jsx)("p",{style:{marginTop:6,fontSize:14,opacity:.8},children:r.description})]},r.type))})]});var c=r(33205);const u=({onParsed:e,onError:t})=>{const[r,i]=(0,n.useState)(null),[a,l]=(0,n.useState)("ready"),[o,d]=(0,n.useState)(null);return(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("h2",{children:"Upload YAML"}),(0,s.jsxs)("p",{children:["Upload your blueprint ",(0,s.jsx)("strong",{children:".yaml"})," / ",(0,s.jsx)("strong",{children:".yml"}),". We will extract name, domain, description, and inputs for a preview."]}),(0,s.jsx)("input",{type:"file",accept:".yaml,.yml",onChange:r=>{const n=r.target.files?.[0];n&&(i(n.name),(async r=>{try{l("parsing"),d(null);const t=await r.text(),n=function(e){return e.replace(/!input\s+/g,"")}(t),i=c.Ay.parse(n),a=i?.blueprint??{},s={name:"string"==typeof a?.name?a.name:null,domain:"string"==typeof a?.domain?a.domain:null,description:"string"==typeof a?.description?a.description:null,inputs:a?.input&&"object"==typeof a.input?Object.keys(a.input):[],raw:t,fileName:r.name};e(s),l("ready")}catch(n){const e=n?.message??"Failed to parse YAML";l("error"),d(e),t(e)}})(n))}}),(0,s.jsxs)("div",{style:{marginTop:10,fontSize:14},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Selected file:"})," ",r??"\u2014"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Status:"})," ","ready"===a?"Ready":"parsing"===a?"Parsing\u2026":"Error"]}),"error"===a&&o&&(0,s.jsxs)("div",{style:{marginTop:6,color:"var(--ifm-color-danger)"},children:[(0,s.jsx)("strong",{children:"Error:"})," ",o]})]})]})},p=({yaml:e})=>(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("h2",{children:"YAML Preview"}),(0,s.jsxs)("div",{style:{marginTop:12},children:[(0,s.jsx)("strong",{children:"Name:"})," ",e.name??"\u2014"]}),(0,s.jsxs)("div",{style:{marginTop:8},children:[(0,s.jsx)("strong",{children:"Domain:"})," ",e.domain??"\u2014"]}),(0,s.jsxs)("div",{style:{marginTop:12},children:[(0,s.jsx)("strong",{children:"Description:"}),(0,s.jsx)("div",{style:{marginTop:8,padding:12,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:6,whiteSpace:"pre-wrap",lineHeight:1.6},children:e.description??"\u2014"})]}),(0,s.jsxs)("div",{style:{marginTop:12},children:[(0,s.jsx)("strong",{children:"Inputs:"}),0===e.inputs.length?(0,s.jsx)("div",{style:{marginTop:6},children:"\u2014"}):(0,s.jsx)("ul",{style:{marginTop:6},children:e.inputs.map(e=>(0,s.jsx)("li",{children:e},e))})]})]}),m={status:"unauthenticated",user:null,error:null};function h(e,t){switch(t.type){case"AUTH_START":return"authenticated"===e.status?e:{status:"authenticating",user:null,error:null};case"AUTH_SUCCESS":return"authenticating"!==e.status&&"unauthenticated"!==e.status?e:{status:"authenticated",user:t.user,error:null};case"AUTH_ERROR":return"authenticating"!==e.status?e:{status:"error",user:null,error:t.error};case"AUTH_LOGOUT":return m;default:return e}}const g={status:"idle",type:null,yaml:null,error:null};function y(e,t){switch(t.type){case"SELECT_TYPE":return{status:"yaml_required",type:t.contribution,yaml:null,error:null};case"YAML_UPLOADED":return{status:"yaml_parsed",type:e.type,yaml:t.payload,error:null};case"YAML_ERROR":return{status:"error",type:e.type,yaml:null,error:t.error};case"RESET":return g;default:return e}}function x(e){const t=["EPMatt","yarafie",e.loggedInUser],r=new Set,n=[];for(const i of t){const e=String(i||"").trim();e&&(r.has(e)||(r.add(e),n.push({id:e,name:e})))}return n}function f(e){try{return"https:"===new URL(e).protocol}catch{return!1}}function j(e){return e.split(",").map(e=>e.trim()).filter(e=>e.length>0)}function v({draft:e,setDraft:t,isOwnerOverride:r}){const[i,a]=(0,n.useState)(null),[l,o]=(0,n.useState)(null),d=r,c=`${e.blueprint_id}.png`,u=`${e.blueprint_id}.pdf`,p=(0,n.useMemo)(()=>e.tags.join(", "),[e.tags]),m=(0,n.useMemo)(()=>e.librarians.map(e=>e.id).join(", "),[e.librarians]),h=(0,n.useMemo)(()=>e.external_references.every(e=>e.label.trim().length>0&&f(e.url)),[e.external_references]),g=(r,n)=>{const i=e.external_references.map((e,t)=>t===r?{...e,...n}:e);t({...e,external_references:i})};return(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("h2",{children:"Complete Metadata"}),(0,s.jsxs)("div",{style:{marginTop:16,padding:16,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:8,maxWidth:900},children:[(0,s.jsx)("h3",{style:{marginTop:0},children:"Blueprint Metadata (automation)"}),(0,s.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"blueprint_id (derived; must be unique across controllers/hooks/automations)"}),(0,s.jsx)("input",{value:e.blueprint_id,disabled:!d,onChange:r=>t({...e,blueprint_id:r.target.value}),style:{width:"100%",padding:10}}),!d&&(0,s.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["Derived from YAML name (lowercase, spaces \u2192 _). Only"," ",(0,s.jsx)("strong",{children:"yarafie"})," can override."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"name (from YAML)"}),(0,s.jsx)("input",{value:e.name,disabled:!d,onChange:r=>t({...e,name:r.target.value}),style:{width:"100%",padding:10}}),!d&&(0,s.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["From YAML. Only ",(0,s.jsx)("strong",{children:"yarafie"})," can override."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"description (from YAML: first complete sentence not starting with #)"}),(0,s.jsx)("textarea",{value:e.description,disabled:!d,onChange:r=>t({...e,description:r.target.value}),rows:3,style:{width:"100%",padding:10}}),!d&&(0,s.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["Derived from YAML. Only ",(0,s.jsx)("strong",{children:"yarafie"})," can override."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"category (locked)"}),(0,s.jsx)("input",{value:e.category,disabled:!0,style:{width:"100%",padding:10}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"status (schema enum: active | deprecated)"}),(0,s.jsxs)("select",{value:e.status,disabled:!d,onChange:r=>(r=>{const n="deprecated"===r?"deprecated":"active";t({...e,status:n})})(r.target.value),style:{width:"100%",padding:10},children:[(0,s.jsx)("option",{value:"active",children:"active"}),(0,s.jsx)("option",{value:"deprecated",children:"deprecated"})]}),!d&&(0,s.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["Default ",(0,s.jsx)("strong",{children:"active"}),". Only ",(0,s.jsx)("strong",{children:"yarafie"})," ","can change."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"librarians (locked order; unique): EPMatt, yarafie, logged-in user"}),(0,s.jsx)("input",{value:m,disabled:!0,style:{width:"100%",padding:10}}),(0,s.jsx)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:"Read-only (always derived). Stored as array of objects in payload."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"tags (comma separated; free form)"}),(0,s.jsx)("input",{value:p,onChange:r=>{return n=r.target.value,void t({...e,tags:j(n)});var n},style:{width:"100%",padding:10}})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:["images (PNG only; renamed internally to ",c,")"]}),(0,s.jsx)("input",{type:"file",accept:"image/png",onChange:r=>(r=>{if(!r)return a(null),void t({...e,images:[]});if(!r.name.toLowerCase().endsWith(".png"))return a(null),void t({...e,images:[]});a(r),t({...e,images:[c]})})(r.target.files?.[0]??null)}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:13},children:[(0,s.jsx)("strong",{children:"Selected:"})," ",i?i.name:"\u2014",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Will be stored as:"})," ",e.images.length?e.images[0]:"\u2014"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:["manual_files (optional PDF only; renamed internally to"," ",u,")"]}),(0,s.jsx)("input",{type:"file",accept:"application/pdf",onChange:r=>(r=>{if(!r)return o(null),void t({...e,manual_files:[]});if(!r.name.toLowerCase().endsWith(".pdf"))return o(null),void t({...e,manual_files:[]});o(r),t({...e,manual_files:[u]})})(r.target.files?.[0]??null)}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:13},children:[(0,s.jsx)("strong",{children:"Selected:"})," ",l?l.name:"\u2014",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Will be stored as:"})," ",e.manual_files.length?e.manual_files[0]:"\u2014"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:10},children:"external_references (optional; valid https links)"}),0===e.external_references.length&&(0,s.jsx)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:"No external references added."}),e.external_references.map((r,n)=>{const i=r.label.trim().length>0&&f(r.url);return(0,s.jsx)("div",{style:{border:"1px dashed var(--ifm-color-emphasis-300)",borderRadius:8,padding:12,marginBottom:10},children:(0,s.jsxs)("div",{style:{display:"grid",gap:10},children:[(0,s.jsx)("input",{placeholder:"Label (e.g. Docs, Source, PR #123)",value:r.label,onChange:e=>g(n,{label:e.target.value}),style:{width:"100%",padding:10}}),(0,s.jsx)("input",{placeholder:"https://example.com",value:r.url,onChange:e=>g(n,{url:e.target.value}),style:{width:"100%",padding:10}}),(0,s.jsxs)("div",{style:{fontSize:12,opacity:.8},children:["Status:"," ",i?"valid \u2705":"invalid \u274c (label + https url required)"]}),(0,s.jsx)("button",{className:"button button--secondary",onClick:()=>(r=>{const n=e.external_references.filter((e,t)=>t!==r);t({...e,external_references:n})})(n),type:"button",style:{width:"fit-content"},children:"Remove"})]})},n)}),(0,s.jsx)("button",{className:"button button--primary",onClick:()=>{const r=[...e.external_references,{label:"",url:""}];t({...e,external_references:r})},type:"button",style:{width:"fit-content"},children:"Add External Reference"}),!h&&e.external_references.length>0&&(0,s.jsx)("div",{style:{marginTop:10,fontSize:12,color:"var(--ifm-color-danger)"},children:"Some external references are invalid. Each must have a label and an https URL."})]}),(0,s.jsx)("div",{style:{fontSize:12,opacity:.65},children:"supported_integrations: hidden (not required for automations)"})]})]})]})}function b(e){const t=function(e){const t={blueprint_id:e.draft.blueprint_id,name:e.draft.name,description:e.draft.description,category:"automations",status:e.draft.status,librarians:e.draft.librarians.map(e=>({...e}))};return e.draft.tags.length&&(t.tags=[...e.draft.tags]),e.draft.images.length&&(t.images=[...e.draft.images]),e.draft.manual_files.length&&(t.manual_files=[...e.draft.manual_files]),e.draft.external_references.length&&(t.external_references=e.draft.external_references.map(e=>({label:e.label,url:e.url}))),{kind:"phase6_payload_preview_v1",blueprint:{blueprint_json:t},yaml:{file_name:e.yaml.fileName,raw:e.yaml.raw,derived_preview:{name:e.yaml.name,domain:e.yaml.domain,inputs:e.yaml.inputs}},assets:{image_png:e.draft.images.length?e.draft.images[0]:null,manual_pdf:e.draft.manual_files.length?e.draft.manual_files[0]:null}}}({draft:e.draft,yaml:e.yaml});return(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("h2",{children:"Phase 6 Payload Preview"}),(0,s.jsx)("div",{style:{marginTop:12,padding:16,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:8,maxWidth:1e3},children:(0,s.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:12,lineHeight:1.35},children:JSON.stringify(t,null,2)})})]})}const _=()=>{const{siteConfig:e}=(0,a.A)(),{SUPABASE_URL:t,SUPABASE_ANON_KEY:r}=e.customFields.env||{};if(!t||!r)throw new Error("Supabase environment variables are not configured");const o=(0,n.useMemo)(()=>(0,i.UU)(t,r),[t,r]),[c,f]=(0,n.useReducer)(h,m),[j,_]=(0,n.useReducer)(y,g),S=e=>{const t=e.user.user_metadata||{};t.user_name&&t.provider_id&&f({type:"AUTH_SUCCESS",user:{id:Number(t.provider_id),login:t.user_name,name:t.full_name,avatar_url:t.avatar_url,html_url:`https://github.com/${t.user_name}`}})};(0,n.useEffect)(()=>{o.auth.getSession().then(({data:e})=>{e.session&&S(e.session)});const{data:{subscription:e}}=o.auth.onAuthStateChange((e,t)=>{t?S(t):f({type:"AUTH_LOGOUT"})});return()=>e.unsubscribe()},[o]);const w=c.user?.login??"",A="yarafie"===w,[T,C]=(0,n.useState)(null),[E,U]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if("yaml_parsed"!==j.status)return;if(!j.yaml)return;if(!w)return;const e=function(e){const t=(e.yamlName||"").trim(),r=function(e){return e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")}(t||"new_blueprint");return{blueprint_id:r,name:t||"",description:(e.yamlDescription?function(e){const t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n").map(e=>e.trim()).filter(e=>e.length>0).filter(e=>!e.startsWith("#"));if(0===t.length)return"";let r="";for(const n of t){r=r?`${r} ${n}`:n;const e=r.match(/^(.+?[.!?])(\s|$)/);if(e&&e[1])return e[1].trim()}return t[0].trim()}(e.yamlDescription):"")||"",category:"automations",status:"active",tags:[],images:[`${r}.png`],manual_files:[],external_references:[],librarians:x({loggedInUser:e.loggedInUser})}}({yamlName:j.yaml.name,yamlDescription:j.yaml.description,loggedInUser:w});C(e),U(!1)},[j.status,j.yaml,w]);const R=(0,n.useMemo)(()=>"yaml_parsed"===j.status&&!!j.yaml,[j.status,j.yaml]),N=(0,n.useMemo)(()=>!!j.yaml&&(!!T&&(!!T.blueprint_id.trim()&&(!!T.name.trim()&&(!!T.description.trim()&&!!T.images.length)))),[j.yaml,T]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l,{authState:c,authDispatch:f}),"authenticated"===c.status&&(0,s.jsxs)(s.Fragment,{children:["idle"===j.status&&(0,s.jsx)(d,{disabled:!1,onSelect:e=>_({type:"SELECT_TYPE",contribution:e})}),"yaml_required"===j.status&&(0,s.jsx)(u,{onParsed:e=>_({type:"YAML_UPLOADED",payload:e}),onError:e=>_({type:"YAML_ERROR",error:e})}),"error"===j.status&&(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("h2",{children:"Upload Error"}),(0,s.jsx)("p",{style:{color:"var(--ifm-color-danger)"},children:j.error}),(0,s.jsx)("button",{className:"button button--secondary",onClick:()=>_({type:"RESET"}),children:"Start Over"})]}),R&&j.yaml&&T&&(0,s.jsx)(s.Fragment,{children:E?(0,s.jsx)(b,{draft:T,yaml:j.yaml}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v,{draft:T,setDraft:C,isOwnerOverride:A}),(0,s.jsx)(p,{yaml:j.yaml}),(0,s.jsxs)("section",{className:"container padding-vert--lg",children:[(0,s.jsx)("button",{className:"button button--primary",disabled:!N,onClick:()=>U(!0),children:"Submit (Preview Phase 6 Payload)"}),!N&&(0,s.jsx)("div",{style:{marginTop:10,fontSize:12,opacity:.75},children:"Submit is disabled until required Blueprint Metadata is complete (name, description, blueprint_id, and PNG image)."})]})]})})]}),"authenticated"!==c.status&&(0,s.jsx)("section",{className:"container padding-vert--lg",children:(0,s.jsx)("p",{style:{opacity:.7},children:"Please authenticate with GitHub to begin contributing."})})]})},S=()=>(0,s.jsx)("main",{children:(0,s.jsx)(_,{})})}}]);