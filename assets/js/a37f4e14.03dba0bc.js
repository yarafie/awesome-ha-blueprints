"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var o=r(3303),a=r(1153),i=r(6285),n=r(4538),l=r(162),d=r(656),s=r(351),c=r(6605),g=r(9441),x=r(2782),p=r(7342),h=r(2941),b=r(2454),y=r(7263),u=r(50),m=r(1929),f=r(1778),j=r(7711);const w=e=>e.toLocaleString(),S=e=>e.map(e=>{return{label:(t=e.day,new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric"})),total:Number(e.total),ts:new Date(e.day).getTime()};var t}).sort((e,t)=>e.ts-t.ts),k=({children:e,style:t})=>(0,j.jsx)("div",{style:t,children:e}),v=({color:e,children:t})=>(0,j.jsx)("div",{style:{backgroundColor:e,color:"#ffffff",padding:"12px 16px",textTransform:"uppercase",fontWeight:"bold",fontSize:14,letterSpacing:"0.05em"},children:t}),_=({children:e})=>(0,j.jsx)("div",{style:{padding:24,textAlign:"center"},children:e}),B=()=>{const[e,t]=(0,o.useState)(!1);(0,o.useEffect)(()=>{const e=()=>{t("dark"===document.documentElement.getAttribute("data-theme"))};e();const r=new MutationObserver(()=>e());return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[]);const[r,B]=(0,o.useState)({loading:!0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),C=(0,o.useMemo)(()=>(0,m.A)(f.A),[]),A=e?"#818cf8":"#4f46e5",D=(0,o.useMemo)(()=>({bg:e?"#1b1b1d":"#f9fafb",cardBg:e?"#242526":"#ffffff",textPrimary:e?"#e5e7eb":"#1f2937",textSecondary:e?"#9ca3af":"#6b7280",gridLine:e?"#444444":"#e5e7eb",tooltipBg:e?"#242526":"#ffffff",tooltipBorder:e?"#444444":"#cccccc",tooltipText:e?"#e5e7eb":"#333333",cardBorder:e?"1px solid #333333":"none",boxShadow:e?"0 4px 6px rgba(0,0,0,0.4)":"0 4px 6px rgba(0,0,0,0.1)"}),[e]),T=({active:e,payload:t,label:r})=>{if(!e||!t||0===t.length)return null;const o=t[0].payload;return(0,j.jsxs)("div",{style:{padding:10,backgroundColor:D.tooltipBg,border:`1px solid ${D.tooltipBorder}`,borderRadius:6,color:D.tooltipText},children:[(0,j.jsx)("strong",{children:o.name||r}),(0,j.jsxs)("p",{style:{margin:0},children:["Downloads: ",w(o.value??t[0].value??0)]})]})};(0,o.useEffect)(()=>{const e=window,t=e.env?.SUPABASE_URL,r=e.env?.SUPABASE_ANON_KEY;if(!t||!r){const e=Array.from({length:7}).map((e,t)=>({day:new Date(Date.now()-864e5*(6-t)).toISOString().split("T")[0],total:String(10+5*t)}));return void B({loading:!1,error:"Supabase variables missing \u2014 mock data enabled.",totalDownloads:42e4,byCategory:[{blueprint_category:"controllers",total:"232000"},{blueprint_category:"hooks",total:"140000"},{blueprint_category:"templates",total:"48000"}],topBlueprints:[{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"35000"}],daily:S(e)})}const o={"Content-Type":"application/json",apikey:r,Authorization:`Bearer ${r}`},a=async(e,r={})=>{const a=await fetch(`${t}/rest/v1/rpc/${e}`,{method:"POST",headers:o,body:JSON.stringify(r)});if(!a.ok)throw new Error(await a.text());return await a.json()};(async()=>{try{const[e,t,r,o]=await Promise.all([a("get_total_downloads"),a("get_downloads_by_category"),a("get_top_blueprints"),a("get_daily_downloads",{p_days:30})]);let i=0;Array.isArray(e)&&"total"in e[0]?i=Number(e[0].total):"number"==typeof e&&(i=e),B({loading:!1,totalDownloads:i,byCategory:t,topBlueprints:r,daily:S(o)})}catch(e){const t=e instanceof Error?e.message:"Error loading metrics.";B(e=>({...e,loading:!1,error:t}))}})()},[]);const{loading:L,error:E,totalDownloads:z,byCategory:W,topBlueprints:R,daily:N}=r,$=(0,o.useMemo)(()=>W.map(e=>({name:e.blueprint_category,category:e.blueprint_category,value:Number(e.total)})),[W]),M=(0,o.useMemo)(()=>R.slice(0,10).map(e=>({name:e.blueprint_id.length>40?`${e.blueprint_id.slice(0,37)}\u2026`:e.blueprint_id,value:Number(e.total)})).reverse(),[R]);return(0,j.jsx)(a.A,{title:"Blueprint Download Metrics",description:"Download metrics overview",children:(0,j.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:D.bg,padding:"2rem",minHeight:"100vh",color:D.textPrimary,transition:"background-color 0.25s ease, color 0.25s ease"},children:[(0,j.jsx)("h1",{style:{textAlign:"center",marginBottom:32,fontWeight:"bold"},children:"Blueprint Metrics Dashboard"}),L&&(0,j.jsx)("p",{style:{textAlign:"center"},children:"Loading metrics..."}),!L&&E&&(0,j.jsxs)("div",{className:"alert alert--danger",children:[(0,j.jsx)("strong",{children:"Error:"})," ",E]}),!L&&!E&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[(0,j.jsxs)(k,{style:{backgroundColor:D.cardBg,border:D.cardBorder,borderRadius:8,boxShadow:D.boxShadow},children:[(0,j.jsx)(v,{color:"#4f46e5",children:"Total Downloads"}),(0,j.jsx)(_,{children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:900,color:"#4f46e5",margin:0},children:w(z)})})]}),(0,j.jsxs)(k,{style:{backgroundColor:D.cardBg,border:D.cardBorder,borderRadius:8,boxShadow:D.boxShadow},children:[(0,j.jsx)(v,{color:"#0d9488",children:"Unique Categories"}),(0,j.jsx)(_,{children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:900,color:"#0d9488",margin:0},children:w(W.length)})})]}),(0,j.jsxs)(k,{style:{backgroundColor:D.cardBg,border:D.cardBorder,borderRadius:8,boxShadow:D.boxShadow},children:[(0,j.jsx)(v,{color:"#9333ea",children:"Tracked Blueprints"}),(0,j.jsx)(_,{children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:900,color:"#9333ea",margin:0},children:w(R.length)})})]})]}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:24,marginTop:32},children:[(0,j.jsxs)(k,{style:{backgroundColor:D.cardBg,border:D.cardBorder,borderRadius:8,boxShadow:D.boxShadow},children:[(0,j.jsx)("div",{style:{padding:"16px 16px",borderBottom:`1px solid ${D.gridLine}`,fontWeight:"bold"},children:"Daily Downloads"}),(0,j.jsx)("div",{style:{height:350,padding:10},children:(0,j.jsx)(l.u,{children:(0,j.jsxs)(u.Q,{data:N,children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"areaGradientC",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:A,stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:A,stopOpacity:0})]})}),(0,j.jsx)(c.d,{stroke:D.gridLine,strokeDasharray:"3 3"}),(0,j.jsx)(p.W,{dataKey:"label",stroke:D.textSecondary,tick:{fill:D.textSecondary,fontSize:10}}),(0,j.jsx)(h.h,{stroke:D.textSecondary,tick:{fill:D.textSecondary,fontSize:10},tickFormatter:w}),(0,j.jsx)(n.m,{content:(0,j.jsx)(T,{})}),(0,j.jsx)(g.Gk,{type:"monotone",dataKey:"total",stroke:A,strokeWidth:3,fill:"url(#areaGradientC)",isAnimationActive:!1})]})})})]}),(0,j.jsxs)(k,{style:{backgroundColor:D.cardBg,border:D.cardBorder,borderRadius:8,boxShadow:D.boxShadow},children:[(0,j.jsx)("div",{style:{padding:"16px 16px",borderBottom:`1px solid ${D.gridLine}`,fontWeight:"bold"},children:"Category Distribution"}),(0,j.jsx)("div",{style:{height:350,padding:10},children:(0,j.jsx)(l.u,{children:(0,j.jsxs)(y.r,{children:[(0,j.jsx)(s.F,{data:$,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,label:({percent:e})=>`${(100*e).toFixed(0)}%`,labelLine:!1,isAnimationActive:!1,children:$.map(t=>(0,j.jsx)(d.f,{fill:C(t.category),stroke:e?"#242526":"#ffffff"},t.name))}),(0,j.jsx)(n.m,{content:(0,j.jsx)(T,{})}),(0,j.jsx)(i.s,{wrapperStyle:{fontSize:12,color:D.textPrimary}})]})})})]})]}),(0,j.jsx)("section",{style:{marginTop:32},children:(0,j.jsxs)(k,{style:{backgroundColor:D.cardBg,border:D.cardBorder,borderRadius:8,boxShadow:D.boxShadow},children:[(0,j.jsx)("div",{style:{padding:"16px 16px",borderBottom:`1px solid ${D.gridLine}`,fontWeight:"bold"},children:"Top 10 Blueprints"}),(0,j.jsx)("div",{style:{height:Math.max(40*M.length,400),padding:10},children:(0,j.jsx)(l.u,{children:(0,j.jsxs)(b.E,{data:M,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,j.jsx)(c.d,{stroke:D.gridLine,strokeDasharray:"3 3"}),(0,j.jsx)(p.W,{type:"number",tickFormatter:w,stroke:D.textSecondary,tick:{fill:D.textSecondary,fontSize:10}}),(0,j.jsx)(h.h,{dataKey:"name",type:"category",width:100,tick:{fill:D.textSecondary,fontSize:12},axisLine:!1,tickLine:!1}),(0,j.jsx)(n.m,{content:(0,j.jsx)(T,{})}),(0,j.jsx)(x.y,{dataKey:"value",fill:A,barSize:20,radius:[0,4,4,0],isAnimationActive:!1})]})})})]})})]})]})})}}}]);