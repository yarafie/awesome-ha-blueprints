"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,r)=>{r.r(e),r.d(e,{default:()=>w});var o=r(3303),a=r(1153),i=r(6285),n=r(4538),l=r(162),s=r(656),d=r(351),c=r(6605),p=r(9441),h=r(2782),y=r(7342),g=r(2941),x=r(2454),u=r(7263),m=r(50),b=r(1929),f=r(1778),j=r(7711);const w=()=>{const[t,e]=(0,o.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),[r,w]=(0,o.useState)(!1),{loading:v,error:S,totalDownloads:_,byCategory:k,topBlueprints:D,daily:B}=t,A=(0,b.A)(f.A);(0,o.useEffect)(()=>{const t=()=>{const t=document.documentElement.getAttribute("data-theme");w("dark"===t)};t();const e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"data-theme"===e.attributeName&&t()})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,o.useEffect)(()=>{const t=window?.env?.SUPABASE_URL,r=window?.env?.SUPABASE_ANON_KEY,o=t=>t.toLocaleDateString(void 0,{month:"short",day:"numeric"}),a=t=>t.toISOString().split("T")[0],i=(t,e=15)=>{const r=new Map(t.map(t=>[t.day,Number(t.total)])),i=[],n=new Date;for(let l=e-1;l>=0;l--){const t=new Date(n);t.setDate(n.getDate()-l);const e=a(t),s=r.get(e)||0;i.push({label:o(t),total:s})}return i};if(!t||!r){const t=1234567,r=[{blueprint_category:"controllers",total:"900000"},{blueprint_category:"hooks",total:"280000"},{blueprint_category:"templates",total:"54000"}],o=[{blueprint_category:"hooks",blueprint_id:"thertetsat_controlv2_30_days_ago",total:"50000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"45000"},{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"}],n=[{day:a(new Date(Date.now()-864e6)),total:"10"},{day:a(new Date(Date.now()-432e6)),total:"20"},{day:a(new Date),total:"22"}],l=i(n,15);return void e(e=>({...e,loading:!1,error:"Supabase variables missing. Showing mock data.",totalDownloads:t,byCategory:r,topBlueprints:o,daily:l}))}const n={"Content-Type":"application/json",apikey:r,Authorization:"Bearer "+r},l=async(t,e,r=3)=>{for(let o=0;o<r;o++)try{const a=await fetch(t,e);if(a.ok)return a;if(429===a.status&&o<r-1){const t=1e3*Math.pow(2,o)+1e3*Math.random();await new Promise(e=>setTimeout(e,t));continue}{const t=await a.text();throw new Error(`HTTP error! Status: ${a.status}. Response: ${t.substring(0,100)}...`)}}catch(S){if(o===r-1)throw S}};!async function(){try{const[r,o,a,s]=await Promise.all([l(`${t}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:n,body:JSON.stringify({})}),l(`${t}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:n,body:JSON.stringify({})}),l(`${t}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:n,body:JSON.stringify({})}),l(`${t}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:n,body:JSON.stringify({p_days:15})})]),d=await r.json(),c=await o.json(),p=await a.json(),h=await s.json();let y=0;Array.isArray(d)&&d.length>0?y=Number(d[0].total):"number"==typeof d&&(y=d);const g=Array.isArray(c)?c:[],x=Array.isArray(p)?p:[],u=i(Array.isArray(h)?h:[],15);e({loading:!1,error:void 0,totalDownloads:y,byCategory:g,topBlueprints:x,daily:u})}catch(r){console.error("Error fetching download metrics",r),e(t=>({...t,loading:!1,error:`Failed to load metrics from Supabase. Error: ${r.message||"Unknown error."}`}))}}()},[]);const T=t=>t.toLocaleString(),C=k.map(t=>({name:t.blueprint_category,category:t.blueprint_category,value:Number(t.total),total:Number(t.total),label:t.blueprint_category})),N=D.slice(0,10).map(t=>({id:t.blueprint_id,name:t.blueprint_id.length>40?t.blueprint_id.substring(0,37)+"...":t.blueprint_id,value:Number(t.total)})),P={bg:r?"#1b1b1d":"#f9fafb",cardBg:r?"#242526":"#ffffff",textPrimary:r?"#e5e7eb":"#1f2937",textSecondary:r?"#9ca3af":"#6b7280",gridLine:r?"#444":"#e5e7eb",tooltipBg:r?"#242526":"#ffffff",tooltipBorder:r?"#444":"#ccc",tooltipText:r?"#e5e7eb":"#333"},E=({active:t,payload:e,label:r})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,j.jsxs)("div",{style:{padding:"10px",backgroundColor:P.tooltipBg,border:`1px solid ${P.tooltipBorder}`,borderRadius:"5px",color:P.tooltipText},children:[(0,j.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:t.name||t.id||r}),(0,j.jsxs)("p",{children:["Downloads: ",T(t.value||e[0].value)]})]})}return null},z=t=>{const{x:e,y:r,payload:o}=t;return(0,j.jsx)("g",{transform:`translate(${e},${r})`,children:(0,j.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:P.textSecondary,fontSize:10,title:o.value,children:o.value})})},L={backgroundColor:P.cardBg,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:P.textPrimary,minWidth:"0",border:r?"1px solid #333":"none"},O=t=>({backgroundColor:t,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),$={padding:"24px",textAlign:"center"},W={padding:"16px",borderBottom:`1px solid ${P.gridLine}`,margin:0,fontSize:"1.25rem",color:P.textPrimary,fontWeight:"bold"};return(0,j.jsx)(a.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,j.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:P.bg,transition:"background-color 0.3s ease",minHeight:"100vh",padding:"2rem"},children:[(0,j.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold",color:P.textPrimary},children:"Blueprint Metrics Dashboard"}),v&&(0,j.jsx)("div",{style:{textAlign:"center",color:P.textPrimary},children:"Loading metrics..."}),!v&&S&&(0,j.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,j.jsx)("h4",{className:"alert__heading",children:"Error loading metrics"}),(0,j.jsx)("p",{children:S})]}),!v&&!S&&(0,j.jsxs)("div",{style:{width:"100%",overflowX:"auto"},children:[(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:L,children:[(0,j.jsx)("div",{style:O("#4f46e5"),children:"Total Downloads"}),(0,j.jsx)("div",{style:$,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#4f46e5",margin:0},children:T(_)})})]}),(0,j.jsxs)("div",{style:L,children:[(0,j.jsx)("div",{style:O("#9333ea"),children:"Tracked Blueprints"}),(0,j.jsx)("div",{style:$,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:T(D.length)})})]})]}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:L,children:[(0,j.jsx)("h3",{style:W,children:"Daily Downloads (Last 15 Days)"}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(m.Q,{data:B,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,j.jsx)(c.d,{strokeDasharray:"3 3",stroke:P.gridLine,vertical:!1}),(0,j.jsx)(y.W,{dataKey:"label",stroke:P.textSecondary,tick:{fontSize:10,fill:P.textSecondary}}),(0,j.jsx)(g.h,{allowDecimals:!1,stroke:P.textSecondary,tick:{fontSize:10,fill:P.textSecondary},tickFormatter:T}),(0,j.jsx)(n.m,{content:(0,j.jsx)(E,{})}),(0,j.jsx)(p.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)"})]})})})]}),(0,j.jsxs)("div",{style:L,children:[(0,j.jsx)("h3",{style:W,children:"Category Distribution"}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(u.r,{children:[(0,j.jsx)(d.F,{data:C,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:t})=>`${(100*t).toFixed(0)}%`,children:C.map((t,e)=>(0,j.jsx)(s.f,{fill:A(t.category),stroke:r?"#242526":"#fff"},`cell-${e}`))}),(0,j.jsx)(n.m,{content:(0,j.jsx)(E,{})}),(0,j.jsx)(i.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:P.textPrimary}})]})})})]})]}),(0,j.jsxs)("section",{style:{...L,paddingBottom:"20px"},children:[(0,j.jsx)("h3",{style:{...W,marginBottom:"20px",borderBottom:"none"},children:"Top 10 Blueprints (Highest to Lowest)"}),(0,j.jsx)("div",{style:{height:Math.max(400,40*N.length)},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(x.E,{data:N,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,j.jsx)(c.d,{strokeDasharray:"3 3",horizontal:!1,stroke:P.gridLine}),(0,j.jsx)(y.W,{type:"number",stroke:P.textSecondary,tick:{fontSize:10,fill:P.textSecondary},tickFormatter:T}),(0,j.jsx)(g.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,j.jsx)(z,{})}),(0,j.jsx)(n.m,{content:(0,j.jsx)(E,{})}),(0,j.jsx)(h.y,{dataKey:"value",fill:A("top10"),barSize:20,radius:[0,4,4,0]})]})})})]})]})]})})}}}]);