"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[2574],{1170:(e,r,n)=>{n.d(r,{Dk:()=>s,PG:()=>d});var t=n(78570),o=n(4784);let i=null;const a=()=>{if(i)return i;const e=(o.default?.customFields||{}).env||{},r=e.SUPABASE_URL,n=e.SUPABASE_ANON_KEY;return r&&n&&l({supabaseUrl:r,supabaseKey:n}),i},l=({supabaseUrl:e,supabaseKey:r})=>{i=(0,t.UU)(e,r),console.log("Supabase initialized")},s=async(e,r,n="latest",t=null)=>{if(!a())return console.error("Supabase client not initialized"),!1;try{const{error:o}=await i.from("blueprint_downloads").insert([{blueprint_category:e,blueprint_id:r,blueprint_version:n,blueprint_variant:t,download_date:(new Date).toISOString()}]);return!o||(console.error("Error recording blueprint download:",o),!1)}catch(o){return console.error("Exception recording blueprint download:",o),!1}},d=async(e,r,n=null,t=null)=>{if(!a())return console.error("Supabase client not initialized"),0;try{const{data:o,error:a}=await i.rpc("get_blueprint_downloads",{p_category:e,p_id:r,p_variant:n,p_version:t});return a?(console.error("Error getting blueprint downloads via RPC:",a),0):"number"==typeof o?o:0}catch(o){return console.error("Exception getting blueprint downloads:",o),0}}},22122:(e,r,n)=>{n.r(r),n.d(r,{default:()=>d});var t=n(23303),o=n(50402),i=n(54185),a=n(63883),l=n(1170),s=n(27711);function d(e){const r=e.route.category,n=e.route.id,{consent:d}=(0,i.S)(),c=(()=>{if("undefined"!=typeof window){return new URLSearchParams(window.location.search).get("version")||"latest"}return"latest"})();let u=(()=>{if("undefined"!=typeof window){const r=new URLSearchParams(window.location.search).get("variant");return r&&r.trim().length>0?r:e.route.variant||null}return e.route.variant||null})();"controllers"===r&&!u&&e.route.variantsById&&1===Object.keys(e.route.variantsById).length&&(u=Object.keys(e.route.variantsById)[0]),"controllers"!==r&&(u="EPMatt");let p,w=c;if("controllers"===r&&"latest"===w&&u&&e.route.variantsById?.[u]?.length){w=[...e.route.variantsById[u]].sort((e,r)=>r.localeCompare(e))[0]}if("controllers"===r){u||"undefined"==typeof window||console.error("Missing variant for controller download route.");p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${`${u}/${w}/${n}.yaml`}`}else p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${n}.yaml`;const b="https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url="+encodeURIComponent(p),h=w;return(0,t.useEffect)(()=>{if("undefined"!=typeof window){if(window.__blueprintDownloadHandled)return;window.__blueprintDownloadHandled=!0}d&&(0,a.sx)("blueprint","download","controllers"===r?`${r}/${n}/${u}/${h}`:`${r}/${n}`,void 0);const e={category:r,id:n,variant:u||null,version:h};(0,l.Dk)(e.category,e.id,e.version,e.variant).then(e=>{e||console.error("Failed to record blueprint download in database")}).catch(e=>{console.error("Error recording blueprint download:",e)}).finally(()=>{(e=>{try{const r="my.home-assistant.io";new URL(e).hostname===r?window.location.href=e:console.error("Unsafe redirect blocked:",e)}catch{console.error("Invalid redirect URL:",e)}})(b)})},[d,r,n,u,h,b]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{children:(0,s.jsxs)("title",{children:["Download ",r,"/",n,w?`/${w}`:"",u?`/${u}`:""]})}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"20px"},children:[(0,s.jsx)("h1",{children:"Thanks for downloading!"}),(0,s.jsx)("p",{children:"Redirecting to your Home Assistant instance..."})]})]})}}}]);