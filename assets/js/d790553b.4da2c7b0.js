"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[2574],{1170:(e,r,n)=>{n.d(r,{Dk:()=>s,PG:()=>d,fY:()=>c,zN:()=>u});var t=n(8445),o=n(4784);let a=null;const i=()=>{if(a)return a;const e=(o.default?.customFields||{}).env||{},r=e.SUPABASE_URL,n=e.SUPABASE_ANON_KEY;return r&&n&&l({supabaseUrl:r,supabaseKey:n}),a},l=({supabaseUrl:e,supabaseKey:r})=>{a=(0,t.UU)(e,r),console.log("Supabase initialized")},s=async(e,r,n=null,t="latest")=>{const o=i();if(!o)return console.error("[Supabase] recordBlueprintDownload: client not initialized"),!1;try{const{error:a}=await o.from("blueprint_downloads").insert([{blueprint_category:e,blueprint_id:r,blueprint_variant:n,blueprint_version:t,download_date:(new Date).toISOString()}]);return!a||(console.error("[Supabase] Error recording blueprint download:",a),!1)}catch(a){return console.error("[Supabase] Exception recording blueprint download:",a),!1}},d=async(e,r,n=null,t=null)=>{const o=i();if(!o)return console.error("[Supabase] getBlueprintDownloads: client not initialized"),0;try{const{data:a,error:i}=await o.rpc("get_blueprint_downloads",{p_category:e,p_id:r,p_variant:n,p_version:t});return i?(console.error("[Supabase] Error in getBlueprintDownloads RPC:",i),0):"number"==typeof a?a:Number(a??0)}catch(a){return console.error("[Supabase] Exception in getBlueprintDownloads:",a),0}},c=async(e={})=>{const r=i();if(!r)return console.error("[Supabase] getDownloadAggregates: client not initialized"),[];const{category:n=null,id:t=null,variant:o=null}=e;try{const{data:e,error:a}=await r.rpc("get_download_aggregates",{p_category:n,p_variant:o,p_id:t});return a?(console.error("[Supabase] Error in getDownloadAggregates RPC:",a),[]):(e||[]).map(e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_variant:e.blueprint_variant??null,total:Number(e.total_downloads??0),last_downloaded:e.last_downloaded?new Date(e.last_downloaded).toISOString():null}))}catch(a){return console.error("[Supabase] Exception in getDownloadAggregates:",a),[]}},u=async e=>{const r=i();if(!r)return console.error("[Supabase] getDailyDownloadSeries: client not initialized"),[];const{days:n,category:t=null,id:o=null,variant:a=null}=e;try{const{data:e,error:i}=await r.rpc("get_daily_downloads_metrics",{p_days:n,p_category:t,p_variant:a,p_id:o});return i?(console.error("[Supabase] Error in getDailyDownloadSeries RPC:",i),[]):(e||[]).map(e=>({day:e.day,total:Number(e.total??0)}))}catch(l){return console.error("[Supabase] Exception in getDailyDownloadSeries:",l),[]}}},22122:(e,r,n)=>{n.r(r),n.d(r,{default:()=>d});var t=n(13790),o=n(87483),a=n(54185),i=n(63883),l=n(1170),s=n(82238);function d(e){const r=e.route.category,n=e.route.id,{consent:d}=(0,a.S)(),c=(()=>{if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("version");if(e&&e.trim().length>0)return e}return e.route.version&&e.route.version.trim().length>0?e.route.version:"latest"})();let u=(()=>{if("undefined"!=typeof window){const r=new URLSearchParams(window.location.search).get("variant");return r&&r.trim().length>0?r:e.route.variant||null}return e.route.variant||null})();"controllers"===r&&!u&&e.route.variantsById&&1===Object.keys(e.route.variantsById).length&&(u=Object.keys(e.route.variantsById)[0]),"controllers"!==r&&(u="EPMatt");let p,w=c;if("controllers"===r&&"latest"===w&&u&&e.route.variantsById?.[u]?.length){w=[...e.route.variantsById[u]].sort((e,r)=>r.localeCompare(e))[0]}if("controllers"===r){u||"undefined"==typeof window||console.error("Missing variant for controller download route.");p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${`${u}/${w}/${n}.yaml`}`}else p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${n}.yaml`;const b="https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url="+encodeURIComponent(p),g=w;return(0,t.useEffect)(()=>{if("undefined"!=typeof window){if(window.__blueprintDownloadHandled)return;window.__blueprintDownloadHandled=!0}d&&(0,i.sx)("blueprint","download","controllers"===r?`${r}/${n}/${u}/${g}`:`${r}/${n}`,void 0);const e={category:r,id:n,variant:u||null,version:g};(0,l.Dk)(e.category,e.id,e.variant,e.version).then(e=>{e||console.error("Failed to record blueprint download in database")}).catch(e=>{console.error("Error recording blueprint download:",e)}).finally(()=>{(e=>{try{const r="my.home-assistant.io";new URL(e).hostname===r?window.location.href=e:console.error("Unsafe redirect blocked:",e)}catch{console.error("Invalid redirect URL:",e)}})(b)})},[d,r,n,u,g,b]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{children:(0,s.jsxs)("title",{children:["Download ",r,"/",n,u?`/${u}`:"",w?`/${w}`:""]})}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"20px"},children:[(0,s.jsx)("h1",{children:"Thanks for downloading!"}),(0,s.jsx)("p",{children:"Redirecting to your Home Assistant instance..."})]})]})}}}]);