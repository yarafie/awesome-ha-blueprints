"use strict";(globalThis.webpackChunkawesome_ha_library_website=globalThis.webpackChunkawesome_ha_library_website||[]).push([[8069],{36739(e,r,n){n.r(r),n.d(r,{default:()=>c});var t=n(71299),o=n(75426),i=n(89361),l=n(12512),a=n(81351),s=n(36259);function c(e){const r=e.route.category,n=e.route.id,{consent:c}=(0,i.S)(),d=e=>{try{const r="my.home-assistant.io";new URL(e).hostname===r?window.location.href=e:console.error("\u274c Unsafe redirect blocked:",e)}catch{console.error("\u274c Invalid redirect URL:",e)}},u=(()=>{if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("version");if(e&&e.trim().length>0)return e}return e.route.version&&e.route.version.trim().length>0?e.route.version:"latest"})(),p=(()=>{if("undefined"!=typeof window){const r=new URLSearchParams(window.location.search).get("library");return r&&r.trim().length>0?r:e.route.library_id||null}return e.route.library_id||null})(),b=(()=>{if("undefined"!=typeof window){const r=new URLSearchParams(window.location.search).get("release");return r&&r.trim().length>0?r:e.route.release_id||null}return e.route.release_id||null})();let w=p,h=b;const y=e.route.releasesIndex||{};w||1!==Object.keys(y).length||(w=Object.keys(y)[0]),w&&!h&&y[w]&&1===Object.keys(y[w]).length&&(h=Object.keys(y[w])[0]);let f=u;if(w&&h&&"latest"===f&&y?.[w]?.[h]?.length){f=[...y[w][h]].sort((e,r)=>r.localeCompare(e))[0]}const _="https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url="+encodeURIComponent(`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${`${w}/${h}/${f}/${n}.yaml`}`),g=f;return(0,t.useEffect)(()=>{if("undefined"!=typeof window){if(window.__blueprintDownloadHandled)return;window.__blueprintDownloadHandled=!0}if(!(r&&n&&w&&h&&g))return console.error("\u274c Invalid blueprint download record \u2014 aborting insert"),void d(_);c&&(0,l.sx)("blueprint","download",`${r}/${n}/${w}/${h}/${g}`,void 0),(0,a.Dk)(r,n,w,h,g).catch(e=>{console.error("\u274c Error recording blueprint download:",e)}).finally(()=>{d(_)})},[c,r,n,w,h,g,_]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{children:(0,s.jsxs)("title",{children:["Download ",r,"/",n,w?`/${w}`:"",h?`/${h}`:"",f?`/${f}`:""]})}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"20px"},children:[(0,s.jsx)("h1",{children:"Thanks for downloading!"}),(0,s.jsx)("p",{children:"Redirecting to your Home Assistant instance..."})]})]})}},81351(e,r,n){n.d(r,{Dk:()=>s,PG:()=>c});var t=n(736),o=n(4784);let i=null;const l=()=>{if(i)return i;const e=(o.default?.customFields||{}).env||{},r=e.SUPABASE_URL,n=e.SUPABASE_ANON_KEY;return r&&n&&a({supabaseUrl:r,supabaseKey:n}),i},a=({supabaseUrl:e,supabaseKey:r})=>{i=(0,t.UU)(e,r),console.log("\u2705 [Supabase] initialized")},s=async(e,r,n,t,o)=>{const i=l();if(!i)return console.error("\u274c [Supabase] recordBlueprintDownload: client not initialized"),!1;try{const{error:l}=await i.from("library_downloads").insert([{blueprint_category:e,blueprint_id:r,blueprint_library:n,blueprint_release:t,blueprint_version:o,download_date:(new Date).toISOString()}]);return!l||(console.error("\u274c [Supabase] Error recording library download:",l),!1)}catch(a){return console.error("\u274c [Supabase] Exception recording library download:",a),!1}},c=async(e,r,n=null,t=null,o=null)=>{const i=l();if(!i)return console.error("\u274c [Supabase] getBlueprintDownloads: client not initialized"),0;try{const{data:l,error:a}=await i.rpc("get_library_downloads",{p_category:e,p_id:r,p_library:n,p_release:t,p_version:o});return a?(console.error("\u274c [Supabase] Error in getBlueprintDownloads RPC:",a),0):"number"==typeof l?l:Number(l??0)}catch(a){return console.error("\u274c [Supabase] Exception in getBlueprintDownloads:",a),0}}}}]);