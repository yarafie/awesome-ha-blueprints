"use strict";(globalThis.webpackChunkawesome_ha_library_website=globalThis.webpackChunkawesome_ha_library_website||[]).push([[3825],{51304(e,t,r){r.r(t),r.d(t,{default:()=>b});var n=r(82128);var i=r(77900);const a=({authState:e,authDispatch:t})=>{const[r,a]=(0,n.useState)("");(0,n.useEffect)(()=>{if("undefined"==typeof window)return;const e=function(e){const t=new URLSearchParams(e.search),r=t.get("code"),n=t.get("error");return n?{type:"AUTH_ERROR",error:n}:r?{type:"AUTH_START"}:null}(window.location);e&&(t(e),function(e){const t=new URL(e.href);t.searchParams.delete("code"),t.searchParams.delete("error"),t.searchParams.delete("state"),window.history.replaceState({},document.title,t.toString())}(window.location))},[t]);const s=()=>{t({type:"AUTH_START"}),setTimeout(()=>{const e=r.trim();if(!e)return void t({type:"AUTH_ERROR",error:"GitHub username is required"});t({type:"AUTH_SUCCESS",user:{id:1,login:e,name:e,avatar_url:`https://avatars.githubusercontent.com/${e}`,html_url:`https://github.com/${e}`}})},500)};return(0,i.jsxs)("div",{className:"container padding-vert--lg",children:[(0,i.jsx)("h1",{children:"Welcome to Awesome HA Library Contributors Page"}),(0,i.jsxs)("div",{style:{marginTop:24,padding:24,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:8,maxWidth:520},children:["unauthenticated"===e.status&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"GitHub Authentication"}),(0,i.jsx)("p",{children:"Authenticate with GitHub to contribute. Authentication is handled securely using GitHub\u2019s official authorization flow."}),(0,i.jsx)("input",{type:"text",placeholder:"GitHub username",value:r,onChange:e=>a(e.target.value),style:{width:"100%",padding:8,marginBottom:12}}),(0,i.jsx)("button",{className:"button button--primary",onClick:s,children:"Authenticate with GitHub"})]}),"authenticating"===e.status&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Authenticating\u2026"}),(0,i.jsx)("p",{children:"Please wait while we verify your GitHub identity."})]}),"authenticated"===e.status&&e.user&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Authenticated"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.user.avatar_url&&(0,i.jsx)("img",{src:e.user.avatar_url,alt:e.user.login,width:48,height:48,style:{borderRadius:"50%"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:e.user.name??e.user.login}),(0,i.jsx)("div",{children:(0,i.jsxs)("a",{href:e.user.html_url,target:"_blank",rel:"noopener noreferrer",children:["@",e.user.login]})})]})]}),(0,i.jsx)("div",{style:{marginTop:16},children:(0,i.jsx)("button",{className:"button button--secondary",onClick:()=>{t({type:"AUTH_LOGOUT"}),a("")},children:"Logout"})})]}),"error"===e.status&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Authentication Error"}),(0,i.jsx)("p",{style:{color:"var(--ifm-color-danger)"},children:e.error}),(0,i.jsx)("button",{className:"button button--primary",onClick:s,children:"Try Again"})]})]})]})},s=[{type:"automation:new",label:"New Automation",description:"Submit a brand new automation blueprint"},{type:"controller:new",label:"New Controller",description:"Add support for a new physical controller device"},{type:"hook:new",label:"New Hook",description:"Create a reusable hook blueprint"},{type:"blueprint:update",label:"Update Existing Blueprint",description:"Improve or fix an existing blueprint"}],l=({disabled:e,onSelect:t})=>(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("h2",{children:"Choose Contribution Type"}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:16,marginTop:16,maxWidth:900},children:s.map(r=>(0,i.jsxs)("button",{disabled:e,onClick:()=>t(r.type),style:{textAlign:"left",padding:16,borderRadius:8,border:"1px solid var(--ifm-color-emphasis-300)",background:"var(--ifm-background-color)",cursor:e?"not-allowed":"pointer",opacity:e?.6:1},children:[(0,i.jsx)("strong",{children:r.label}),(0,i.jsx)("p",{style:{marginTop:6,fontSize:14,opacity:.8},children:r.description})]},r.type))})]});var o=r(33205);const d=({onParsed:e,onError:t})=>{const[r,a]=(0,n.useState)(null),[s,l]=(0,n.useState)("ready"),[d,c]=(0,n.useState)(null);return(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("h2",{children:"Upload YAML"}),(0,i.jsxs)("p",{children:["Upload your blueprint ",(0,i.jsx)("strong",{children:".yaml"})," / ",(0,i.jsx)("strong",{children:".yml"}),". We will extract name, domain, description, and inputs for a preview."]}),(0,i.jsx)("input",{type:"file",accept:".yaml,.yml",onChange:r=>{const n=r.target.files?.[0];n&&(a(n.name),(async r=>{try{l("parsing"),c(null);const t=await r.text(),n=function(e){return e.replace(/!input\s+/g,"")}(t),i=o.Ay.parse(n),a=i?.blueprint??{},s={name:"string"==typeof a?.name?a.name:null,domain:"string"==typeof a?.domain?a.domain:null,description:"string"==typeof a?.description?a.description:null,inputs:a?.input&&"object"==typeof a.input?Object.keys(a.input):[],raw:t,fileName:r.name};e(s),l("ready")}catch(n){const e=n?.message??"Failed to parse YAML";l("error"),c(e),t(e)}})(n))}}),(0,i.jsxs)("div",{style:{marginTop:10,fontSize:14},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Selected file:"})," ",r??"\u2014"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Status:"})," ","ready"===s?"Ready":"parsing"===s?"Parsing\u2026":"Error"]}),"error"===s&&d&&(0,i.jsxs)("div",{style:{marginTop:6,color:"var(--ifm-color-danger)"},children:[(0,i.jsx)("strong",{children:"Error:"})," ",d]})]})]})},c=({yaml:e})=>(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("h2",{children:"YAML Preview"}),(0,i.jsxs)("div",{style:{marginTop:12},children:[(0,i.jsx)("strong",{children:"Name:"})," ",e.name??"\u2014"]}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)("strong",{children:"Domain:"})," ",e.domain??"\u2014"]}),(0,i.jsxs)("div",{style:{marginTop:12},children:[(0,i.jsx)("strong",{children:"Description:"}),(0,i.jsx)("div",{style:{marginTop:8,padding:12,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:6,whiteSpace:"pre-wrap",lineHeight:1.6},children:e.description??"\u2014"})]}),(0,i.jsxs)("div",{style:{marginTop:12},children:[(0,i.jsx)("strong",{children:"Inputs:"}),0===e.inputs.length?(0,i.jsx)("div",{style:{marginTop:6},children:"\u2014"}):(0,i.jsx)("ul",{style:{marginTop:6},children:e.inputs.map(e=>(0,i.jsx)("li",{children:e},e))})]})]}),u={status:"unauthenticated",user:null,error:null};function p(e,t){switch(t.type){case"AUTH_START":return"authenticated"===e.status?e:{status:"authenticating",user:null,error:null};case"AUTH_SUCCESS":return"authenticating"!==e.status?e:{status:"authenticated",user:t.user,error:null};case"AUTH_ERROR":return"authenticating"!==e.status?e:{status:"error",user:null,error:t.error};case"AUTH_LOGOUT":return u;default:return e}}const m={status:"idle",type:null,yaml:null,error:null};function h(e,t){switch(t.type){case"SELECT_TYPE":return{status:"yaml_required",type:t.contribution,yaml:null,error:null};case"YAML_UPLOADED":return{status:"yaml_parsed",type:e.type,yaml:t.payload,error:null};case"YAML_ERROR":return{status:"error",type:e.type,yaml:null,error:t.error};case"RESET":return m;default:return e}}function g(e){const t=["EPMatt","yarafie",e.loggedInUser],r=new Set,n=[];for(const i of t){const e=String(i||"").trim();e&&(r.has(e)||(r.add(e),n.push({id:e,name:e})))}return n}function y(e){try{return"https:"===new URL(e).protocol}catch{return!1}}function x(e){return e.split(",").map(e=>e.trim()).filter(e=>e.length>0)}function f({draft:e,setDraft:t,isOwnerOverride:r}){const[a,s]=(0,n.useState)(null),[l,o]=(0,n.useState)(null),d=r,c=`${e.blueprint_id}.png`,u=`${e.blueprint_id}.pdf`,p=(0,n.useMemo)(()=>e.tags.join(", "),[e.tags]),m=(0,n.useMemo)(()=>e.librarians.map(e=>e.id).join(", "),[e.librarians]),h=(0,n.useMemo)(()=>e.external_references.every(e=>e.label.trim().length>0&&y(e.url)),[e.external_references]),g=(r,n)=>{const i=e.external_references.map((e,t)=>t===r?{...e,...n}:e);t({...e,external_references:i})};return(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("h2",{children:"Complete Metadata"}),(0,i.jsxs)("div",{style:{marginTop:16,padding:16,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:8,maxWidth:900},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Blueprint Metadata (automation)"}),(0,i.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"blueprint_id (derived; must be unique across controllers/hooks/automations)"}),(0,i.jsx)("input",{value:e.blueprint_id,disabled:!d,onChange:r=>t({...e,blueprint_id:r.target.value}),style:{width:"100%",padding:10}}),!d&&(0,i.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["Derived from YAML name (lowercase, spaces \u2192 _). Only"," ",(0,i.jsx)("strong",{children:"yarafie"})," can override."]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"name (from YAML)"}),(0,i.jsx)("input",{value:e.name,disabled:!d,onChange:r=>t({...e,name:r.target.value}),style:{width:"100%",padding:10}}),!d&&(0,i.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["From YAML. Only ",(0,i.jsx)("strong",{children:"yarafie"})," can override."]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"description (from YAML: first complete sentence not starting with #)"}),(0,i.jsx)("textarea",{value:e.description,disabled:!d,onChange:r=>t({...e,description:r.target.value}),rows:3,style:{width:"100%",padding:10}}),!d&&(0,i.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["Derived from YAML. Only ",(0,i.jsx)("strong",{children:"yarafie"})," can override."]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"category (locked)"}),(0,i.jsx)("input",{value:e.category,disabled:!0,style:{width:"100%",padding:10}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"status (schema enum: active | deprecated)"}),(0,i.jsxs)("select",{value:e.status,disabled:!d,onChange:r=>(r=>{const n="deprecated"===r?"deprecated":"active";t({...e,status:n})})(r.target.value),style:{width:"100%",padding:10},children:[(0,i.jsx)("option",{value:"active",children:"active"}),(0,i.jsx)("option",{value:"deprecated",children:"deprecated"})]}),!d&&(0,i.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:["Default ",(0,i.jsx)("strong",{children:"active"}),". Only ",(0,i.jsx)("strong",{children:"yarafie"})," ","can change."]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"librarians (locked order; unique): EPMatt, yarafie, logged-in user"}),(0,i.jsx)("input",{value:m,disabled:!0,style:{width:"100%",padding:10}}),(0,i.jsx)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:"Read-only (always derived). Stored as array of objects in payload."})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:"tags (comma separated; free form)"}),(0,i.jsx)("input",{value:p,onChange:r=>{return n=r.target.value,void t({...e,tags:x(n)});var n},style:{width:"100%",padding:10}})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:["images (PNG only; renamed internally to ",c,")"]}),(0,i.jsx)("input",{type:"file",accept:"image/png",onChange:r=>(r=>{if(!r)return s(null),void t({...e,images:[]});if(!r.name.toLowerCase().endsWith(".png"))return s(null),void t({...e,images:[]});s(r),t({...e,images:[c]})})(r.target.files?.[0]??null)}),(0,i.jsxs)("div",{style:{marginTop:8,fontSize:13},children:[(0,i.jsx)("strong",{children:"Selected:"})," ",a?a.name:"\u2014",(0,i.jsx)("br",{}),(0,i.jsx)("strong",{children:"Will be stored as:"})," ",e.images.length?e.images[0]:"\u2014"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontSize:13,opacity:.8,marginBottom:6},children:["manual_files (optional PDF only; renamed internally to"," ",u,")"]}),(0,i.jsx)("input",{type:"file",accept:"application/pdf",onChange:r=>(r=>{if(!r)return o(null),void t({...e,manual_files:[]});if(!r.name.toLowerCase().endsWith(".pdf"))return o(null),void t({...e,manual_files:[]});o(r),t({...e,manual_files:[u]})})(r.target.files?.[0]??null)}),(0,i.jsxs)("div",{style:{marginTop:8,fontSize:13},children:[(0,i.jsx)("strong",{children:"Selected:"})," ",l?l.name:"\u2014",(0,i.jsx)("br",{}),(0,i.jsx)("strong",{children:"Will be stored as:"})," ",e.manual_files.length?e.manual_files[0]:"\u2014"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:10},children:"external_references (optional; valid https links)"}),0===e.external_references.length&&(0,i.jsx)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:"No external references added."}),e.external_references.map((r,n)=>{const a=r.label.trim().length>0&&y(r.url);return(0,i.jsx)("div",{style:{border:"1px dashed var(--ifm-color-emphasis-300)",borderRadius:8,padding:12,marginBottom:10},children:(0,i.jsxs)("div",{style:{display:"grid",gap:10},children:[(0,i.jsx)("input",{placeholder:"Label (e.g. Docs, Source, PR #123)",value:r.label,onChange:e=>g(n,{label:e.target.value}),style:{width:"100%",padding:10}}),(0,i.jsx)("input",{placeholder:"https://example.com",value:r.url,onChange:e=>g(n,{url:e.target.value}),style:{width:"100%",padding:10}}),(0,i.jsxs)("div",{style:{fontSize:12,opacity:.8},children:["Status:"," ",a?"valid \u2705":"invalid \u274c (label + https url required)"]}),(0,i.jsx)("button",{className:"button button--secondary",onClick:()=>(r=>{const n=e.external_references.filter((e,t)=>t!==r);t({...e,external_references:n})})(n),type:"button",style:{width:"fit-content"},children:"Remove"})]})},n)}),(0,i.jsx)("button",{className:"button button--primary",onClick:()=>{const r=[...e.external_references,{label:"",url:""}];t({...e,external_references:r})},type:"button",style:{width:"fit-content"},children:"Add External Reference"}),!h&&e.external_references.length>0&&(0,i.jsx)("div",{style:{marginTop:10,fontSize:12,color:"var(--ifm-color-danger)"},children:"Some external references are invalid. Each must have a label and an https URL."})]}),(0,i.jsx)("div",{style:{fontSize:12,opacity:.65},children:"supported_integrations: hidden (not required for automations)"})]})]})]})}function j(e){const t=function(e){const t={blueprint_id:e.draft.blueprint_id,name:e.draft.name,description:e.draft.description,category:"automations",status:e.draft.status,librarians:e.draft.librarians.map(e=>({...e}))};return e.draft.tags.length&&(t.tags=[...e.draft.tags]),e.draft.images.length&&(t.images=[...e.draft.images]),e.draft.manual_files.length&&(t.manual_files=[...e.draft.manual_files]),e.draft.external_references.length&&(t.external_references=e.draft.external_references.map(e=>({label:e.label,url:e.url}))),{kind:"phase6_payload_preview_v1",blueprint:{blueprint_json:t},yaml:{file_name:e.yaml.fileName,raw:e.yaml.raw,derived_preview:{name:e.yaml.name,domain:e.yaml.domain,inputs:e.yaml.inputs}},assets:{image_png:e.draft.images.length?e.draft.images[0]:null,manual_pdf:e.draft.manual_files.length?e.draft.manual_files[0]:null}}}({draft:e.draft,yaml:e.yaml});return(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("h2",{children:"Phase 6 Payload Preview"}),(0,i.jsx)("div",{style:{marginTop:12,padding:16,border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:8,maxWidth:1e3},children:(0,i.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:12,lineHeight:1.35},children:JSON.stringify(t,null,2)})})]})}const v=()=>{const[e,t]=(0,n.useReducer)(p,u),[r,s]=(0,n.useReducer)(h,m),o=e.user?.login??"",y="yarafie"===o,[x,v]=(0,n.useState)(null),[b,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if("yaml_parsed"!==r.status)return;if(!r.yaml)return;if(!o)return;const e=function(e){const t=(e.yamlName||"").trim(),r=function(e){return e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")}(t||"new_blueprint");return{blueprint_id:r,name:t||"",description:(e.yamlDescription?function(e){const t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n").map(e=>e.trim()).filter(e=>e.length>0).filter(e=>!e.startsWith("#"));if(0===t.length)return"";let r="";for(const n of t){r=r?`${r} ${n}`:n;const e=r.match(/^(.+?[.!?])(\s|$)/);if(e&&e[1])return e[1].trim()}return t[0].trim()}(e.yamlDescription):"")||"",category:"automations",status:"active",tags:[],images:[`${r}.png`],manual_files:[],external_references:[],librarians:g({loggedInUser:e.loggedInUser})}}({yamlName:r.yaml.name,yamlDescription:r.yaml.description,loggedInUser:o});v(e),_(!1)},[r.status,r.yaml,o]);const w=(0,n.useMemo)(()=>"yaml_parsed"===r.status&&!!r.yaml,[r.status,r.yaml]),S=(0,n.useMemo)(()=>!!r.yaml&&(!!x&&(!!x.blueprint_id.trim()&&(!!x.name.trim()&&(!!x.description.trim()&&!!x.images.length)))),[r.yaml,x]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a,{authState:e,authDispatch:t}),"authenticated"===e.status&&(0,i.jsxs)(i.Fragment,{children:["idle"===r.status&&(0,i.jsx)(l,{disabled:!1,onSelect:e=>s({type:"SELECT_TYPE",contribution:e})}),"yaml_required"===r.status&&(0,i.jsx)(d,{onParsed:e=>s({type:"YAML_UPLOADED",payload:e}),onError:e=>s({type:"YAML_ERROR",error:e})}),"error"===r.status&&(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("h2",{children:"Upload Error"}),(0,i.jsx)("p",{style:{color:"var(--ifm-color-danger)"},children:r.error}),(0,i.jsx)("button",{className:"button button--secondary",onClick:()=>s({type:"RESET"}),children:"Start Over"})]}),w&&r.yaml&&x&&(0,i.jsx)(i.Fragment,{children:b?(0,i.jsx)(j,{draft:x,yaml:r.yaml}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f,{draft:x,setDraft:v,isOwnerOverride:y}),(0,i.jsx)(c,{yaml:r.yaml}),(0,i.jsxs)("section",{className:"container padding-vert--lg",children:[(0,i.jsx)("button",{className:"button button--primary",disabled:!S,onClick:()=>_(!0),children:"Submit (Preview Phase 6 Payload)"}),!S&&(0,i.jsx)("div",{style:{marginTop:10,fontSize:12,opacity:.75},children:"Submit is disabled until required Blueprint Metadata is complete (name, description, blueprint_id, and PNG image)."})]})]})})]}),"authenticated"!==e.status&&(0,i.jsx)("section",{className:"container padding-vert--lg",children:(0,i.jsx)("p",{style:{opacity:.7},children:"Please authenticate with GitHub to begin contributing."})})]})},b=()=>(0,i.jsx)("main",{children:(0,i.jsx)(v,{})})}}]);