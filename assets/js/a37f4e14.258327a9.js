"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,r)=>{r.r(e),r.d(e,{default:()=>f});var o=r(3303),i=r(1153),a=r(6285),l=r(4538),n=r(162),s=r(656),d=r(351),c=r(6605),h=r(9441),p=r(2782),y=r(7342),g=r(2941),x=r(2454),m=r(7263),u=r(50),b=r(1929),j=r(1778),w=r(7711);const f=()=>{const[t,e]=(0,o.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),{loading:r,error:f,totalDownloads:v,byCategory:S,topBlueprints:_,daily:D}=t,k=(0,b.A)(j.A);(0,o.useEffect)(()=>{const t=window?.env?.SUPABASE_URL,r=window?.env?.SUPABASE_ANON_KEY;if(!t||!r){const t=1234567,r=[{blueprint_category:"controllers",total:"900000"},{blueprint_category:"hooks",total:"280000"},{blueprint_category:"templates",total:"54000"}],o=[{blueprint_category:"hooks",blueprint_id:"thertetsat_controlv2_30_days_ago",total:"50000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"45000"},{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"}],i=[{day:new Date(Date.now()-432e6).toISOString().split("T")[0],total:"10"},{day:new Date(Date.now()-3456e5).toISOString().split("T")[0],total:"12"},{day:new Date(Date.now()-2592e5).toISOString().split("T")[0],total:"15"},{day:new Date(Date.now()-1728e5).toISOString().split("T")[0],total:"20"},{day:new Date(Date.now()-864e5).toISOString().split("T")[0],total:"18"},{day:(new Date).toISOString().split("T")[0],total:"22"}].map(t=>({label:new Date(t.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(t.total)})).sort((t,e)=>new Date(t.label).getTime()-new Date(e.label).getTime());return void e(e=>({...e,loading:!1,error:"Supabase variables missing. Showing mock data.",totalDownloads:t,byCategory:r,topBlueprints:o,daily:i}))}const o={"Content-Type":"application/json",apikey:r,Authorization:`Bearer ${r}`},i=async(t,e,r=3)=>{for(let o=0;o<r;o++)try{const i=await fetch(t,e);if(i.ok)return i;if(429===i.status&&o<r-1){const t=1e3*Math.pow(2,o)+1e3*Math.random();await new Promise(e=>setTimeout(e,t));continue}{const t=await i.text();throw new Error(`HTTP error! Status: ${i.status}. Response: ${t.substring(0,100)}...`)}}catch(f){if(o===r-1)throw f}};!async function(){try{const[r,a,l,n]=await Promise.all([i(`${t}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:o,body:JSON.stringify({})}),i(`${t}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:o,body:JSON.stringify({})}),i(`${t}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:o,body:JSON.stringify({})}),i(`${t}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:o,body:JSON.stringify({p_days:30})})]),s=await r.json(),d=await a.json(),c=await l.json(),h=await n.json();let p=0;Array.isArray(s)&&s.length>0?p=Number(s[0].total):"number"==typeof s&&(p=s);const y=Array.isArray(d)?d:[],g=Array.isArray(c)?c:[],x=Array.isArray(h)?h.map(t=>({label:new Date(t.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(t.total)})).sort((t,e)=>{const r=new Date(t.label),o=new Date(e.label);return r.getTime()-o.getTime()}):[];e({loading:!1,error:void 0,totalDownloads:p,byCategory:y,topBlueprints:g,daily:x})}catch(r){console.error("Error fetching download metrics",r),e(t=>({...t,loading:!1,error:`Failed to load metrics from Supabase. Error: ${r.message||"Unknown error."}`}))}}()},[]);const T=t=>t.toLocaleString(),A=S.map(t=>({name:t.blueprint_category,category:t.blueprint_category,value:Number(t.total),total:Number(t.total),label:t.blueprint_category})),B=_.slice(0,10).map(t=>({id:t.blueprint_id,name:t.blueprint_id.length>40?t.blueprint_id.substring(0,37)+"...":t.blueprint_id,value:Number(t.total)})).reverse(),O=({active:t,payload:e,label:r})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,w.jsxs)("div",{style:{padding:"10px",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"5px",color:"#333"},children:[(0,w.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:t.name||t.id||r}),(0,w.jsxs)("p",{children:["Downloads: ",T(t.value||e[0].value)]})]})}return null},z=t=>{const{x:e,y:r,payload:o}=t;return(0,w.jsx)("g",{transform:`translate(${e},${r})`,children:(0,w.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:"#666",fontSize:10,title:o.value,children:o.value})})},C={backgroundColor:"white",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:"#333",minWidth:"0"},N=t=>({backgroundColor:t,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),$={padding:"24px",textAlign:"center"};return(0,w.jsx)(i.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,w.jsxs)("main",{className:"container margin-vert--lg",children:[(0,w.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold"},children:"Blueprint Metrics Dashboard"}),r&&(0,w.jsx)("div",{style:{textAlign:"center"},children:"Loading metrics..."}),!r&&f&&(0,w.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,w.jsx)("h4",{className:"alert__heading",children:"Error loading metrics"}),(0,w.jsx)("p",{children:f})]}),!r&&!f&&(0,w.jsxs)("div",{style:{width:"100%",overflowX:"auto"},children:[(0,w.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},children:[(0,w.jsxs)("div",{style:C,children:[(0,w.jsx)("div",{style:N("#4f46e5"),children:"Total Downloads"}),(0,w.jsx)("div",{style:$,children:(0,w.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#4f46e5",margin:0},children:T(v)})})]}),(0,w.jsxs)("div",{style:C,children:[(0,w.jsx)("div",{style:N("#0d9488"),children:"Unique Categories"}),(0,w.jsx)("div",{style:$,children:(0,w.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#0d9488",margin:0},children:T(S.length)})})]}),(0,w.jsxs)("div",{style:C,children:[(0,w.jsx)("div",{style:N("#9333ea"),children:"Tracked Blueprints"}),(0,w.jsx)("div",{style:$,children:(0,w.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:T(_.length)})})]})]}),(0,w.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"},children:[(0,w.jsxs)("div",{style:C,children:[(0,w.jsx)("div",{style:{padding:"16px",borderBottom:"1px solid #eee"},children:(0,w.jsx)("h3",{style:{margin:0,fontSize:"1.25rem",color:"#333"},children:"Daily Downloads"})}),(0,w.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,w.jsx)(n.u,{width:"100%",height:"100%",children:(0,w.jsxs)(u.Q,{data:D,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,w.jsx)("defs",{children:(0,w.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,w.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#eee",vertical:!1}),(0,w.jsx)(y.W,{dataKey:"label",stroke:"#666",tick:{fontSize:10}}),(0,w.jsx)(g.h,{allowDecimals:!1,stroke:"#666",tick:{fontSize:10},tickFormatter:T}),(0,w.jsx)(l.m,{content:(0,w.jsx)(O,{})}),(0,w.jsx)(h.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)"})]})})})]}),(0,w.jsxs)("div",{style:C,children:[(0,w.jsx)("div",{style:{padding:"16px",borderBottom:"1px solid #eee"},children:(0,w.jsx)("h3",{style:{margin:0,fontSize:"1.25rem",color:"#333"},children:"Category Distribution"})}),(0,w.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,w.jsx)(n.u,{width:"100%",height:"100%",children:(0,w.jsxs)(m.r,{children:[(0,w.jsx)(d.F,{data:A,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:t})=>`${(100*t).toFixed(0)}%`,children:A.map((t,e)=>(0,w.jsx)(s.f,{fill:k(t.category),stroke:"#fff"},`cell-${e}`))}),(0,w.jsx)(l.m,{content:(0,w.jsx)(O,{})}),(0,w.jsx)(a.s,{iconType:"circle",wrapperStyle:{fontSize:"12px"}})]})})})]})]}),(0,w.jsxs)("section",{style:{...C,padding:"20px"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 20px 0",fontSize:"1.25rem",color:"#333"},children:"Top 10 Blueprints"}),(0,w.jsx)("div",{style:{height:Math.max(400,40*B.length)},children:(0,w.jsx)(n.u,{width:"100%",height:"100%",children:(0,w.jsxs)(x.E,{data:B,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,w.jsx)(c.d,{strokeDasharray:"3 3",horizontal:!1,stroke:"#eee"}),(0,w.jsx)(y.W,{type:"number",stroke:"#666",tick:{fontSize:10},tickFormatter:T}),(0,w.jsx)(g.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,w.jsx)(z,{})}),(0,w.jsx)(l.m,{content:(0,w.jsx)(O,{})}),(0,w.jsx)(p.y,{dataKey:"value",fill:k("top10"),barSize:20,radius:[0,4,4,0]})]})})})]})]})]})})}}}]);