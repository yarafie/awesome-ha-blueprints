"use strict";(globalThis.webpackChunkawesome_ha_library_website=globalThis.webpackChunkawesome_ha_library_website||[]).push([[5447],{18256(e,t,r){r.r(t),r.d(t,{default:()=>$});var l=r(82128),o=r(36863),i=r(67018),a=r(75178),n=r(37109),s=r(81238),d=r(80197),c=r(20674),p=r(53065),u=r(17783),x=r(93431),y=r(85048),g=r(68437),b=r(99806),h=r(54028),m=r(41929),f=r(41778),L=r(95556),w=r(4784);let _=null;const j=()=>{if(_)return _;const e=(w.default?.customFields||{}).env||{},t=e.SUPABASE_URL||process.env.SUPABASE_URL,r=e.SUPABASE_ANON_KEY||process.env.SUPABASE_ANON_KEY;if(t&&r)try{_=(0,L.UU)(t,r)}catch(l){console.error("Supabase init failed",l)}return _},A=async e=>{const t=j();if(!t)throw new Error("Supabase Client not initialized");const r={p_days:e.days,p_category:e.category||null,p_library:e.library||null,p_release:e.release||null,p_id:e.id||null},{data:l,error:o}=await t.rpc("get_library_downloads_daily",r);return o?(console.error("RPC Error (Daily):",o),[]):(l||[]).map(e=>({day:e.day,total:Number(e.total||0)}))};var S=r(77900);const v=e=>Number.isFinite(e)?e.toLocaleString():"0",C=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString(void 0,{timeZone:"UTC",year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},k=(e,t)=>{const r=new Map;e.forEach(e=>{r.set(e.day,Number(e.total??0))});const l=[],o=new Date,i=new Date(Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()));for(let a=t-1;a>=0;a--){const e=new Date(i);e.setUTCDate(i.getUTCDate()-a);const t=e.toISOString().substring(0,10),o=r.get(t)??0;l.push({label:e.toLocaleDateString(void 0,{month:"short",day:"numeric",timeZone:"UTC"}),total:o})}return l},$=()=>{const[e,t]=(0,l.useState)({totalDownloads:0,byCategory:[],aggregates:[],daily:[]}),[r,L]=(0,l.useState)(!0),[w,_]=(0,l.useState)(!1),[$,B]=(0,l.useState)(void 0),[D,T]=(0,l.useState)(15),[P,E]=(0,l.useState)(10),[z,M]=(0,l.useState)("ALL"),[R,U]=(0,l.useState)("ALL"),[N,W]=(0,l.useState)("ALL"),[K,I]=(0,l.useState)("ALL"),[F,O]=(0,l.useState)([]),[Y,Z]=(0,l.useState)(!1),[H,V]=(0,l.useState)({key:"total",direction:"desc"}),[G,q]=(0,l.useState)(!1),Q=(0,m.A)(f.A),X=(0,m.A)(f.A),{totalDownloads:J,byCategory:ee,aggregates:te,daily:re}=e;(0,l.useEffect)(()=>{const e=()=>{const e=document.documentElement.getAttribute("data-theme");q("dark"===e)};e();const t=new MutationObserver(t=>{for(const r of t)"attributes"===r.type&&"data-theme"===r.attributeName&&e()});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[]),(0,l.useEffect)(()=>{if("undefined"==typeof window)return;const e=new URLSearchParams(window.location.search),t=e.get("days"),r=e.get("top"),l=e.get("category"),o=e.get("blueprint"),i=e.get("library"),a=e.get("libraries"),n=e.get("release");if(t&&/^\d+$/.test(t)&&T(Number(t)),r&&/^\d+$/.test(r)&&E(Number(r)),l&&M("ALL"===l?"ALL":l),o&&W("ALL"===o?"ALL":o),n&&I("ALL"===n?"ALL":n),a){const e=a.split(",").map(e=>e.trim()).filter(Boolean);e.length>0&&(O(e),U("ALL"))}else i&&(U(i),O([]))},[]),(0,l.useEffect)(()=>{if("undefined"==typeof window)return;const e=new URLSearchParams(window.location.search);e.set("days",String(D)),e.set("top",String(P)),e.set("category",String(z)),e.set("blueprint",String(N)),e.set("release",String(K)),F.length>0?(e.set("libraries",F.join(",")),e.delete("library")):(e.delete("libraries"),e.set("library",String(R)));const t=`${window.location.pathname}?${e.toString()}`;window.history.replaceState({},"",t)},[D,P,z,N,R,F,K]);const le={bg:G?"#1b1b1d":"#f9fafb",cardBg:G?"#242526":"#ffffff",textPrimary:G?"#e5e7eb":"#1f2937",textSecondary:G?"#9ca3af":"#6b7280",gridLine:G?"#444":"#e5e7eb",tooltipBg:G?"#242526":"#ffffff",tooltipBorder:G?"#444":"#ccc",tooltipText:G?"#e5e7eb":"#333",accentColor:"#4f46e5"},oe={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},ie={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"};if("undefined"!=typeof window){window.matchMedia("(max-width: 768px)").matches&&(oe.gridTemplateColumns="1fr",ie.gridTemplateColumns="1fr")}const ae={backgroundColor:le.cardBg,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:le.textPrimary,minWidth:"0",border:G?"1px solid #333":"none"},ne=e=>({backgroundColor:e,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),se={padding:"16px",borderBottom:`1px solid ${le.gridLine}`,margin:0,fontSize:"1.25rem",color:le.textPrimary,fontWeight:"bold"},de=({active:e,payload:t,label:r})=>{if(e&&t&&t.length){const e=t.find(e=>"Downloads"===e.dataKey||"total"===e.dataKey),l=e?.value??t[0]?.value??0,o=t[0]?.payload?.name??t[0]?.payload?.id??r??"Value";return(0,S.jsxs)("div",{style:{padding:"10px",backgroundColor:le.tooltipBg,border:`1px solid ${le.tooltipBorder}`,borderRadius:"5px",color:le.tooltipText},children:[(0,S.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:o}),(0,S.jsxs)("p",{children:["Downloads: ",v(l)]})]})}return null},ce=e=>{const{x:t,y:r,payload:l}=e;return(0,S.jsx)("g",{transform:`translate(${t},${r})`,children:(0,S.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:le.textSecondary,fontSize:10,title:l.value,children:l.value})})},pe=({current:e,onSelect:t,isDailyLoading:r})=>{const l=t=>({padding:"6px 12px",margin:"0 4px",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontWeight:"bold",backgroundColor:e===t?le.accentColor:le.cardBg,color:e===t?"white":le.textPrimary,border:`1px solid ${e===t?le.accentColor:le.gridLine}`,transition:"all 0.2s",boxShadow:e===t?"0 2px 4px rgba(0,0,0,0.2)":"none",fontSize:"14px",opacity:r&&e!==t?.6:1});return(0,S.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:"20px",paddingTop:"10px"},children:[1,7,15,30,90].map(e=>(0,S.jsxs)("button",{onClick:()=>t(e),style:l(e),disabled:r,children:[e,"D"]},e))})},ue=e=>{let t="desc";H.key===e&&"desc"===H.direction&&(t="asc"),V({key:e,direction:t})},xe=({sortKey:e})=>H.key!==e?(0,S.jsx)("span",{style:{fontSize:"0.7em",marginLeft:"5px",opacity:.4},dangerouslySetInnerHTML:{__html:"&#x25B2;&#x25BC;"}}):(0,S.jsx)("span",{style:{fontSize:"0.7em",marginLeft:"5px",color:le.accentColor},dangerouslySetInnerHTML:{__html:"asc"===H.direction?"&#x25B2;":"&#x25BC;"}}),ye=({data:e})=>(0,S.jsxs)("div",{style:{padding:"24px 16px 16px 16px"},children:[(0,S.jsx)("h3",{style:{fontSize:"1.25rem",color:le.textPrimary,fontWeight:"bold",marginBottom:"15px",textAlign:"center"},children:De}),(0,S.jsx)("div",{style:{overflowX:"auto"},children:(0,S.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed",fontSize:"14px",margin:"0"},children:[(0,S.jsxs)("colgroup",{children:[(0,S.jsx)("col",{style:{width:"auto"}}),(0,S.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,S.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,S.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,S.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}}),(0,S.jsx)("col",{style:{width:"1%",whiteSpace:"nowrap"}})]}),(0,S.jsx)("thead",{children:(0,S.jsxs)("tr",{style:{backgroundColor:G?"#333":"#f3f4f6"},children:[(0,S.jsxs)("th",{onClick:()=>ue("id"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:le.textPrimary,borderBottom:`2px solid ${le.accentColor}`},children:["Blueprint ID ",(0,S.jsx)(xe,{sortKey:"id"})]}),(0,S.jsxs)("th",{onClick:()=>ue("category"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:le.textPrimary,borderBottom:`2px solid ${le.accentColor}`,whiteSpace:"nowrap"},children:["Category ",(0,S.jsx)(xe,{sortKey:"category"})]}),(0,S.jsxs)("th",{onClick:()=>ue("library"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:le.textPrimary,borderBottom:`2px solid ${le.accentColor}`,whiteSpace:"nowrap"},children:["Library ",(0,S.jsx)(xe,{sortKey:"library"})]}),(0,S.jsxs)("th",{onClick:()=>ue("release"),style:{padding:"12px 8px",textAlign:"left",cursor:"pointer",color:le.textPrimary,borderBottom:`2px solid ${le.accentColor}`,whiteSpace:"nowrap"},children:["Release ",(0,S.jsx)(xe,{sortKey:"release"})]}),(0,S.jsxs)("th",{onClick:()=>ue("total"),style:{padding:"12px 8px",textAlign:"center",cursor:"pointer",color:le.textPrimary,borderBottom:`2px solid ${le.accentColor}`,whiteSpace:"nowrap"},children:["Downloads ",(0,S.jsx)(xe,{sortKey:"total"})]}),(0,S.jsxs)("th",{onClick:()=>ue("lastDownloaded"),style:{padding:"12px 8px",textAlign:"right",cursor:"pointer",color:le.textPrimary,borderBottom:`2px solid ${le.accentColor}`,whiteSpace:"nowrap"},children:["Last Downloaded ",(0,S.jsx)(xe,{sortKey:"lastDownloaded"})]})]})}),(0,S.jsx)("tbody",{children:e.map((e,t)=>(0,S.jsxs)("tr",{style:{borderBottom:`1px solid ${le.gridLine}`,backgroundColor:t%2==0?le.cardBg:G?"#2d2d2f":"#fcfcfc"},children:[(0,S.jsx)("td",{style:{padding:"10px 8px",wordBreak:"break-word",color:le.textPrimary,textAlign:"left"},children:e.blueprint_id}),(0,S.jsx)("td",{style:{padding:"10px 8px",color:Q(e.blueprint_category),textAlign:"left",whiteSpace:"nowrap"},children:e.blueprint_category}),(0,S.jsx)("td",{style:{padding:"10px 8px",textAlign:"left",color:le.textPrimary,whiteSpace:"nowrap"},children:e.blueprint_library??("ALL"!==R?R:"-")}),(0,S.jsx)("td",{style:{padding:"10px 8px",textAlign:"left",color:le.textPrimary,whiteSpace:"nowrap"},children:e.blueprint_release??"-"}),(0,S.jsx)("td",{style:{padding:"10px 8px",textAlign:"center",fontWeight:"bold",color:le.textPrimary,whiteSpace:"nowrap"},children:v(e.total)}),(0,S.jsx)("td",{style:{padding:"10px 8px",textAlign:"right",color:le.textPrimary,whiteSpace:"nowrap"},children:C(e.last_downloaded)})]},`${e.blueprint_category}:${e.blueprint_id}:${e.blueprint_library??"ALL"}:${e.blueprint_release??"ALL"}`))})]})}),0===e.length&&(0,S.jsx)("p",{style:{textAlign:"center",padding:"20px",color:le.textSecondary},children:"No detailed data found for the current selection."})]}),ge=(0,l.useMemo)(()=>"ALL"===z?"category":"ALL"===N?"blueprint":"ALL"===R?"library":"ALL"===K?"release":"detail",[z,N,R,K]),be=(0,l.useMemo)(()=>{const e=new Set;return te.forEach(t=>e.add(t.blueprint_category)),Array.from(e).sort()},[te]),he=(0,l.useMemo)(()=>{const e=new Set;return te.forEach(t=>{"ALL"!==z&&t.blueprint_category!==z||e.add(t.blueprint_id)}),Array.from(e).sort()},[te,z]),me=(0,l.useMemo)(()=>{const e=new Set;return te.forEach(t=>{"ALL"!==z&&t.blueprint_category!==z||"ALL"!==N&&t.blueprint_id!==N||t.blueprint_library&&e.add(t.blueprint_library)}),Array.from(e).sort()},[te,z,N]),fe=(0,l.useMemo)(()=>{const e=new Set;return te.forEach(t=>{if(!("ALL"!==z&&t.blueprint_category!==z||"ALL"!==N&&t.blueprint_id!==N)){if(F.length>0){if(!t.blueprint_library||!F.includes(t.blueprint_library))return}else if("ALL"!==R&&t.blueprint_library!==R)return;t.blueprint_release&&e.add(t.blueprint_release)}}),Array.from(e).sort()},[te,z,N,R,F]),Le=(0,l.useMemo)(()=>ee.map(e=>({name:e.blueprint_category,category:e.blueprint_category,value:e.total,total:e.total,label:e.blueprint_category})),[ee]),we=(0,l.useCallback)((e,t,r)=>{const l=new Map;return e.forEach(e=>{const o=t(e),i=l.get(o);i?(i.total+=e.total,e.last_downloaded&&(!i.last_downloaded||e.last_downloaded>i.last_downloaded)&&(i.last_downloaded=e.last_downloaded)):l.set(o,r(e))}),Array.from(l.values())},[]),_e=(0,l.useMemo)(()=>te.filter(e=>{if("ALL"!==z&&e.blueprint_category!==z)return!1;if("ALL"!==N&&e.blueprint_id!==N)return!1;if(F.length>0){if(!e.blueprint_library||!F.includes(e.blueprint_library))return!1}else if("ALL"!==R&&e.blueprint_library!==R)return!1;return"ALL"===K||e.blueprint_release===K}),[te,z,N,R,F,K]),je=(0,l.useMemo)(()=>"category"===ge||"blueprint"===ge?we(_e,e=>`${e.blueprint_category}::${e.blueprint_id}`,e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:null,blueprint_release:null,total:e.total,last_downloaded:e.last_downloaded})):"library"===ge?we(_e,e=>`${e.blueprint_category}::${e.blueprint_id}::${e.blueprint_library??""}`,e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:e.blueprint_library,blueprint_release:null,total:e.total,last_downloaded:e.last_downloaded})):"release"===ge?we(_e,e=>`${e.blueprint_category}::${e.blueprint_id}::${e.blueprint_library??""}::${e.blueprint_release??""}`,e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:e.blueprint_library,blueprint_release:e.blueprint_release,total:e.total,last_downloaded:e.last_downloaded})):_e.map(e=>({blueprint_category:e.blueprint_category,blueprint_id:e.blueprint_id,blueprint_library:e.blueprint_library,blueprint_release:e.blueprint_release,total:e.total,last_downloaded:e.last_downloaded})),[we,_e,ge]),Ae=(0,l.useMemo)(()=>{const e=[...je];return e.sort((e,t)=>{let r=0;const l=H.key;if("total"===l)r=e.total-t.total;else if("id"===l)r=e.blueprint_id.localeCompare(t.blueprint_id);else if("category"===l)r=e.blueprint_category.localeCompare(t.blueprint_category);else if("library"===l){const l=e.blueprint_library??"",o=t.blueprint_library??"";r=l.localeCompare(o)}else if("release"===l){const l=e.blueprint_release??"",o=t.blueprint_release??"";r=l.localeCompare(o)}else if("lastDownloaded"===l){r=(e.last_downloaded?new Date(e.last_downloaded).getTime():0)-(t.last_downloaded?new Date(t.last_downloaded).getTime():0)}return"asc"===H.direction?r:-r}),e},[je,H]),Se=(0,l.useMemo)(()=>Ae.slice(0,P).map(e=>{const t=[e.blueprint_id];"library"!==ge&&"release"!==ge&&"detail"!==ge||e.blueprint_library&&t.push(e.blueprint_library),"release"!==ge&&"detail"!==ge||e.blueprint_release&&t.push(e.blueprint_release);const r=t.join(" \u2022 "),l=r.length>60?`${r.substring(0,57)}...`:r;return{id:e.blueprint_id,label:l,blueprint_library:e.blueprint_library??null,blueprint_release:e.blueprint_release??null,Downloads:e.total}}),[Ae,P,ge]),ve=(0,l.useCallback)(()=>{M("ALL"),W("ALL"),U("ALL"),I("ALL")},[]),Ce=(0,l.useCallback)(()=>{W("ALL"),U("ALL"),I("ALL")},[]),ke=(0,l.useCallback)(()=>{U("ALL"),I("ALL")},[]),$e=(0,l.useCallback)(()=>{I("ALL")},[]),Be=()=>{ve()},De=(0,l.useMemo)(()=>"category"===ge?"Top Blueprints (all categories)":"blueprint"===ge?`Top Blueprints (${z})`:"library"===ge?`Libraries for ${N}`:"release"===ge?`Releases for ${N} \u2192 ${R}`:`Release details: ${N} \u2192 ${R} \u2192 ${K}`,[ge,z,N,R,F,K]),Te=(0,l.useMemo)(()=>{const e=[{label:"Categories",onClick:ve}];return"ALL"!==z&&e.push({label:z,onClick:Ce}),"ALL"!==N&&e.push({label:N,onClick:ke}),"ALL"!==R&&e.push({label:R,onClick:$e}),"ALL"!==K&&e.push({label:K,onClick:()=>{}}),e},[Ce,ve,ke,$e,z,N,R,F,K]),Pe=(0,l.useCallback)(()=>{if("undefined"==typeof window)return!1;const e=window?.env||{};return Boolean(e.SUPABASE_URL&&e.SUPABASE_ANON_KEY)},[]);return(0,l.useEffect)(()=>{if("undefined"!=typeof window){if(!Pe()){const e=[{blueprint_category:"controllers",blueprint_id:"mock-ikea_e2001_e2002",blueprint_library:"EPMatt",blueprint_release:"awesome",total:1e4,last_downloaded:"2025-11-19T10:30:00Z"},{blueprint_category:"controllers",blueprint_id:"mock-ikea_e2001_e2002",blueprint_library:"yarafie",blueprint_release:"anything",total:5e3,last_downloaded:"2025-11-21T10:30:00Z"},{blueprint_category:"hooks",blueprint_id:"mock-light",blueprint_library:"EPMatt",blueprint_release:"awesome",total:5e3,last_downloaded:"2025-11-18T10:30:00Z"},{blueprint_category:"automations",blueprint_id:"mock-addon_update_notification",blueprint_library:"EPMatt",blueprint_release:"awesome",total:250,last_downloaded:"2025-11-22T10:30:00Z"}],r=e.reduce((e,t)=>e+t.total,0),l=new Map;e.forEach(e=>{l.set(e.blueprint_category,(l.get(e.blueprint_category)??0)+e.total)});const o=Array.from(l.entries()).map(([e,t])=>({blueprint_category:e,total:t}));return t(t=>({...t,totalDownloads:r,byCategory:o,aggregates:e})),B("Supabase variables missing. Showing mock aggregate data instead."),void L(!1)}(async()=>{try{const e=await(async e=>{const t=j();if(!t)throw new Error("Supabase Client not initialized (Check Env Vars)");const r={p_category:e.category||null,p_library:e.library||null,p_release:e.release||null,p_id:e.id||null},{data:l,error:o}=await t.rpc("get_library_downloads_aggregates",r);if(o)throw new Error(`RPC Error: ${o.message} (Details: ${o.details})`);return(l||[]).map(e=>({blueprint_category:e.blueprint_category,blueprint_library:e.blueprint_library,blueprint_release:e.blueprint_release,blueprint_id:e.blueprint_id,total:Number(e.total_downloads||0),last_downloaded:e.last_downloaded}))})({}),r=e.reduce((e,t)=>e+t.total,0),l=new Map;e.forEach(e=>{l.set(e.blueprint_category,(l.get(e.blueprint_category)??0)+e.total)});const o=Array.from(l.entries()).map(([e,t])=>({blueprint_category:e,total:t}));t(t=>({...t,totalDownloads:r,byCategory:o,aggregates:e})),B(void 0)}catch(e){B(`Failed to load aggregate metrics: ${e?.message||"Unknown error."}`)}finally{L(!1)}})()}},[Pe]),(0,l.useEffect)(()=>{if(r)return;if("undefined"==typeof window)return;if(!Pe()){const e=[{day:new Date(Date.now()-864e6).toISOString().substring(0,10),total:10},{day:new Date(Date.now()-432e6).toISOString().substring(0,10),total:20},{day:(new Date).toISOString().substring(0,10),total:22}],r=k(e,D);return t(e=>({...e,daily:r})),void _(!1)}_(!0);const e="ALL"===z?null:z,l="ALL"===N?null:N,o=F.length?F:"ALL"===R?[]:[R];(async()=>{try{let r=[];if(o.length<=1){const t=F.length?F:"ALL"===R?[]:[R];if(t.length<=1){const o=1===t.length?t[0]:null;r=await A({days:D,category:e,id:l,library:o,release:"ALL"!==K?K:null})}else{const o=await Promise.all(t.map(t=>A({days:D,category:e,id:l,library:t,release:"ALL"!==K?K:null}))),i=new Map;for(const e of o)for(const t of e)i.set(t.day,(i.get(t.day)??0)+Number(t.total??0));r=Array.from(i.entries()).sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>({day:e,total:t}))}}else{const t=await Promise.all(o.map(t=>A({days:D,category:e,id:l,library:t,release:"ALL"!==K?K:null}))),i=new Map;for(const e of t)for(const t of e)i.set(t.day,(i.get(t.day)??0)+Number(t.total??0));r=Array.from(i.entries()).sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>({day:e,total:t}))}const i=k(r,D);t(e=>({...e,daily:i}))}catch(r){B(`Failed to load daily metrics: ${r?.message||"Unknown error."}`)}finally{_(!1)}})()},[Pe,r,D,z,N,R,F,K]),(0,S.jsx)(o.A,{title:"Library Downloads Metrics",description:"Enhanced metrics dashboard with library-aware analytics",children:(0,S.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:le.bg,transition:"background-color 0.3s ease",minHeight:"100vh",padding:"2rem"},children:[(0,S.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold",color:le.textPrimary},children:"Library Download Metrics Dashboard"}),r&&(0,S.jsx)("div",{style:{textAlign:"center",color:le.textPrimary},children:"Loading core metrics..."}),!r&&$&&(0,S.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,S.jsx)("h4",{className:"alert__heading",children:"Metrics Notice"}),(0,S.jsx)("p",{children:$})]}),!r&&(0,S.jsxs)("div",{style:{width:"100%"},children:[(0,S.jsxs)("section",{style:oe,children:[(0,S.jsxs)("div",{style:ae,children:[(0,S.jsx)("div",{style:ne(le.accentColor),children:"Total Downloads"}),(0,S.jsx)("div",{style:{padding:"24px",textAlign:"center"},children:(0,S.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:le.accentColor,margin:0},children:v(J)})})]}),(0,S.jsxs)("div",{style:ae,children:[(0,S.jsx)("div",{style:ne("#9333ea"),children:"Tracked Blueprints (rows)"}),(0,S.jsx)("div",{style:{padding:"24px",textAlign:"center"},children:(0,S.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:v(te.length)})})]})]}),(0,S.jsxs)("section",{style:{...ae,marginBottom:"24px"},children:[(0,S.jsx)("div",{style:ne("#0ea5e9"),children:"Library View - Selection"}),(0,S.jsxs)("div",{style:{padding:"16px"},children:[(0,S.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",alignItems:"center"},children:[Te.map((e,t)=>(0,S.jsxs)(l.Fragment,{children:[(0,S.jsx)("button",{type:"button",onClick:e.onClick,style:{padding:"6px 10px",borderRadius:"6px",border:`1px solid ${le.gridLine}`,background:le.cardBg,color:le.textPrimary,cursor:t===Te.length-1?"default":"pointer",opacity:t===Te.length-1?.9:1,fontWeight:t===Te.length-1?"bold":"normal"},disabled:t===Te.length-1,children:e.label}),t<Te.length-1&&(0,S.jsx)("span",{style:{color:le.textSecondary},children:"\u203a"})]},e.label)),(0,S.jsx)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px",flexWrap:"wrap"},children:(0,S.jsx)("button",{type:"button",onClick:Be,style:{padding:"6px 10px",borderRadius:"6px",border:`1px solid ${le.gridLine}`,background:G?"#2d2d2f":"#f3f4f6",color:le.textPrimary,cursor:"pointer",fontWeight:"bold"},children:"Reset"})})]}),(0,S.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:"12px",marginTop:"14px"},children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontSize:"12px",color:le.textSecondary,marginBottom:"6px"},children:"Category"}),(0,S.jsxs)("select",{value:z,onChange:e=>{const t=e.target.value;M(t),W("ALL"),U("ALL"),I("ALL")},style:{width:"100%",padding:"8px",borderRadius:"6px"},children:[(0,S.jsx)("option",{value:"ALL",children:"ALL"}),be.map(e=>(0,S.jsx)("option",{value:e,children:e},e))]})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontSize:"12px",color:le.textSecondary,marginBottom:"6px"},children:"Blueprint"}),(0,S.jsxs)("select",{value:N,onChange:e=>{const t=e.target.value;W(t),U("ALL"),I("ALL")},style:{width:"100%",padding:"8px",borderRadius:"6px"},disabled:"ALL"===z,children:[(0,S.jsx)("option",{value:"ALL",children:"ALL"}),he.map(e=>(0,S.jsx)("option",{value:e,children:e},e))]})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontSize:"12px",color:le.textSecondary,marginBottom:"6px"},children:"Library"}),(0,S.jsxs)("select",{value:R,onChange:e=>{const t=e.target.value;U(t),I("ALL")},style:{width:"100%",padding:"8px",borderRadius:"6px"},disabled:"ALL"===z||"ALL"===N,children:[(0,S.jsx)("option",{value:"ALL",children:"ALL"}),me.map(e=>(0,S.jsx)("option",{value:e,children:e},e))]})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontSize:"12px",color:le.textSecondary,marginBottom:"6px"},children:"Release"}),(0,S.jsxs)("select",{value:K,onChange:e=>I(e.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px"},disabled:"ALL"===z||"ALL"===N||"ALL"===R||F.length>1,children:[(0,S.jsx)("option",{value:"ALL",children:"ALL"}),fe.map(e=>(0,S.jsx)("option",{value:e,children:e},e))]}),(0,S.jsx)("div",{style:{marginTop:"8px"},children:(0,S.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",color:le.textSecondary},title:"Optional: enable only if you later add a version-aware analytics RPC",children:[(0,S.jsx)("input",{type:"checkbox",checked:Y,onChange:e=>Z(e.target.checked),disabled:!0}),"Version (optional)"]})})]})]})]})]}),(0,S.jsxs)("section",{style:ie,children:[(0,S.jsxs)("div",{style:ae,children:[(0,S.jsxs)("h3",{style:se,children:["Daily Downloads (Last ",D," Days)"]}),(0,S.jsx)(pe,{current:D,onSelect:T,isDailyLoading:w}),(0,S.jsxs)("div",{style:{height:"350px",padding:"10px",position:"relative"},children:[w&&(0,S.jsx)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:G?"rgba(36, 37, 38, 0.8)":"rgba(255, 255, 255, 0.8)",zIndex:10,borderRadius:"4px",color:le.textPrimary,fontSize:"1.2rem",fontWeight:"bold"},children:"Updating chart..."}),(0,S.jsx)(i.u,{width:"100%",height:"100%",children:(0,S.jsxs)(a.Q,{data:re,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,S.jsx)("defs",{children:(0,S.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,S.jsx)("stop",{offset:"5%",stopColor:le.accentColor,stopOpacity:.8}),(0,S.jsx)("stop",{offset:"95%",stopColor:le.accentColor,stopOpacity:0})]})}),(0,S.jsx)(n.d,{strokeDasharray:"3 3",stroke:le.gridLine,vertical:!1}),(0,S.jsx)(s.W,{dataKey:"label",stroke:le.textSecondary,tick:{fontSize:10,fill:le.textSecondary}}),(0,S.jsx)(d.h,{allowDecimals:!1,stroke:le.textSecondary,tick:{fontSize:10,fill:le.textSecondary},tickFormatter:v}),(0,S.jsx)(c.m,{content:(0,S.jsx)(de,{})}),(0,S.jsx)(p.Gk,{type:"monotone",dataKey:"total",stroke:le.accentColor,strokeWidth:3,fill:"url(#colorTotal)"})]})})]})]}),(0,S.jsxs)("div",{style:ae,children:[(0,S.jsx)("h3",{style:se,children:"Category Distribution (Click to filter)"}),(0,S.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,S.jsx)(i.u,{width:"100%",height:"100%",children:(0,S.jsxs)(u.r,{children:[(0,S.jsx)(x.Fq,{data:Le,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:e})=>`${(100*e).toFixed(0)}%`,onClick:e=>{const t=e?.category;t&&(M(e=>e===t?"ALL":t),W("ALL"),U("ALL"),I("ALL"))},style:{cursor:"pointer"},children:Le.map((e,t)=>(0,S.jsx)(y.f,{fill:Q(e.category),stroke:G?"#242526":"#fff",opacity:"ALL"===z||z===e.category?1:.4},`cell-${t}`))}),(0,S.jsx)(c.m,{content:(0,S.jsx)(de,{})}),(0,S.jsx)(g.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:le.textPrimary}})]})})})]})]}),(0,S.jsxs)("section",{style:{...ae,paddingBottom:"20px",marginBottom:"32px"},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",borderBottom:`1px solid ${le.gridLine}`,flexWrap:"wrap",gap:"8px"},children:[(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1,minWidth:0},children:[(0,S.jsx)("h3",{style:{...se,borderBottom:"none",paddingLeft:0,margin:0},children:"ALL"===z?`Top ${P} Blueprints`:F.length>0?`Top ${P} Blueprints (Libraries: ${F.length})`:"ALL"!==R?`Top ${P} Blueprints (${R})`:`Top ${P} ${z.charAt(0).toUpperCase()+z.slice(1)} Blueprints`}),me.length>0&&(0,S.jsxs)("div",{style:{margin:"8px 0 8px 0"},children:[(0,S.jsx)("label",{style:{fontSize:"0.85rem",marginRight:"8px",color:le.textSecondary},children:"Library:"}),(0,S.jsxs)("select",{value:R,onChange:e=>{const t=e.target.value;U(t),O([]),"ALL"===t&&I("ALL")},style:{padding:"4px 8px",fontSize:"0.85rem",borderRadius:"4px",border:`1px solid ${le.gridLine}`,background:"var(--ifm-navbar-background-color)",color:"var(--ifm-font-color-base)"},children:[(0,S.jsx)("option",{value:"ALL",children:"All Libraries"}),me.map(e=>(0,S.jsx)("option",{value:e,children:e},e))]}),(0,S.jsxs)("div",{style:{marginTop:"10px"},children:[(0,S.jsx)("div",{style:{fontSize:"0.8rem",color:le.textSecondary,marginBottom:"6px"},children:"Compare libraries (multi-select):"}),(0,S.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",maxHeight:"84px",overflowY:"auto",padding:"6px",border:`1px solid ${le.gridLine}`,borderRadius:"6px"},children:[me.map(e=>{const t=F.includes(e);return(0,S.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:"6px",fontSize:"0.8rem",cursor:"pointer",userSelect:"none"},children:[(0,S.jsx)("input",{type:"checkbox",checked:t,onChange:()=>{O(r=>{const l=t?r.filter(t=>t!==e):[...r,e];return 1===l.length?U(l[0]):U("ALL"),1!==l.length&&I("ALL"),l})}}),(0,S.jsx)("span",{style:{color:le.textPrimary},children:e})]},e)}),0===me.length&&(0,S.jsx)("span",{style:{color:le.textSecondary},children:"No libraries found for current selection."})]}),F.length>1&&(0,S.jsx)("div",{style:{marginTop:"6px",fontSize:"0.75rem",color:le.textSecondary},children:"Release drill-down is disabled while comparing multiple libraries."})]})]})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("select",{value:P,onChange:e=>E(Number(e.target.value)),style:{appearance:"none",padding:"6px 32px 6px 10px",fontSize:"14px",cursor:"pointer",backgroundColor:"var(--ifm-navbar-background-color)",color:"var(--ifm-font-color-base)",border:"1px solid var(--ifm-color-emphasis-300)",borderRadius:"6px"},children:[5,10,15,20,25,30,40,50].map(e=>(0,S.jsxs)("option",{value:e,children:["Top ",e]},e))}),(0,S.jsx)("svg",{style:{position:"absolute",right:"10px",top:"50%",width:"14px",height:"14px",transform:"translateY(-50%)",opacity:.7,pointerEvents:"none"},viewBox:"0 0 24 24",children:(0,S.jsx)("path",{fill:"currentColor",d:"M7 10l5 5 5-5z"})})]}),("ALL"!==z||"ALL"!==R)&&(0,S.jsx)("button",{onClick:Be,style:{fontSize:"12px",padding:"6px 10px",borderRadius:"4px",backgroundColor:"#ef4444",color:"white",border:"none",cursor:"pointer",fontWeight:"bold",transition:"background-color 0.2s",whiteSpace:"nowrap"},title:"Clear category/library filters",children:"Clear Filters"})]})]}),(0,S.jsx)("div",{style:{height:Math.max(400,40*Se.length)},children:Se.length>0?(0,S.jsx)(i.u,{width:"100%",height:"100%",children:(0,S.jsxs)(b.E,{onClick:e=>{const t=e?.id;if(t){if("ALL"===z){const e=te.find(e=>e.blueprint_id===t);e&&M(e.blueprint_category)}W(t),U("ALL"),I("ALL")}},data:Se,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,S.jsx)(n.d,{strokeDasharray:"3 3",horizontal:!1,stroke:le.gridLine}),(0,S.jsx)(s.W,{type:"number",stroke:le.textSecondary,tick:{fontSize:10,fill:le.textSecondary},tickFormatter:v,domain:[0,"auto"],allowDecimals:!1}),(0,S.jsx)(d.h,{dataKey:"label",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,S.jsx)(ce,{})}),(0,S.jsx)(c.m,{content:(0,S.jsx)(de,{})}),(0,S.jsx)(g.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:le.textPrimary}}),(0,S.jsx)(h.yP,{dataKey:"Downloads",name:"# of Downloads",barSize:20,radius:[0,4,4,0],children:Se.map((e,t)=>(0,S.jsx)(y.f,{fill:X(e.id)},`cell-${e.id}-${e.blueprint_library??"ALL"}-${e.blueprint_release??"ALL"}-${t}`))})]})}):(0,S.jsx)("p",{style:{textAlign:"center",padding:"50px",color:le.textSecondary},children:"No top blueprints found for the current selection."})})]}),(0,S.jsx)("section",{style:{...ae,overflow:"visible"},children:(0,S.jsx)(ye,{data:Ae})})]})]})})}}}]);