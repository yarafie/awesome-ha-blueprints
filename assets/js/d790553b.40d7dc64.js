"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[2574],{1170:(e,r,t)=>{t.d(r,{Dk:()=>l,PG:()=>c});var n=t(78570),o=t(4784);let i=null;const a=()=>{if(i)return i;const e=(o.default?.customFields||{}).env||{},r=e.SUPABASE_URL,t=e.SUPABASE_ANON_KEY;return r&&t&&s({supabaseUrl:r,supabaseKey:t}),i},s=({supabaseUrl:e,supabaseKey:r})=>{i=(0,n.UU)(e,r),console.log("Supabase initialized")},l=async(e,r,t="latest",n=null)=>{if(!a())return console.error("Supabase client not initialized"),!1;try{const{error:o}=await i.from("blueprint_downloads").insert([{blueprint_category:e,blueprint_id:r,blueprint_version:t,blueprint_variant:n,download_date:(new Date).toISOString()}]);return!o||(console.error("Error recording blueprint download:",o),!1)}catch(o){return console.error("Exception recording blueprint download:",o),!1}},c=async(e,r,t=null,n=null)=>{if(!a())return console.error("Supabase client not initialized"),0;try{const{data:o,error:a}=await i.rpc("get_blueprint_downloads",{p_category:e,p_id:r,p_variant:t,p_version:n});return a?(console.error("Error getting blueprint downloads via RPC:",a),0):"number"==typeof o?o:0}catch(o){return console.error("Exception getting blueprint downloads:",o),0}}},22122:(e,r,t)=>{t.r(r),t.d(r,{default:()=>c});var n=t(23303),o=t(50402),i=t(54185),a=t(63883),s=t(1170),l=t(27711);function c(e){const r=e.route.category,t=e.route.id,{consent:c}=(0,i.S)(),d=(()=>{if("undefined"!=typeof window){return new URLSearchParams(window.location.search).get("version")||"latest"}return"latest"})(),u=(()=>{if("undefined"!=typeof window){const r=new URLSearchParams(window.location.search).get("variant");return r&&r.trim().length>0?r:e.route.variant||null}return e.route.variant||null})();let p;if("controllers"===r){u||"undefined"==typeof window||console.error("Missing variant for controller download route.");let n=d;if("latest"===n&&u&&e.route.variantsById?.[u]){n=e.route.variantsById[u].sort((e,r)=>r.localeCompare(e))[0]}p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${t}/${`${u}/${n}/${t}.yaml`}`}else p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${t}/${t}.yaml`;const w="https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url="+encodeURIComponent(p);let b=d;if("controllers"===r&&"latest"===d&&u&&e.route.variantsById?.[u]){const r=e.route.variantsById[u].sort((e,r)=>r.localeCompare(e));b=r[0]}return(0,n.useEffect)(()=>{c&&(0,a.sx)("blueprint","download","controllers"===r?`${r}/${t}/${u}/${b}`:`${r}/${t}`,void 0);const e={category:r,id:t,variant:u||null,version:b};(0,s.Dk)(e.category,e.id,e.version,e.variant).then(e=>{e||console.error("Failed to record blueprint download in database")}).catch(e=>{console.error("Error recording blueprint download:",e)}).finally(()=>{(e=>{try{const r="my.home-assistant.io";new URL(e).hostname===r?window.location.href=e:console.error("Unsafe redirect blocked:",e)}catch{console.error("Invalid redirect URL:",e)}})(w)})},[c,r,t,u,d,w]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.A,{children:(0,l.jsxs)("title",{children:["Download ",r,"/",t,d?`/${d}`:"",u?`/${u}`:""]})}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"20px"},children:[(0,l.jsx)("h1",{children:"Thanks for downloading!"}),(0,l.jsx)("p",{children:"Redirecting to your Home Assistant instance..."})]})]})}}}]);