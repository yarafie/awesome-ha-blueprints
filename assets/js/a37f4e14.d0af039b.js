"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(e,a,s)=>{s.r(a),s.d(a,{default:()=>b});var t=s(3303),r=s(1153),l=s(9324),o=s(162),i=s(6605),d=s(5825),n=s(7554),c=s(7342),h=s(2941),m=s(7519),x=s(2454),g=s(7711);const b=()=>{const[e,a]=(0,t.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),{loading:s,error:b,totalDownloads:y,byCategory:u,topBlueprints:j,daily:w}=e;(0,t.useEffect)(()=>{const e=window?.env?.SUPABASE_URL,s=window?.env?.SUPABASE_ANON_KEY;if(!e||!s)return void a(e=>({...e,loading:!1,error:"Supabase environment variables are not available. Check SUPABASE_URL and SUPABASE_ANON_KEY."}));const t={"Content-Type":"application/json",apikey:s,Authorization:`Bearer ${s}`},r=async(e,a,s=3)=>{for(let t=0;t<s;t++)try{const r=await fetch(e,a);if(r.ok)return r;if(429===r.status&&t<s-1){const e=1e3*Math.pow(2,t)+1e3*Math.random();await new Promise(a=>setTimeout(a,e));continue}{const e=await r.text();throw new Error(`HTTP error! Status: ${r.status}. Response: ${e.substring(0,100)}...`)}}catch(b){if(t===s-1)throw b}};!async function(){try{const[s,l,o,i]=await Promise.all([r(`${e}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:t,body:JSON.stringify({})}),r(`${e}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:t,body:JSON.stringify({})}),r(`${e}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:t,body:JSON.stringify({})}),r(`${e}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:t,body:JSON.stringify({p_days:30})})]),d=await s.json(),n=await l.json(),c=await o.json(),h=await i.json();let m=0;Array.isArray(d)&&d.length>0?m=Number(d[0].total):"number"==typeof d&&(m=d);const x=Array.isArray(n)?n:[],g=Array.isArray(c)?c:[],b=Array.isArray(h)?h.map(e=>({label:new Date(e.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(e.total)})).sort((e,a)=>{const s=new Date(e.label),t=new Date(a.label);return s.getTime()-t.getTime()}):[];a({loading:!1,error:void 0,totalDownloads:m,byCategory:x,topBlueprints:g,daily:b})}catch(s){console.error("Error fetching download metrics",s),a(e=>({...e,loading:!1,error:`Failed to load metrics from Supabase. Error: ${s.message||"Unknown error."}`}))}}()},[]);const N=e=>e.toLocaleString(),p=Math.max(...j.map(e=>Number(e.total)),1);return(0,g.jsx)(r.A,{title:"Blueprint Download Metrics",description:"Download metrics for Awesome HA Blueprints",children:(0,g.jsxs)("main",{className:"container margin-vert--lg",children:[(0,g.jsx)("h1",{className:"text--center margin-bottom--lg",children:"Blueprint Download Metrics"}),s&&(0,g.jsxs)("div",{className:"text--center margin-vert--lg p-4 bg-gray-100 rounded-lg",children:[(0,g.jsx)("div",{className:"margin-bottom--sm text-xl font-semibold text-gray-700",children:"Loading metrics from Supabase..."}),(0,g.jsx)("small",{className:"text-gray-500",children:"Please ensure your Supabase URL / Anon key are set and the RPC functions are public."})]}),!s&&b&&(0,g.jsxs)("div",{className:"alert alert--danger shadow-lg",role:"alert",children:[(0,g.jsx)("h4",{className:"alert__heading",children:"Error loading metrics"}),(0,g.jsx)("p",{children:b})]}),!s&&!b&&(0,g.jsxs)("div",{className:"space-y-12",children:[(0,g.jsxs)("section",{className:"row",children:[(0,g.jsx)("div",{className:"col col--4 mb-4",children:(0,g.jsxs)("div",{className:"card shadow-lg hover:shadow-xl transition-shadow duration-300",children:[(0,g.jsx)("div",{className:"card__header bg-blue-500 text-white rounded-t-lg",children:(0,g.jsx)("h3",{className:"font-bold text-lg",children:"Total Downloads"})}),(0,g.jsx)("div",{className:"card__body",children:(0,g.jsx)("p",{className:"text-5xl font-extrabold text-blue-700 m-0",children:N(y)})})]})}),(0,g.jsx)("div",{className:"col col--4 mb-4",children:(0,g.jsxs)("div",{className:"card shadow-lg hover:shadow-xl transition-shadow duration-300",children:[(0,g.jsx)("div",{className:"card__header bg-green-500 text-white rounded-t-lg",children:(0,g.jsx)("h3",{className:"font-bold text-lg",children:"Unique Categories"})}),(0,g.jsx)("div",{className:"card__body",children:(0,g.jsx)("p",{className:"text-5xl font-extrabold text-green-700 m-0",children:N(u.length)})})]})}),(0,g.jsx)("div",{className:"col col--4 mb-4",children:(0,g.jsxs)("div",{className:"card shadow-lg hover:shadow-xl transition-shadow duration-300",children:[(0,g.jsx)("div",{className:"card__header bg-purple-500 text-white rounded-t-lg",children:(0,g.jsx)("h3",{className:"font-bold text-lg",children:"Top Blueprints Tracked"})}),(0,g.jsx)("div",{className:"card__body",children:(0,g.jsx)("p",{className:"text-5xl font-extrabold text-purple-700 m-0",children:N(j.length)})})]})})]}),(0,g.jsxs)("section",{className:"row",children:[(0,g.jsx)("div",{className:"col col--6 mb-4",children:(0,g.jsxs)("div",{className:"card shadow-lg",children:[(0,g.jsx)("div",{className:"card__header",children:(0,g.jsx)("h3",{className:"font-semibold text-xl",children:"Downloads in Last 30 Days"})}),(0,g.jsx)("div",{className:"card__body",style:{height:350},children:0===w.length?(0,g.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500",children:"No recent downloads to chart yet."}):(0,g.jsx)(o.u,{width:"100%",height:"100%",children:(0,g.jsxs)(m.b,{data:w,margin:{top:5,right:30,left:20,bottom:5},children:[(0,g.jsx)(i.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,g.jsx)(c.W,{dataKey:"label",stroke:"#555",tick:{fontSize:10}}),(0,g.jsx)(h.h,{allowDecimals:!1,stroke:"#555"}),(0,g.jsx)(l.m,{formatter:e=>[`${N(e)} downloads`,"Total"],labelFormatter:e=>`Date: ${e}`}),(0,g.jsx)(d.N,{type:"monotone",dataKey:"total",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:3},activeDot:{r:5}})]})})})]})}),(0,g.jsx)("div",{className:"col col--6 mb-4",children:(0,g.jsxs)("div",{className:"card shadow-lg",children:[(0,g.jsx)("div",{className:"card__header",children:(0,g.jsx)("h3",{className:"font-semibold text-xl",children:"Downloads by Category"})}),(0,g.jsx)("div",{className:"card__body",style:{height:350},children:0===u.length?(0,g.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500",children:"No data yet. Download some blueprints to see metrics here."}):(0,g.jsx)(o.u,{width:"100%",height:"100%",children:(0,g.jsxs)(x.E,{data:u.map(e=>({...e,total:Number(e.total)})),layout:"vertical",margin:{top:20,right:30,left:20,bottom:5},children:[(0,g.jsx)(i.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,g.jsx)(c.W,{type:"number",allowDecimals:!1,stroke:"#555"}),(0,g.jsx)(h.h,{dataKey:"blueprint_category",type:"category",stroke:"#555",tick:{fontSize:10}}),(0,g.jsx)(l.m,{formatter:e=>[`${N(e)} downloads`,"Total"],labelFormatter:e=>`Category: ${e}`}),(0,g.jsx)(n.y,{dataKey:"total",fill:"#10b981"})]})})})]})})]}),(0,g.jsx)("section",{className:"row",children:(0,g.jsx)("div",{className:"col col--12",children:(0,g.jsxs)("div",{className:"card shadow-lg",children:[(0,g.jsx)("div",{className:"card__header",children:(0,g.jsx)("h3",{className:"font-semibold text-xl",children:"Top Blueprints"})}),(0,g.jsx)("div",{className:"card__body",children:0===j.length?(0,g.jsx)("p",{className:"text-gray-500",children:"No downloads recorded yet for individual blueprints."}):(0,g.jsx)("div",{className:"space-y-2",children:j.slice(0,25).map((e,a)=>(0,g.jsxs)("div",{className:"flex items-center space-x-4 p-2 border-b last:border-b-0 border-gray-100",children:[(0,g.jsxs)("span",{className:"font-mono text-xs w-6 text-center text-gray-500",children:[a+1,"."]}),(0,g.jsxs)("span",{className:"flex-1 font-medium text-gray-800",children:[(0,g.jsx)("span",{className:"font-semibold",children:e.blueprint_category}),(0,g.jsx)("span",{className:"text-gray-400",children:" / "}),e.blueprint_id]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2 w-32 justify-end",children:[(0,g.jsx)("span",{className:"text-sm font-bold text-indigo-600 w-12 text-right",children:N(Number(e.total))}),(0,g.jsx)("div",{className:"relative w-20 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,g.jsx)("div",{className:"absolute inset-y-0 left-0 bg-indigo-400 rounded-full transition-all duration-500",style:{width:Number(e.total)/p*100+"%"}})})]})]},`${e.blueprint_category}-${e.blueprint_id}-${a}`))})})]})})})]})]})})}}}]);