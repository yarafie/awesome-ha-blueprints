"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var r=a(3303),l=a(1153),o=a(6285),s=a(4538),i=a(162),n=a(656),d=a(351),c=a(6605),x=a(9441),h=a(2782),m=a(7342),g=a(2941),b=a(2454),p=a(7263),u=a(50),y=a(1929),w=a(1778),f=a(7711);const j="#6b7280",v=()=>{const[e,t]=(0,r.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),{loading:a,error:v,totalDownloads:N,byCategory:_,topBlueprints:D,daily:S}=e,k=(0,y.A)(w.A);(0,r.useEffect)(()=>{const e=window?.env?.SUPABASE_URL,a=window?.env?.SUPABASE_ANON_KEY;if(!e||!a){const e=1234567,a=[{blueprint_category:"controllers",total:"900000"},{blueprint_category:"hooks",total:"280000"},{blueprint_category:"templates",total:"54000"}],r=[{blueprint_category:"hooks",blueprint_id:"thertetsat_controlv2_30_days_ago",total:"50000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"45000"},{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"}],l=[{day:new Date(Date.now()-432e6).toISOString().split("T")[0],total:"10"},{day:new Date(Date.now()-3456e5).toISOString().split("T")[0],total:"12"},{day:new Date(Date.now()-2592e5).toISOString().split("T")[0],total:"15"},{day:new Date(Date.now()-1728e5).toISOString().split("T")[0],total:"20"},{day:new Date(Date.now()-864e5).toISOString().split("T")[0],total:"18"},{day:(new Date).toISOString().split("T")[0],total:"22"}].map(e=>({label:new Date(e.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(e.total)})).sort((e,t)=>new Date(e.label).getTime()-new Date(t.label).getTime());return void t(t=>({...t,loading:!1,error:"Supabase environment variables are missing. Displaying mock data for layout purposes.",totalDownloads:e,byCategory:a,topBlueprints:r,daily:l}))}const r={"Content-Type":"application/json",apikey:a,Authorization:`Bearer ${a}`},l=async(e,t,a=3)=>{for(let r=0;r<a;r++)try{const l=await fetch(e,t);if(l.ok)return l;if(429===l.status&&r<a-1){const e=1e3*Math.pow(2,r)+1e3*Math.random();await new Promise(t=>setTimeout(t,e));continue}{const e=await l.text();throw new Error(`HTTP error! Status: ${l.status}. Response: ${e.substring(0,100)}...`)}}catch(v){if(r===a-1)throw v}};!async function(){try{const[a,o,s,i]=await Promise.all([l(`${e}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:r,body:JSON.stringify({})}),l(`${e}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:r,body:JSON.stringify({})}),l(`${e}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:r,body:JSON.stringify({})}),l(`${e}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:r,body:JSON.stringify({p_days:30})})]),n=await a.json(),d=await o.json(),c=await s.json(),x=await i.json();let h=0;Array.isArray(n)&&n.length>0?h=Number(n[0].total):"number"==typeof n&&(h=n);const m=Array.isArray(d)?d:[],g=Array.isArray(c)?c:[],b=Array.isArray(x)?x.map(e=>({label:new Date(e.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(e.total)})).sort((e,t)=>{const a=new Date(e.label),r=new Date(t.label);return a.getTime()-r.getTime()}):[];t({loading:!1,error:void 0,totalDownloads:h,byCategory:m,topBlueprints:g,daily:b})}catch(a){console.error("Error fetching download metrics",a),t(e=>({...e,loading:!1,error:`Failed to load metrics from Supabase. Error: ${a.message||"Unknown error."}`}))}}()},[]);const T=e=>e.toLocaleString(),A=_.map(e=>({name:e.blueprint_category,category:e.blueprint_category,value:Number(e.total),total:Number(e.total),label:e.blueprint_category})),O=D.slice(0,10).map(e=>({id:e.blueprint_id,name:e.blueprint_id.length>40?e.blueprint_id.substring(0,37)+"...":e.blueprint_id,value:Number(e.total)})).reverse(),$=({active:e,payload:t,label:a})=>{if(e&&t&&t.length){const e=t[0].payload;return(0,f.jsxs)("div",{className:"p-3 bg-white border border-gray-300 shadow-xl rounded-lg text-sm text-gray-700",children:[(0,f.jsx)("p",{className:"font-bold text-indigo-600 mb-1",children:e.name||e.id||a}),(0,f.jsxs)("p",{children:[(0,f.jsx)("span",{className:"font-semibold",children:"Downloads:"})," ",T(e.value||t[0].value)]})]})}return null},B=e=>{const{x:t,y:a,payload:r}=e;return(0,f.jsx)("g",{transform:`translate(${t},${a})`,children:(0,f.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:j,fontSize:10,title:r.value,children:r.value})})};return(0,f.jsx)(l.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,f.jsxs)("main",{className:"container mx-auto p-4 md:p-8 bg-gray-50 min-h-screen",children:[(0,f.jsx)("h1",{className:"text-center mb-8 text-3xl font-extrabold text-gray-900",children:"Blueprint Metrics Dashboard"}),a&&(0,f.jsxs)("div",{className:"text-center my-6 p-6 bg-indigo-50 border-2 border-indigo-300 rounded-xl shadow-lg animate-pulse",children:[(0,f.jsx)("div",{className:"mb-2 text-xl font-semibold text-indigo-700",children:"Loading Data..."}),(0,f.jsx)("small",{className:"text-indigo-500",children:"Fetching all metrics. Please wait."})]}),!a&&v&&(0,f.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-lg",role:"alert",children:[(0,f.jsx)("h4",{className:"font-bold",children:"Error loading metrics"}),(0,f.jsx)("p",{children:v})]}),!a&&!v&&(0,f.jsxs)("div",{className:"space-y-8 md:space-y-12",children:[(0,f.jsxs)("section",{className:"grid grid-cols-3 gap-4 md:gap-6",children:[(0,f.jsxs)("div",{className:"card shadow-2xl bg-white border-b-4 border-indigo-600 transition-all hover:scale-[1.01] duration-300 rounded-xl p-4",children:[(0,f.jsx)("h3",{className:"text-xs md:text-sm font-medium text-gray-500 uppercase tracking-wider truncate",children:"Total Downloads"}),(0,f.jsx)("p",{className:"mt-1 text-2xl md:text-4xl font-extrabold text-indigo-800 truncate",children:T(N)})]}),(0,f.jsxs)("div",{className:"card shadow-2xl bg-white border-b-4 border-teal-600 transition-all hover:scale-[1.01] duration-300 rounded-xl p-4",children:[(0,f.jsx)("h3",{className:"text-xs md:text-sm font-medium text-gray-500 uppercase tracking-wider truncate",children:"Unique Categories"}),(0,f.jsx)("p",{className:"mt-1 text-2xl md:text-4xl font-extrabold text-teal-800 truncate",children:T(_.length)})]}),(0,f.jsxs)("div",{className:"card shadow-2xl bg-white border-b-4 border-purple-600 transition-all hover:scale-[1.01] duration-300 rounded-xl p-4",children:[(0,f.jsx)("h3",{className:"text-xs md:text-sm font-medium text-gray-500 uppercase tracking-wider truncate",children:"Tracked Blueprints"}),(0,f.jsx)("p",{className:"mt-1 text-2xl md:text-4xl font-extrabold text-purple-800 truncate",children:T(D.length)})]})]}),(0,f.jsxs)("section",{className:"grid grid-cols-2 gap-6 md:gap-8",children:[(0,f.jsxs)("div",{className:"w-full shadow-2xl bg-white p-4 rounded-xl border border-gray-100",children:[(0,f.jsx)("h3",{className:"font-bold text-base md:text-xl mb-4 text-gray-800 border-b pb-2 truncate",children:"Daily Downloads (Last 30 Days)"}),(0,f.jsx)("div",{style:{height:350},children:0===S.length?(0,f.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500 text-sm md:text-base",children:"No recent download data available."}):(0,f.jsx)(i.u,{width:"100%",height:"100%",children:(0,f.jsxs)(u.Q,{data:S,margin:{top:10,right:0,left:-10,bottom:0},children:[(0,f.jsx)("defs",{children:(0,f.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,f.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,f.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,f.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb",vertical:!1}),(0,f.jsx)(m.W,{dataKey:"label",stroke:j,tick:{fontSize:8,fill:j},padding:{left:10,right:10}}),(0,f.jsx)(g.h,{allowDecimals:!1,stroke:j,tick:{fontSize:8,fill:j},tickFormatter:T}),(0,f.jsx)(s.m,{content:(0,f.jsx)($,{})}),(0,f.jsx)(x.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)",dot:!1,activeDot:{r:6,fill:"#fff",stroke:"#4f46e5",strokeWidth:2}})]})})})]}),(0,f.jsxs)("div",{className:"w-full shadow-2xl bg-white p-4 rounded-xl border border-gray-100",children:[(0,f.jsx)("h3",{className:"font-bold text-base md:text-xl mb-4 text-gray-800 border-b pb-2 truncate",children:"Download Distribution by Category"}),(0,f.jsx)("div",{style:{height:350},children:0===A.length?(0,f.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500 text-sm md:text-base",children:"No category data available."}):(0,f.jsx)(i.u,{width:"100%",height:"100%",children:(0,f.jsxs)(p.r,{children:[(0,f.jsx)(d.F,{data:A,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:e})=>({value:`${(100*e).toFixed(1)}%`,fill:j,fontSize:10}),children:A.map((e,t)=>(0,f.jsx)(n.f,{fill:k(e.category),stroke:"#fff"},`cell-${t}`))}),(0,f.jsx)(s.m,{content:(0,f.jsx)($,{})}),(0,f.jsx)(o.s,{layout:"vertical",verticalAlign:"middle",align:"right",iconType:"circle",wrapperStyle:{fontSize:"10px",color:j}})]})})})]})]}),(0,f.jsxs)("section",{className:"w-full shadow-2xl bg-white p-4 rounded-xl border border-gray-100",children:[(0,f.jsx)("h3",{className:"font-bold text-xl mb-4 text-gray-800 border-b pb-2",children:"Top 10 Blueprint Downloads (Ranking)"}),(0,f.jsx)("div",{style:{height:Math.max(400,40*O.length)},children:0===O.length?(0,f.jsx)("p",{className:"text-gray-500 text-base p-4",children:"No individual blueprint download data recorded yet."}):(0,f.jsx)(i.u,{width:"100%",height:"100%",children:(0,f.jsxs)(b.E,{data:O,layout:"vertical",margin:{top:20,right:30,left:100,bottom:5},children:[(0,f.jsx)(c.d,{strokeDasharray:"3 3",vertical:!1}),(0,f.jsx)(m.W,{type:"number",stroke:j,tick:{fontSize:10,fill:j},tickFormatter:T}),(0,f.jsx)(g.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,f.jsx)(B,{})}),(0,f.jsx)(s.m,{content:(0,f.jsx)($,{})}),(0,f.jsx)(h.y,{dataKey:"value",fill:k("top10"),barSize:20,radius:[10,10,0,0]})]})})})]})]})]})})}}}]);