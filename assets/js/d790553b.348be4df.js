"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[2574],{1170:(e,r,n)=>{n.d(r,{Dk:()=>l,PG:()=>c});var t=n(8445),o=n(4784);let i=null;const a=()=>{if(i)return i;const e=(o.default?.customFields||{}).env||{},r=e.SUPABASE_URL,n=e.SUPABASE_ANON_KEY;return r&&n&&s({supabaseUrl:r,supabaseKey:n}),i},s=({supabaseUrl:e,supabaseKey:r})=>{i=(0,t.UU)(e,r),console.log("Supabase initialized")},l=async(e,r,n=null,t="latest")=>{const o=a();if(!o)return console.error("[Supabase] recordBlueprintDownload: client not initialized"),!1;try{const{error:i}=await o.from("blueprint_downloads").insert([{blueprint_category:e,blueprint_id:r,blueprint_variant:n,blueprint_version:t,download_date:(new Date).toISOString()}]);return!i||(console.error("[Supabase] Error recording blueprint download:",i),!1)}catch(i){return console.error("[Supabase] Exception recording blueprint download:",i),!1}},c=async(e,r,n=null,t=null)=>{const o=a();if(!o)return console.error("[Supabase] getBlueprintDownloads: client not initialized"),0;try{const{data:i,error:a}=await o.rpc("get_download_aggregates",{p_category:e,p_id:r,p_variant:n,p_version:t});if(a)return console.error("[Supabase] Error in getBlueprintDownloads via RPC:",a),0;const s=i||[];return s.length?s.reduce((e,r)=>e+Number(r.total||0),0):0}catch(i){return console.error("[Supabase] Exception in getBlueprintDownloads:",i),0}}},22122:(e,r,n)=>{n.r(r),n.d(r,{default:()=>c});var t=n(13790),o=n(87483),i=n(54185),a=n(63883),s=n(1170),l=n(82238);function c(e){const r=e.route.category,n=e.route.id,{consent:c}=(0,i.S)(),d=(()=>{if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("version");if(e&&e.trim().length>0)return e}return e.route.version&&e.route.version.trim().length>0?e.route.version:"latest"})();let u=(()=>{if("undefined"!=typeof window){const r=new URLSearchParams(window.location.search).get("variant");return r&&r.trim().length>0?r:e.route.variant||null}return e.route.variant||null})();"controllers"===r&&!u&&e.route.variantsById&&1===Object.keys(e.route.variantsById).length&&(u=Object.keys(e.route.variantsById)[0]),"controllers"!==r&&(u="EPMatt");let p,w=d;if("controllers"===r&&"latest"===w&&u&&e.route.variantsById?.[u]?.length){w=[...e.route.variantsById[u]].sort((e,r)=>r.localeCompare(e))[0]}if("controllers"===r){u||"undefined"==typeof window||console.error("Missing variant for controller download route.");p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${`${u}/${w}/${n}.yaml`}`}else p=`https://raw.githubusercontent.com/yarafie/awesome-ha-blueprints/main/website/docs/blueprints/${r}/${n}/${n}.yaml`;const b="https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url="+encodeURIComponent(p),h=w;return(0,t.useEffect)(()=>{if("undefined"!=typeof window){if(window.__blueprintDownloadHandled)return;window.__blueprintDownloadHandled=!0}c&&(0,a.sx)("blueprint","download","controllers"===r?`${r}/${n}/${u}/${h}`:`${r}/${n}`,void 0);const e={category:r,id:n,variant:u||null,version:h};(0,s.Dk)(e.category,e.id,e.variant,e.version).then(e=>{e||console.error("Failed to record blueprint download in database")}).catch(e=>{console.error("Error recording blueprint download:",e)}).finally(()=>{(e=>{try{const r="my.home-assistant.io";new URL(e).hostname===r?window.location.href=e:console.error("Unsafe redirect blocked:",e)}catch{console.error("Invalid redirect URL:",e)}})(b)})},[c,r,n,u,h,b]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.A,{children:(0,l.jsxs)("title",{children:["Download ",r,"/",n,u?`/${u}`:"",w?`/${w}`:""]})}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"20px"},children:[(0,l.jsx)("h1",{children:"Thanks for downloading!"}),(0,l.jsx)("p",{children:"Redirecting to your Home Assistant instance..."})]})]})}}}]);