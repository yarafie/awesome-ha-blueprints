"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var s=a(3303),l=a(1153),r=a(6285),i=a(4538),o=a(162),d=a(656),n=a(8802),c=a(4443),x=a(6605),h=a(9441),m=a(7342),p=a(2941),g=a(8879),u=a(2666),y=a(1205),f=a(1929),j=a(1778),b=a(7711);const w=(0,f.A)(j.A).range(),v=()=>{const[e,t]=(0,s.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),{loading:a,error:f,totalDownloads:j,byCategory:v,topBlueprints:N,daily:S}=e;(0,s.useEffect)(()=>{const e=window?.env?.SUPABASE_URL,a=window?.env?.SUPABASE_ANON_KEY;if(!e||!a)return void t(e=>({...e,loading:!1,error:"Supabase environment variables are not available. Check SUPABASE_URL and SUPABASE_ANON_KEY."}));const s={"Content-Type":"application/json",apikey:a,Authorization:`Bearer ${a}`},l=async(e,t,a=3)=>{for(let s=0;s<a;s++)try{const l=await fetch(e,t);if(l.ok)return l;if(429===l.status&&s<a-1){const e=1e3*Math.pow(2,s)+1e3*Math.random();await new Promise(t=>setTimeout(t,e));continue}{const e=await l.text();throw new Error(`HTTP error! Status: ${l.status}. Response: ${e.substring(0,100)}...`)}}catch(f){if(s===a-1)throw f}};!async function(){try{const[a,r,i,o]=await Promise.all([l(`${e}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:s,body:JSON.stringify({})}),l(`${e}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:s,body:JSON.stringify({})}),l(`${e}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:s,body:JSON.stringify({})}),l(`${e}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:s,body:JSON.stringify({p_days:30})})]),d=await a.json(),n=await r.json(),c=await i.json(),x=await o.json();let h=0;Array.isArray(d)&&d.length>0?h=Number(d[0].total):"number"==typeof d&&(h=d);const m=Array.isArray(n)?n:[],p=Array.isArray(c)?c:[],g=Array.isArray(x)?x.map(e=>({label:new Date(e.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(e.total)})).sort((e,t)=>{const a=new Date(e.label),s=new Date(t.label);return a.getTime()-s.getTime()}):[];t({loading:!1,error:void 0,totalDownloads:h,byCategory:m,topBlueprints:p,daily:g})}catch(a){console.error("Error fetching download metrics",a),t(e=>({...e,loading:!1,error:`Failed to load metrics from Supabase. Error: ${a.message||"Unknown error."}`}))}}()},[]);const A=e=>e.toLocaleString(),k=v.map(e=>({name:e.blueprint_category,category:e.blueprint_category,value:Number(e.total),total:Number(e.total),label:e.blueprint_category})),_=N.slice(0,10).map((e,t)=>({name:e.blueprint_id,value:Number(e.total),fill:w[t%w.length]})).reverse(),D=Math.max(..._.map(e=>e.value),1),T=({active:e,payload:t,label:a})=>{if(e&&t&&t.length){const e=t[0].payload;return(0,b.jsxs)("div",{className:"p-3 bg-white border border-gray-300 shadow-xl rounded-lg text-sm text-gray-700",children:[(0,b.jsx)("p",{className:"font-bold text-indigo-600 mb-1",children:e.name||a}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Downloads:"})," ",A(e.value||t[0].value)]})]})}return null};return(0,b.jsx)(l.A,{title:"Blueprint Download Metrics",description:"Download metrics for Awesome HA Blueprints",children:(0,b.jsxs)("main",{className:"container mx-auto p-4 md:p-8",children:[(0,b.jsx)("h1",{className:"text-center mb-8 text-3xl font-bold text-gray-800",children:"Blueprint Download Metrics"}),a&&(0,b.jsxs)("div",{className:"text-center my-6 p-6 bg-indigo-50 border-2 border-indigo-200 rounded-xl shadow-lg",children:[(0,b.jsx)("div",{className:"mb-2 text-xl font-semibold text-indigo-700",children:"Loading metrics from Supabase..."}),(0,b.jsx)("small",{className:"text-indigo-500",children:"Fetching data from RPCs. Please ensure your Supabase config is correct."})]}),!a&&f&&(0,b.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-lg",role:"alert",children:[(0,b.jsx)("h4",{className:"font-bold",children:"Error loading metrics"}),(0,b.jsx)("p",{children:f})]}),!a&&!f&&(0,b.jsxs)("div",{className:"space-y-8 md:space-y-12",children:[(0,b.jsxs)("section",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("div",{className:"card shadow-2xl hover:shadow-3xl transition-shadow duration-500 rounded-xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-indigo-600 text-white p-3 md:p-4",children:(0,b.jsx)("h3",{className:"font-extrabold text-lg md:text-xl",children:"Total Downloads"})}),(0,b.jsx)("div",{className:"p-4 md:p-6",children:(0,b.jsx)("p",{className:"text-4xl md:text-6xl font-black text-indigo-700 m-0",children:A(j)})})]})}),(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("div",{className:"card shadow-2xl hover:shadow-3xl transition-shadow duration-500 rounded-xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-teal-600 text-white p-3 md:p-4",children:(0,b.jsx)("h3",{className:"font-extrabold text-lg md:text-xl",children:"Unique Categories"})}),(0,b.jsx)("div",{className:"p-4 md:p-6",children:(0,b.jsx)("p",{className:"text-4xl md:text-6xl font-black text-teal-700 m-0",children:A(v.length)})})]})}),(0,b.jsx)("div",{className:"col-span-2 lg:col-span-1 w-full",children:(0,b.jsxs)("div",{className:"card shadow-2xl hover:shadow-3xl transition-shadow duration-500 rounded-xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-purple-600 text-white p-3 md:p-4",children:(0,b.jsx)("h3",{className:"font-extrabold text-lg md:text-xl",children:"Top Blueprints Tracked"})}),(0,b.jsx)("div",{className:"p-4 md:p-6",children:(0,b.jsx)("p",{className:"text-4xl md:text-6xl font-black text-purple-700 m-0",children:A(N.length)})})]})})]}),(0,b.jsxs)("section",{className:"grid grid-cols-2 gap-4 md:gap-6",children:[(0,b.jsx)("div",{className:"w-full col-span-1",children:(0,b.jsxs)("div",{className:"card shadow-2xl p-2 md:p-4 rounded-xl",children:[(0,b.jsx)("div",{className:"p-1 md:p-2",children:(0,b.jsx)("h3",{className:"font-bold text-base md:text-xl text-gray-700",children:"Daily Downloads (30 Days)"})}),(0,b.jsx)("div",{className:"p-1 md:p-2",style:{height:300},children:0===S.length?(0,b.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500 text-sm",children:"No recent downloads to chart yet."}):(0,b.jsx)(o.u,{width:"100%",height:"100%",children:(0,b.jsxs)(u.Q,{data:S,margin:{top:5,right:0,left:-20,bottom:0},children:[(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,b.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,b.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,b.jsx)(x.d,{strokeDasharray:"5 5",stroke:"#e5e7eb"}),(0,b.jsx)(m.W,{dataKey:"label",stroke:"#6b7280",tick:{fontSize:8},padding:{left:10,right:10}}),(0,b.jsx)(p.h,{allowDecimals:!1,stroke:"#6b7280",tick:{fontSize:8}}),(0,b.jsx)(i.m,{content:(0,b.jsx)(T,{})}),(0,b.jsx)(h.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:2,fill:"url(#colorTotal)",dot:{fill:"#4f46e5",r:3},activeDot:{r:5,strokeWidth:1,stroke:"#fff"}})]})})})]})}),(0,b.jsx)("div",{className:"w-full col-span-1",children:(0,b.jsxs)("div",{className:"card shadow-2xl p-2 md:p-4 rounded-xl",children:[(0,b.jsx)("div",{className:"p-1 md:p-2",children:(0,b.jsx)("h3",{className:"font-bold text-base md:text-xl text-gray-700",children:"Category Proportion"})}),(0,b.jsx)("div",{className:"p-1 md:p-2",style:{height:300},children:0===k.length?(0,b.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500 text-sm",children:"No data yet. Download some blueprints to see metrics here."}):(0,b.jsx)(o.u,{width:"100%",height:"100%",children:(0,b.jsxs)(g.r,{children:[(0,b.jsx)(n.F,{data:k,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",outerRadius:60,fill:"#8884d8",labelLine:!1,label:({percent:e})=>`${(100*e).toFixed(0)}%`,children:k.map((e,t)=>(0,b.jsx)(d.f,{fill:w[t%w.length]},`cell-${t}`))}),(0,b.jsx)(i.m,{content:(0,b.jsx)(T,{})}),(0,b.jsx)(r.s,{layout:"vertical",verticalAlign:"middle",align:"right",iconType:"circle",wrapperStyle:{fontSize:"10px"}})]})})})]})})]}),(0,b.jsx)("section",{className:"w-full",children:(0,b.jsxs)("div",{className:"card shadow-2xl p-4 rounded-xl",children:[(0,b.jsx)("div",{className:"p-2",children:(0,b.jsx)("h3",{className:"font-bold text-xl text-gray-700",children:"Top 10 Blueprints Ranking (Radial)"})}),(0,b.jsx)("div",{className:"p-2",style:{height:400},children:0===_.length?(0,b.jsx)("p",{className:"text-gray-500",children:"No downloads recorded yet for individual blueprints."}):(0,b.jsx)(o.u,{width:"100%",height:"100%",children:(0,b.jsxs)(y.D,{innerRadius:"10%",outerRadius:"100%",data:_,startAngle:90,endAngle:-270,barSize:15,children:[(0,b.jsx)(c.Z,{minAngle:15,label:{position:"insideStart",fill:"#fff",fontSize:10,offset:5},background:!0,clockWise:!0,dataKey:"value"}),(0,b.jsx)(i.m,{content:(0,b.jsx)(T,{})}),(0,b.jsx)(r.s,{iconSize:10,layout:"vertical",verticalAlign:"middle",align:"left",wrapperStyle:{fontSize:"12px"},formatter:(e,t)=>(0,b.jsx)("span",{className:"text-xs text-gray-600",title:t.payload.name,children:`${t.payload.name} (${A(t.payload.value)})`})}),(0,b.jsxs)("text",{x:"50%",y:20,fill:"#666",textAnchor:"middle",dominantBaseline:"hanging",children:["Top 10 Blueprint Rankings (Max:"," ",A(D),")"]})]})})})]})})]})]})})}}}]);