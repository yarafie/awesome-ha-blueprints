"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,r)=>{r.r(e),r.d(e,{default:()=>w});var o=r(3303),i=r(1153),a=r(6285),n=r(4538),l=r(162),s=r(656),d=r(351),c=r(6605),p=r(9441),h=r(2782),y=r(7342),g=r(2941),x=r(2454),u=r(7263),m=r(50),b=r(1929),f=r(1778),j=r(7711);const w=()=>{const[t,e]=(0,o.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),[r,w]=(0,o.useState)(15),[S,v]=(0,o.useState)(!1),{loading:_,error:k,totalDownloads:B,byCategory:D,topBlueprints:A,daily:T}=t,C=(0,b.A)(f.A);(0,o.useEffect)(()=>{const t=()=>{const t=document.documentElement.getAttribute("data-theme");v("dark"===t)};t();const e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"data-theme"===e.attributeName&&t()})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,o.useEffect)(()=>{const t=window?.env?.SUPABASE_URL,o=window?.env?.SUPABASE_ANON_KEY,i=t=>t.toLocaleDateString(void 0,{month:"short",day:"numeric"}),a=t=>t.toISOString().split("T")[0],n=(t,e)=>{const r=new Map(t.map(t=>[t.day,Number(t.total)])),o=[],n=new Date;for(let l=e-1;l>=0;l--){const t=new Date(n);t.setDate(n.getDate()-l);const e=a(t),s=r.get(e)||0;o.push({label:i(t),total:s})}return o};if(!t||!o){const t=1234567,o=[{blueprint_category:"controllers",total:"900000"},{blueprint_category:"hooks",total:"280000"},{blueprint_category:"templates",total:"54000"}],i=[{blueprint_category:"hooks",blueprint_id:"thertetsat_controlv2_30_days_ago",total:"50000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"45000"},{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"}],l=[{day:a(new Date(Date.now()-864e6)),total:"10"},{day:a(new Date(Date.now()-432e6)),total:"20"},{day:a(new Date),total:"22"}],s=n(l,r);return void e(e=>({...e,loading:!1,error:"Supabase variables missing. Showing mock data.",totalDownloads:t,byCategory:o,topBlueprints:i,daily:s}))}const l={"Content-Type":"application/json",apikey:o,Authorization:"Bearer "+o},s=async(t,e,r=3)=>{for(let o=0;o<r;o++)try{const i=await fetch(t,e);if(i.ok)return i;if(429===i.status&&o<r-1){const t=1e3*Math.pow(2,o)+1e3*Math.random();await new Promise(e=>setTimeout(e,t));continue}{const t=await i.text();throw new Error(`HTTP error! Status: ${i.status}. Response: ${t.substring(0,100)}...`)}}catch(k){if(o===r-1)throw k}};!async function(){e(t=>({...t,loading:!0}));try{const[o,i,a,d]=await Promise.all([s(`${t}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:l,body:JSON.stringify({})}),s(`${t}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:l,body:JSON.stringify({})}),s(`${t}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:l,body:JSON.stringify({})}),s(`${t}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:l,body:JSON.stringify({p_days:r})})]),c=await o.json(),p=await i.json(),h=await a.json(),y=await d.json();let g=0;Array.isArray(c)&&c.length>0?g=Number(c[0].total):"number"==typeof c&&(g=c);const x=Array.isArray(p)?p:[],u=Array.isArray(h)?h:[],m=n(Array.isArray(y)?y:[],r);e({loading:!1,error:void 0,totalDownloads:g,byCategory:x,topBlueprints:u,daily:m})}catch(o){console.error("Error fetching download metrics",o),e(t=>({...t,loading:!1,error:`Failed to load metrics from Supabase. Error: ${o.message||"Unknown error."}`}))}}()},[r]);const P=t=>t.toLocaleString(),N=D.map(t=>({name:t.blueprint_category,category:t.blueprint_category,value:Number(t.total),total:Number(t.total),label:t.blueprint_category})),z=A.slice(0,10).map(t=>({id:t.blueprint_id,name:t.blueprint_id.length>40?t.blueprint_id.substring(0,37)+"...":t.blueprint_id,value:Number(t.total)})),E={bg:S?"#1b1b1d":"#f9fafb",cardBg:S?"#242526":"#ffffff",textPrimary:S?"#e5e7eb":"#1f2937",textSecondary:S?"#9ca3af":"#6b7280",gridLine:S?"#444":"#e5e7eb",tooltipBg:S?"#242526":"#ffffff",tooltipBorder:S?"#444":"#ccc",tooltipText:S?"#e5e7eb":"#333"},L=({active:t,payload:e,label:r})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,j.jsxs)("div",{style:{padding:"10px",backgroundColor:E.tooltipBg,border:`1px solid ${E.tooltipBorder}`,borderRadius:"5px",color:E.tooltipText},children:[(0,j.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:t.name||t.id||r}),(0,j.jsxs)("p",{children:["Downloads: ",P(t.value||e[0].value)]})]})}return null},$=t=>{const{x:e,y:r,payload:o}=t;return(0,j.jsx)("g",{transform:`translate(${e},${r})`,children:(0,j.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:E.textSecondary,fontSize:10,title:o.value,children:o.value})})},O=({current:t,onSelect:e})=>{const r=e=>({padding:"6px 12px",margin:"0 4px",borderRadius:"4px",cursor:"pointer",fontWeight:"bold",backgroundColor:t===e?"#4f46e5":E.cardBg,color:t===e?"white":E.textPrimary,border:`1px solid ${t===e?"#4f46e5":E.gridLine}`,transition:"all 0.2s",boxShadow:t===e?"0 2px 4px rgba(0,0,0,0.2)":"none",fontSize:"14px"});return(0,j.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:"20px",paddingTop:"10px"},children:[7,15,30,90].map(t=>(0,j.jsxs)("button",{onClick:()=>e(t),style:r(t),children:[t,"D"]},t))})},W={backgroundColor:E.cardBg,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:E.textPrimary,minWidth:"0",border:S?"1px solid #333":"none"},M=t=>({backgroundColor:t,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),K={padding:"24px",textAlign:"center"},R={padding:"16px",borderBottom:`1px solid ${E.gridLine}`,margin:0,fontSize:"1.25rem",color:E.textPrimary,fontWeight:"bold"};return(0,j.jsx)(i.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,j.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:E.bg,transition:"background-color 0.3s ease",minHeight:"100vh",padding:"2rem"},children:[(0,j.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold",color:E.textPrimary},children:"Blueprint Metrics Dashboard"}),_&&(0,j.jsx)("div",{style:{textAlign:"center",color:E.textPrimary},children:"Loading metrics..."}),!_&&k&&(0,j.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,j.jsx)("h4",{className:"alert__heading",children:"Error loading metrics"}),(0,j.jsx)("p",{children:k})]}),!_&&!k&&(0,j.jsxs)("div",{style:{width:"100%",overflowX:"auto"},children:[(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:W,children:[(0,j.jsx)("div",{style:M("#4f46e5"),children:"Total Downloads"}),(0,j.jsx)("div",{style:K,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#4f46e5",margin:0},children:P(B)})})]}),(0,j.jsxs)("div",{style:W,children:[(0,j.jsx)("div",{style:M("#9333ea"),children:"Tracked Blueprints"}),(0,j.jsx)("div",{style:K,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:P(A.length)})})]})]}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:W,children:[(0,j.jsxs)("h3",{style:R,children:["Daily Downloads (Last ",r," Days)"]}),(0,j.jsx)(O,{current:r,onSelect:w}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(m.Q,{data:T,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,j.jsx)(c.d,{strokeDasharray:"3 3",stroke:E.gridLine,vertical:!1}),(0,j.jsx)(y.W,{dataKey:"label",stroke:E.textSecondary,tick:{fontSize:10,fill:E.textSecondary}}),(0,j.jsx)(g.h,{allowDecimals:!1,stroke:E.textSecondary,tick:{fontSize:10,fill:E.textSecondary},tickFormatter:P}),(0,j.jsx)(n.m,{content:(0,j.jsx)(L,{})}),(0,j.jsx)(p.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)"})]})})})]}),(0,j.jsxs)("div",{style:W,children:[(0,j.jsx)("h3",{style:R,children:"Category Distribution"}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(u.r,{children:[(0,j.jsx)(d.F,{data:N,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:t})=>`${(100*t).toFixed(0)}%`,children:N.map((t,e)=>(0,j.jsx)(s.f,{fill:C(t.category),stroke:S?"#242526":"#fff"},`cell-${e}`))}),(0,j.jsx)(n.m,{content:(0,j.jsx)(L,{})}),(0,j.jsx)(a.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:E.textPrimary}})]})})})]})]}),(0,j.jsxs)("section",{style:{...W,paddingBottom:"20px"},children:[(0,j.jsx)("h3",{style:{...R,marginBottom:"20px",borderBottom:"none"},children:"Top 10 Blueprints (Highest to Lowest)"}),(0,j.jsx)("div",{style:{height:Math.max(400,40*z.length)},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(x.E,{data:z,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,j.jsx)(c.d,{strokeDasharray:"3 3",horizontal:!1,stroke:E.gridLine}),(0,j.jsx)(y.W,{type:"number",stroke:E.textSecondary,tick:{fontSize:10,fill:E.textSecondary},tickFormatter:P}),(0,j.jsx)(g.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,j.jsx)($,{})}),(0,j.jsx)(n.m,{content:(0,j.jsx)(L,{})}),(0,j.jsx)(h.y,{dataKey:"value",fill:C("top10"),barSize:20,radius:[0,4,4,0]})]})})})]})]})]})})}}}]);