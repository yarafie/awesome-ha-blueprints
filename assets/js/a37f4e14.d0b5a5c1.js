"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,o)=>{o.r(e),o.d(e,{default:()=>O});var r=o(3303),l=o(1153),n=o(6285),i=o(4538),a=o(162),s=o(656),d=o(351),p=o(6605),c=o(9441),x=o(2782),g=o(7342),h=o(2941),u=o(2454),y=o(7263),m=o(50),b=o(1929),f=o(1778),w=o(7711);const j="#4f46e5",S="#10b981",k="#111827",_="#1f2937",v="#f9fafb",D="#9ca3af",B="#374151",C="#1f2937",z="#111827",L="#6366f1",A=t=>t.toLocaleString(),$=({active:t,payload:e})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,w.jsxs)("div",{style:{backgroundColor:_,padding:"8px",border:`1px solid ${B}`,borderRadius:"4px",color:v,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:[(0,w.jsxs)("p",{style:{margin:0,fontWeight:"bold"},children:[t.name," Downloads"]}),(0,w.jsxs)("p",{style:{margin:0},children:["Total: ",A(t.value)," (",t.percent.toFixed(1),"%)"]})]})}return null},T=({active:t,payload:e})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,w.jsxs)("div",{style:{backgroundColor:_,padding:"8px",border:`1px solid ${B}`,borderRadius:"4px",color:v,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:[(0,w.jsx)("p",{style:{margin:0,fontWeight:"bold"},children:t.name}),(0,w.jsxs)("p",{style:{margin:0},children:["Downloads: ",A(t.Downloads)]})]})}return null},W=({columnKey:t,title:e,currentSort:o,onSort:r,style:l})=>{const n=o.key===t,i="ascending"===o.direction;return(0,w.jsx)("th",{onClick:()=>r(t),style:{...l,cursor:"pointer",padding:"12px 16px",textAlign:l.textAlign||"left",fontSize:"12px",fontWeight:"600",color:D,borderBottom:`2px solid ${B}`,textTransform:"uppercase",overflow:"hidden",textOverflow:"ellipsis"},children:(0,w.jsxs)("span",{style:{display:"flex",alignItems:"center",justifyContent:"right"===l.textAlign?"flex-end":"flex-start"},children:[e,n&&(0,w.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",viewBox:"0 0 320 512",style:{marginLeft:"4px",width:"10px",fill:i?S:j,transform:i?"rotate(180deg)":"none",transition:"transform 0.2s"},children:(0,w.jsx)("path",{d:"M182.6 137.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L128 205.3V448c0 17.7 14.3 32 32 32s32-14.3 32-32V205.3l73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128z"})}),!n&&(0,w.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",viewBox:"0 0 320 512",style:{marginLeft:"4px",width:"10px",fill:D,opacity:.5},children:(0,w.jsx)("path",{d:"M41 288h238c21.4 0 32.1 25.8 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41zm255-105L177 64c-9.4-9.4-24.6-9.4-33.9 0L24 183c-15.1 15.1-4.4 41 17 41h238c21.4 0 32.1-25.8 17-41z"})})]})})},I=({data:t})=>{const[e,o]=(0,r.useState)({key:"total",direction:"descending"}),l=(0,r.useMemo)(()=>{const o=[...t];return e.key&&o.sort((t,o)=>{let r,l;if("total"===e.key)r=parseInt(t.total,10),l=parseInt(o.total,10);else if("last_downloaded"===e.key){const n=t.last_downloaded?Date.parse(t.last_downloaded):0,i=o.last_downloaded?Date.parse(o.last_downloaded):0;if(0===n&&0!==i)return"ascending"===e.direction?1:-1;if(0!==n&&0===i)return"ascending"===e.direction?-1:1;if(0===n&&0===i)return 0;r=n,l=i}else r=t[e.key],l=o[e.key];return r<l?"ascending"===e.direction?-1:1:r>l?"ascending"===e.direction?1:-1:0}),o},[t,e]),n=t=>{let r="descending";e.key===t&&"descending"===e.direction&&(r="ascending"),o({key:t,direction:r})};return(0,w.jsx)("div",{style:{overflowX:"auto",borderRadius:"12px"},children:(0,w.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed",backgroundColor:_},children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{children:[(0,w.jsx)(W,{columnKey:"blueprint_id",title:"Blueprint ID",currentSort:e,onSort:n,style:{width:"50%",paddingLeft:"24px"}}),(0,w.jsx)(W,{columnKey:"blueprint_category",title:"Category",currentSort:e,onSort:n,style:{width:"20%",textAlign:"center"}}),(0,w.jsx)(W,{columnKey:"total",title:"Downloads",currentSort:e,onSort:n,style:{width:"15%",textAlign:"right"}}),(0,w.jsx)(W,{columnKey:"last_downloaded",title:"Last Downloaded",currentSort:e,onSort:n,style:{width:"15%",textAlign:"right",paddingRight:"24px"}})]})}),(0,w.jsx)("tbody",{children:l.map((t,e)=>(0,w.jsxs)("tr",{style:e%2==0?{backgroundColor:C}:{backgroundColor:z},children:[(0,w.jsx)("td",{style:{padding:"12px 16px",paddingLeft:"24px",borderBottom:`1px solid ${B}`,fontSize:"14px",color:L,wordBreak:"break-all",overflowWrap:"break-word",whiteSpace:"normal"},children:(0,w.jsx)("a",{href:`https://github.com/my-repo/blueprints/blob/main/${t.blueprint_category}/${t.blueprint_id}.yaml`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"none"},children:t.blueprint_id})}),(0,w.jsx)("td",{style:{padding:"12px 16px",borderBottom:`1px solid ${B}`,fontSize:"14px",color:v,textAlign:"center"},children:(0,w.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:"9999px",fontSize:"12px",fontWeight:"500",backgroundColor:"rgba(79, 70, 229, 0.2)",color:j},children:t.blueprint_category})}),(0,w.jsx)("td",{style:{padding:"12px 16px",borderBottom:`1px solid ${B}`,fontSize:"14px",color:v,textAlign:"right",fontFamily:"monospace"},children:A(parseInt(t.total,10))}),(0,w.jsx)("td",{style:{padding:"12px 16px",paddingRight:"24px",borderBottom:`1px solid ${B}`,fontSize:"14px",color:v,textAlign:"right"},children:t.last_downloaded?new Date(t.last_downloaded).toLocaleDateString():"N/A"})]},t.blueprint_id))})]})})},O=()=>{const[t,e]=(0,r.useState)(null),[o,S]=(0,r.useState)(!0),[C,z]=(0,r.useState)(null),L=(0,r.useCallback)(async()=>{S(!0);try{const t=await(async()=>{try{const[t,e,o,r]=await Promise.all([supabase.rpc("get_total_downloads_by_category"),supabase.rpc("get_top_blueprints"),supabase.rpc("get_daily_downloads"),supabase.rpc("get_total_downloads")]);if(t.error||e.error||o.error||r.error)throw console.error("Supabase RPC Error:",{category:t.error,topBlueprints:e.error,daily:o.error,total:r.error}),new Error("Supabase fetch failed.");const l=parseInt(r.data[0]?.total||"0",10),n=o.data.map(t=>({label:new Date(t.day).toLocaleDateString("en-US",{month:"short",day:"numeric"}),total:parseInt(t.total,10)}));return{totalDownloads:l,byCategory:t.data,topBlueprints:e.data,daily:n}}catch(t){return console.error("Failed to fetch data, returning mock data:",t),{totalDownloads:123456,byCategory:[{blueprint_category:"automation",total:"80000"},{blueprint_category:"sensor",total:"20000"},{blueprint_category:"lovelace",total:"15000"},{blueprint_category:"script",total:"8456"}],topBlueprints:[{blueprint_category:"automation",blueprint_id:"best-light-scheduler",total:"5000",last_downloaded:(new Date).toISOString()},{blueprint_category:"sensor",blueprint_id:"weather-alerts-integration",total:"3200",last_downloaded:new Date(Date.now()-432e6).toISOString()},{blueprint_category:"automation",blueprint_id:"holiday-light-effects",total:"1800",last_downloaded:new Date(Date.now()-1296e6).toISOString()}],daily:[{label:"Oct 1",total:100},{label:"Oct 5",total:120},{label:"Oct 10",total:90},{label:"Oct 15",total:150},{label:"Oct 20",total:110},{label:"Oct 25",total:180},{label:"Oct 30",total:200}]}}})();e(t)}catch(t){console.error("Failed to fetch metrics data:",t)}finally{S(!1)}},[]);(0,r.useEffect)(()=>{L()},[L]);const W=t?.totalDownloads||0,O=(0,r.useMemo)(()=>t?t.byCategory.map(t=>{const e=parseInt(t.total,10);return{name:t.blueprint_category,value:e,percent:e/W*100}}):[],[t,W]),M=(0,r.useMemo)(()=>t?t.daily:[],[t]),K=(0,r.useMemo)(()=>t?t.topBlueprints.filter(t=>!C||t.blueprint_category===C).slice(0,10).map(t=>({id:t.blueprint_id,name:t.blueprint_id.replace(/_/g," "),Downloads:parseInt(t.total,10)})).sort((t,e)=>e.Downloads-t.Downloads):[],[t,C]),R=(0,r.useMemo)(()=>t?[...t.topBlueprints]:[],[t]),F=(0,r.useMemo)(()=>(0,b.A)(f.A),[]),E=(0,r.useMemo)(()=>({backgroundColor:_,borderRadius:"12px",padding:"24px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)",marginBottom:"24px"}),[]),U=(0,r.useMemo)(()=>({...E,padding:"0",overflow:"hidden"}),[E]);return(0,w.jsx)(l.A,{title:"Metrics | Awesome HA Blueprints",description:"Download metrics for all blueprints",children:(0,w.jsxs)("main",{style:{padding:"32px",maxWidth:"1200px",margin:"0 auto",color:v,backgroundColor:k},children:[(0,w.jsx)("h1",{style:{fontSize:"32px",fontWeight:"800",marginBottom:"24px",color:v},children:"Blueprint Download Metrics"}),o||!t?(0,w.jsxs)("div",{style:{textAlign:"center",padding:"100px",color:D,fontSize:"18px"},children:[(0,w.jsx)("p",{children:"Loading metrics data from the backend..."}),(0,w.jsx)("div",{style:{display:"inline-block",width:"20px",height:"20px",border:`3px solid ${j}`,borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,w.jsx)("style",{children:"\n              @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n              }\n            "})]}):(0,w.jsxs)("div",{children:[(0,w.jsx)("section",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"24px",marginBottom:"24px"},children:[{title:"Total Downloads",value:A(t.totalDownloads),color:"linear-gradient(135deg, #4f46e5, #6366f1)"},{title:"Tracked Blueprints",value:A(t.topBlueprints.length),color:"linear-gradient(135deg, #10b981, #34d399)"},{title:"Total Categories",value:A(t.byCategory.length),color:"linear-gradient(135deg, #f59e0b, #fbbf24)"}].map(t=>(0,w.jsxs)("div",{style:{...E,padding:"20px",textAlign:"center",background:t.color,color:"#fff"},children:[(0,w.jsx)("p",{style:{fontSize:"14px",fontWeight:"500",opacity:.9,margin:"0 0 4px 0"},children:t.title}),(0,w.jsx)("p",{style:{fontSize:"32px",fontWeight:"bold",margin:0},children:t.value})]},t.title))}),(0,w.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"24px",marginBottom:"24px"},children:[(0,w.jsxs)("div",{style:E,children:[(0,w.jsx)("h2",{style:{fontSize:"20px",fontWeight:"600",borderBottom:`1px solid ${B}`,paddingBottom:"16px",marginBottom:"16px"},children:"Daily Downloads Trend"}),(0,w.jsx)("div",{style:{height:"300px"},children:(0,w.jsx)(a.u,{width:"100%",height:"100%",children:(0,w.jsxs)(m.Q,{data:M,children:[(0,w.jsx)(p.d,{strokeDasharray:"3 3",stroke:B}),(0,w.jsx)(g.W,{dataKey:"label",stroke:D,fontSize:12,tickLine:!1,axisLine:!1}),(0,w.jsx)(h.h,{stroke:D,fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:t=>A(t)}),(0,w.jsx)(i.m,{contentStyle:{backgroundColor:_,border:`1px solid ${B}`},labelStyle:{color:v},formatter:t=>[A(t),"Downloads"]}),(0,w.jsx)(c.Gk,{type:"monotone",dataKey:"total",stroke:j,fill:"url(#colorUv)",name:"Downloads",strokeWidth:2}),(0,w.jsx)("defs",{children:(0,w.jsxs)("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:j,stopOpacity:.8}),(0,w.jsx)("stop",{offset:"95%",stopColor:j,stopOpacity:0})]})})]})})})]}),(0,w.jsxs)("div",{style:E,children:[(0,w.jsx)("h2",{style:{fontSize:"20px",fontWeight:"600",borderBottom:`1px solid ${B}`,paddingBottom:"16px",marginBottom:"16px"},children:"Category Distribution"}),(0,w.jsx)("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,w.jsx)(a.u,{width:"100%",height:"100%",children:(0,w.jsxs)(y.r,{children:[(0,w.jsx)(d.F,{data:O,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,children:O.map((t,e)=>(0,w.jsx)(s.f,{fill:F(t.name),onClick:()=>z(C===t.name?null:t.name),style:{cursor:"pointer"}},`cell-${e}`))}),(0,w.jsx)(i.m,{content:(0,w.jsx)($,{})}),(0,w.jsx)(n.s,{wrapperStyle:{fontSize:"12px",color:v}})]})})}),(0,w.jsx)("p",{style:{textAlign:"center",marginTop:"16px",color:D,fontSize:"14px"},children:C?`Showing Top 10 for: ${C}`:"Click a category to filter Top 10 chart below."})]})]}),(0,w.jsxs)("section",{style:E,children:[(0,w.jsxs)("h2",{style:{fontSize:"20px",fontWeight:"600",borderBottom:`1px solid ${B}`,paddingBottom:"16px",marginBottom:"16px"},children:["Top 10 Blueprints"," ",C?`(Filtered by: ${C})`:""]}),(0,w.jsx)("div",{style:{height:"350px"},children:K.length>0?(0,w.jsx)(a.u,{width:"100%",height:"100%",children:(0,w.jsxs)(u.E,{data:K,layout:"vertical",margin:{top:5,right:30,left:150,bottom:5},children:[(0,w.jsx)(p.d,{strokeDasharray:"3 3",stroke:B}),(0,w.jsx)(g.W,{type:"number",stroke:D,fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:t=>A(t)}),(0,w.jsx)(h.h,{dataKey:"name",type:"category",stroke:D,fontSize:12,tickLine:!1,axisLine:!1}),(0,w.jsx)(i.m,{content:(0,w.jsx)(T,{})}),(0,w.jsx)(n.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:v}}),(0,w.jsx)(x.y,{dataKey:"Downloads",name:"# of Downloads",fill:F(C||"top10"),barSize:20,radius:[0,4,4,0]})]})}):(0,w.jsx)("p",{style:{textAlign:"center",padding:"50px",color:D},children:"No top blueprints found for the current selection."})})]}),(0,w.jsx)("section",{style:U,children:(0,w.jsx)(I,{data:R})})]})]})})}}}]);