"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(e,t,o)=>{o.r(t),o.d(t,{default:()=>R});var r=o(3303),n=o(1153),l=o(6285),i=o(4538),a=o(162),s=o(656),d=o(351),p=o(6605),c=o(9441),x=o(2782),g=o(7342),h=o(2941),y=o(2454),u=o(7263),m=o(50),f=o(1929),b=o(1778),j=o(7711);const w="#4f46e5",k="#10b981",S="#111827",_="#1f2937",v="#f9fafb",B="#9ca3af",C="#374151",D="#1f2937",z="#111827",L="#6366f1",A=e=>e.toLocaleString(),$=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return(0,j.jsxs)("div",{style:{backgroundColor:_,padding:"8px",border:`1px solid ${C}`,borderRadius:"4px",color:v,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:[(0,j.jsxs)("p",{style:{margin:0,fontWeight:"bold"},children:[e.name," Downloads"]}),(0,j.jsxs)("p",{style:{margin:0},children:["Total: ",A(e.value)," (",e.percent.toFixed(1),"%)"]})]})}return null},T=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return(0,j.jsxs)("div",{style:{backgroundColor:_,padding:"8px",border:`1px solid ${C}`,borderRadius:"4px",color:v,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:[(0,j.jsx)("p",{style:{margin:0,fontWeight:"bold"},children:e.name}),(0,j.jsxs)("p",{style:{margin:0},children:["Downloads: ",A(e.Downloads)]})]})}return null},W=({columnKey:e,title:t,currentSort:o,onSort:r,style:n})=>{const l=o.key===e,i="ascending"===o.direction;return(0,j.jsx)("th",{onClick:()=>r(e),style:{...n,cursor:"pointer",padding:"12px 16px",textAlign:n.textAlign||"left",fontSize:"12px",fontWeight:"600",color:B,borderBottom:`2px solid ${C}`,textTransform:"uppercase",overflow:"hidden",textOverflow:"ellipsis"},children:(0,j.jsxs)("span",{style:{display:"flex",alignItems:"center",justifyContent:"right"===n.textAlign?"flex-end":"flex-start"},children:[t,l&&(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",viewBox:"0 0 320 512",style:{marginLeft:"4px",width:"10px",fill:i?k:w,transform:i?"rotate(180deg)":"none",transition:"transform 0.2s"},children:(0,j.jsx)("path",{d:"M182.6 137.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L128 205.3V448c0 17.7 14.3 32 32 32s32-14.3 32-32V205.3l73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128z"})}),!l&&(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",viewBox:"0 0 320 512",style:{marginLeft:"4px",width:"10px",fill:B,opacity:.5},children:(0,j.jsx)("path",{d:"M41 288h238c21.4 0 32.1 25.8 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41zm255-105L177 64c-9.4-9.4-24.6-9.4-33.9 0L24 183c-15.1 15.1-4.4 41 17 41h238c21.4 0 32.1-25.8 17-41z"})})]})})},I=({data:e})=>{const[t,o]=(0,r.useState)({key:"total",direction:"descending"}),n=(0,r.useMemo)(()=>{const o=[...e];return t.key&&o.sort((e,o)=>{let r,n;return"total"===t.key?(r=parseInt(e.total,10),n=parseInt(o.total,10)):"last_downloaded"===t.key?(r=e.last_downloaded?Date.parse(e.last_downloaded):0,n=o.last_downloaded?Date.parse(o.last_downloaded):0):(r=e[t.key],n=o[t.key]),r<n?"ascending"===t.direction?-1:1:r>n?"ascending"===t.direction?1:-1:0}),o},[e,t]),l=e=>{let r="descending";t.key===e&&"descending"===t.direction&&(r="ascending"),o({key:e,direction:r})};return(0,j.jsx)("div",{style:{overflowX:"auto",borderRadius:"12px"},children:(0,j.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed",backgroundColor:_},children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(W,{columnKey:"blueprint_id",title:"Blueprint ID",currentSort:t,onSort:l,style:{width:"50%",paddingLeft:"24px"}}),(0,j.jsx)(W,{columnKey:"blueprint_category",title:"Category",currentSort:t,onSort:l,style:{width:"20%",textAlign:"center"}}),(0,j.jsx)(W,{columnKey:"total",title:"Downloads",currentSort:t,onSort:l,style:{width:"15%",textAlign:"right"}}),(0,j.jsx)(W,{columnKey:"last_downloaded",title:"Last Downloaded",currentSort:t,onSort:l,style:{width:"15%",textAlign:"right",paddingRight:"24px"}})]})}),(0,j.jsx)("tbody",{children:n.map((e,t)=>(0,j.jsxs)("tr",{style:t%2==0?{backgroundColor:D}:{backgroundColor:z},children:[(0,j.jsx)("td",{style:{padding:"12px 16px",paddingLeft:"24px",borderBottom:`1px solid ${C}`,fontSize:"14px",color:L,wordBreak:"break-all",overflowWrap:"break-word",whiteSpace:"normal"},children:(0,j.jsx)("a",{href:`https://github.com/my-repo/blueprints/blob/main/${e.blueprint_category}/${e.blueprint_id}.yaml`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"none"},children:e.blueprint_id})}),(0,j.jsx)("td",{style:{padding:"12px 16px",borderBottom:`1px solid ${C}`,fontSize:"14px",color:v,textAlign:"center"},children:(0,j.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:"9999px",fontSize:"12px",fontWeight:"500",backgroundColor:"rgba(79, 70, 229, 0.2)",color:w},children:e.blueprint_category})}),(0,j.jsx)("td",{style:{padding:"12px 16px",borderBottom:`1px solid ${C}`,fontSize:"14px",color:v,textAlign:"right",fontFamily:"monospace"},children:A(parseInt(e.total,10))}),(0,j.jsx)("td",{style:{padding:"12px 16px",paddingRight:"24px",borderBottom:`1px solid ${C}`,fontSize:"14px",color:v,textAlign:"right"},children:e.last_downloaded?new Date(e.last_downloaded).toLocaleDateString():"N/A"})]},e.blueprint_id))})]})})},M=async e=>(console.error("Supabase client is a placeholder. Please replace 'supabase: any = {...}' with your actual Supabase client instance in the code."),{data:[],error:{message:`RPC call to ${e} failed (placeholder client).`}}),R=()=>{const[e,t]=(0,r.useState)(null),[o,k]=(0,r.useState)(!0),[D,z]=(0,r.useState)(null),L=(0,r.useCallback)(async()=>{k(!0);try{const e=await(async()=>{const[e,t,o,r]=await Promise.all([M("get_total_downloads_by_category"),M("get_top_blueprints"),M("get_daily_downloads"),M("get_total_downloads")]);if(e.error||t.error||o.error||r.error)throw console.error("Supabase RPC Error:",{category:e.error,topBlueprints:t.error,daily:o.error,total:r.error}),new Error("Failed to fetch metrics from Supabase.");return{totalDownloads:parseInt(r.data[0]?.total||"0",10),byCategory:e.data,topBlueprints:t.data,daily:o.data}})();t(e)}catch(e){console.error("Failed to fetch metrics data:",e)}finally{k(!1)}},[]);(0,r.useEffect)(()=>{L()},[L]);const W=e?.totalDownloads||0,R=(0,r.useMemo)(()=>e?e.byCategory.map(e=>{const t=parseInt(e.total,10);return{name:e.blueprint_category,value:t,percent:t/W*100}}):[],[e,W]),K=(0,r.useMemo)(()=>e?e.daily.map(e=>({label:new Date(e.day).toLocaleDateString("en-US",{month:"short",day:"numeric"}),total:parseInt(e.total,10)})):[],[e]),F=(0,r.useMemo)(()=>e?e.topBlueprints.filter(e=>!D||e.blueprint_category===D).slice(0,10).map(e=>({id:e.blueprint_id,name:e.blueprint_id.replace(/_/g," "),Downloads:parseInt(e.total,10)})).sort((e,t)=>t.Downloads-e.Downloads):[],[e,D]),E=(0,r.useMemo)(()=>e?[...e.topBlueprints].sort((e,t)=>parseInt(t.total,10)-parseInt(e.total,10)):[],[e]),P=(0,r.useMemo)(()=>(0,f.A)(b.A),[]),O=(0,r.useMemo)(()=>({backgroundColor:_,borderRadius:"12px",padding:"24px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)",marginBottom:"24px"}),[]),U=(0,r.useMemo)(()=>({...O,padding:"0",overflow:"hidden"}),[O]);return(0,j.jsx)(n.A,{title:"Metrics | Awesome HA Blueprints",description:"Download metrics for all blueprints",children:(0,j.jsxs)("main",{style:{padding:"32px",maxWidth:"1200px",margin:"0 auto",color:v,backgroundColor:S},children:[(0,j.jsx)("h1",{style:{fontSize:"32px",fontWeight:"800",marginBottom:"24px",color:v},children:"Blueprint Download Metrics"}),o||!e?(0,j.jsxs)("div",{style:{textAlign:"center",padding:"100px",color:B,fontSize:"18px"},children:[(0,j.jsx)("p",{children:"Loading metrics data from the backend..."}),(0,j.jsx)("div",{style:{display:"inline-block",width:"20px",height:"20px",border:`3px solid ${w}`,borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,j.jsx)("style",{children:"\n              @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n              }\n            "})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)("section",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"24px",marginBottom:"24px"},children:[{title:"Total Downloads",value:A(e.totalDownloads),color:"linear-gradient(135deg, #4f46e5, #6366f1)"},{title:"Tracked Blueprints",value:A(e.topBlueprints.length),color:"linear-gradient(135deg, #10b981, #34d399)"},{title:"Total Categories",value:A(e.byCategory.length),color:"linear-gradient(135deg, #f59e0b, #fbbf24)"}].map(e=>(0,j.jsxs)("div",{style:{...O,padding:"20px",textAlign:"center",background:e.color,color:"#fff"},children:[(0,j.jsx)("p",{style:{fontSize:"14px",fontWeight:"500",opacity:.9,margin:"0 0 4px 0"},children:e.title}),(0,j.jsx)("p",{style:{fontSize:"32px",fontWeight:"bold",margin:0},children:e.value})]},e.title))}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"24px",marginBottom:"24px"},children:[(0,j.jsxs)("div",{style:O,children:[(0,j.jsx)("h2",{style:{fontSize:"20px",fontWeight:"600",borderBottom:`1px solid ${C}`,paddingBottom:"16px",marginBottom:"16px"},children:"Daily Downloads Trend"}),(0,j.jsx)("div",{style:{height:"300px"},children:(0,j.jsx)(a.u,{width:"100%",height:"100%",children:(0,j.jsxs)(m.Q,{data:K,children:[(0,j.jsx)(p.d,{strokeDasharray:"3 3",stroke:C}),(0,j.jsx)(g.W,{dataKey:"label",stroke:B,fontSize:12,tickLine:!1,axisLine:!1}),(0,j.jsx)(h.h,{stroke:B,fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:e=>A(e)}),(0,j.jsx)(i.m,{contentStyle:{backgroundColor:_,border:`1px solid ${C}`},labelStyle:{color:v},formatter:e=>[A(e),"Downloads"]}),(0,j.jsx)(c.Gk,{type:"monotone",dataKey:"total",stroke:w,fill:"url(#colorUv)",name:"Downloads",strokeWidth:2}),(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:w,stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:w,stopOpacity:0})]})})]})})})]}),(0,j.jsxs)("div",{style:O,children:[(0,j.jsx)("h2",{style:{fontSize:"20px",fontWeight:"600",borderBottom:`1px solid ${C}`,paddingBottom:"16px",marginBottom:"16px"},children:"Category Distribution"}),(0,j.jsx)("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,j.jsx)(a.u,{width:"100%",height:"100%",children:(0,j.jsxs)(u.r,{children:[(0,j.jsx)(d.F,{data:R,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,children:R.map((e,t)=>(0,j.jsx)(s.f,{fill:P(e.name),onClick:()=>z(D===e.name?null:e.name),style:{cursor:"pointer"}},`cell-${t}`))}),(0,j.jsx)(i.m,{content:(0,j.jsx)($,{})}),(0,j.jsx)(l.s,{wrapperStyle:{fontSize:"12px",color:v}})]})})}),(0,j.jsx)("p",{style:{textAlign:"center",marginTop:"16px",color:B,fontSize:"14px"},children:D?`Showing Top 10 for: ${D}`:"Click a category to filter Top 10 chart below."})]})]}),(0,j.jsxs)("section",{style:O,children:[(0,j.jsxs)("h2",{style:{fontSize:"20px",fontWeight:"600",borderBottom:`1px solid ${C}`,paddingBottom:"16px",marginBottom:"16px"},children:["Top 10 Blueprints"," ",D?`(Filtered by: ${D})`:""]}),(0,j.jsx)("div",{style:{height:"350px"},children:F.length>0?(0,j.jsx)(a.u,{width:"100%",height:"100%",children:(0,j.jsxs)(y.E,{data:F,layout:"vertical",margin:{top:5,right:30,left:150,bottom:5},children:[(0,j.jsx)(p.d,{strokeDasharray:"3 3",stroke:C}),(0,j.jsx)(g.W,{type:"number",stroke:B,fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:e=>A(e)}),(0,j.jsx)(h.h,{dataKey:"name",type:"category",stroke:B,fontSize:12,tickLine:!1,axisLine:!1}),(0,j.jsx)(i.m,{content:(0,j.jsx)(T,{})}),(0,j.jsx)(l.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:v}}),(0,j.jsx)(x.y,{dataKey:"Downloads",name:"# of Downloads",fill:P(D||"top10"),barSize:20,radius:[0,4,4,0]})]})}):(0,j.jsx)("p",{style:{textAlign:"center",padding:"50px",color:B},children:"No top blueprints found for the current selection."})})]}),(0,j.jsx)("section",{style:U,children:(0,j.jsx)(I,{data:E})})]})]})})}}}]);