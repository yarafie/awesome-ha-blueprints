"use strict";(self.webpackChunkawesome_ha_blueprints_website=self.webpackChunkawesome_ha_blueprints_website||[]).push([[832],{4980:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"blueprints/automation/simple_safe_scheduler","title":"Simple Safe Scheduler","description":"A simple scheduler which executes a certain action at a given time, checking and eventually re-executing the action if the automation did not run at the expected time (e.g. due to a disruptive event).","source":"@site/docs/blueprints/automation/simple_safe_scheduler.mdx","sourceDirName":"blueprints/automation","slug":"/blueprints/automation/simple_safe_scheduler","permalink":"/awesome-ha-blueprints/docs/blueprints/automation/simple_safe_scheduler","draft":false,"unlisted":false,"editUrl":"https://github.com/EPMatt/awesome-ha-blueprints/edit/main/docs/blueprints/automation/simple_safe_scheduler.mdx","tags":[],"version":"current","frontMatter":{"title":"Simple Safe Scheduler","description":"A simple scheduler which executes a certain action at a given time, checking and eventually re-executing the action if the automation did not run at the expected time (e.g. due to a disruptive event)."}}');var a=n(4848),s=n(8453),o=n(7017);const r={title:"Simple Safe Scheduler",description:"A simple scheduler which executes a certain action at a given time, checking and eventually re-executing the action if the automation did not run at the expected time (e.g. due to a disruptive event)."},l=void 0,d={},c=[{value:"Description",id:"description",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Inputs",id:"inputs",level:2},{value:"Additional Notes",id:"additional-notes",level:2},{value:"Helper - Storage Input",id:"helper---storage-input",level:3},{value:"Advanced scheduling",id:"advanced-scheduling",level:3},{value:"Dynamic scheduling (e.g. sunrise/sunset)",id:"dynamic-scheduling-eg-sunrisesunset",level:3},{value:"Changelog",id:"changelog",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o._x,{id:"simple_safe_scheduler",category:"automation"}),"\n",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,a.jsx)(t.p,{children:"Scheduling a periodic action in Home Assistant might be trickier than what it looks at first glance. Not only the available automation triggers are limited to only time-based schedules (requiring the user to either use template triggers or install additional integrations for more complex scheduling options), but they also do not guarantee that the automation is executed at the provided time."}),"\n",(0,a.jsxs)(t.p,{children:["As an example, let's assume automation ",(0,a.jsx)(t.em,{children:"A"})," is scheduled to run at 12:00. If the Home Assistant server goes down at 11:59 due to a disruptive event (e.g. power outage, planned maintenance, hardware failure etc.) and comes back up at 12:01, the ",(0,a.jsx)(t.em,{children:"A"})," automation run scheduled for 12:00 would simply be skipped, without any warning to the user."]}),"\n",(0,a.jsx)(t.p,{children:"The Simple Safe Scheduler blueprint tries to mitigate scheduling limitations in Home Assistant by providing an easy interface to configure periodic actions, with built-in safety checks to ensure the action actually runs even in case of a disruptive event."}),"\n",(0,a.jsx)(t.p,{children:"The configured automation acts as a simple scheduler, allowing to flexibly program any kind of action based on the following parameters:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Time of the day (dynamically provided as an ",(0,a.jsx)(t.code,{children:"input_datetime"})," entity);"]}),"\n",(0,a.jsx)(t.li,{children:"Day of the week (multiple days can be selected);"}),"\n",(0,a.jsx)(t.li,{children:"Week frequency (allowing to schedule the action to run i.e. every 2 weeks)."}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"In addition, the blueprint implements useful checks to make sure that, in case of a disruptive event (e.g power outage, Home Assistant server outage etc.) happening at the scheduled automation run time, the action is executed as soon as the system restores its state. These checks can be configured to be performed both when Home Assistant boots up and when a custom event is fired (e.g. from another automation or integration). Such safety checks might be particularly important for critical automations, which need to run as close as possible to the scheduled time (e.g. watering plants, configuring an alarm system, etc.)."}),"\n",(0,a.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,a.jsxs)(o.Kg,{name:"Input Datetime Integration",required:!0,children:[(0,a.jsx)(t.p,{children:"This integration provides the entity which represents a datetime input in Home Assistant. It should be activated by default so unless you tweaked the default configuration you're good to go."}),(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://www.home-assistant.io/integrations/input_datetime/",children:"Input Datetime Docs"})})]}),"\n",(0,a.jsx)(t.h2,{id:"inputs",children:"Inputs"}),"\n",(0,a.jsx)(o.pd,{name:"Action",description:"The action which needs to be executed by this automation at the provided day and time.",selector:"action",required:!0}),"\n",(0,a.jsx)(o.pd,{name:"Helper - Storage",description:"A text helper which will be used by the automation to store information regarding the last successful run. You will need to manually create a text input entity for this, please read the blueprint Additional Notes for more info.",selector:"entity",required:!0}),"\n",(0,a.jsx)(o.pd,{name:"Run every N weeks",description:"The number of weeks between a successful run and the next one.",selector:"number"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Monday",description:"Run the action on Monday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Tuesday",description:"Run the action on Tuesday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Wednesday",description:"Run the action on Wednesday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Thursday",description:"Run the action on Thursday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Friday",description:"Run the action on Friday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Saturday",description:"Run the action on Saturday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run on Sunday",description:"Run the action on Sunday.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Run Time Entity",description:"Entity which describes the time when the action should run. Provide an entity with only time information configured (has_time: true, has_date: false).",selector:"entity",required:!0}),"\n",(0,a.jsx)(o.pd,{name:"Custom Trigger Event",description:"A custom event which can trigger the execution check (eg. a powercut event reported by external integrations).",selector:"text"}),"\n",(0,a.jsx)(o.pd,{name:"Trigger at Home Assistant startup",description:"Trigger the execution check at Home Assistant startup.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Block late execution",description:"Prevent the action to be executed too late, when a given period of time passed since the expected run time.",selector:"boolean"}),"\n",(0,a.jsx)(o.pd,{name:"Block late execution - Max elapsed time",description:"Threshold which is used to determine a late execution: if the provided amount of time passed since the expected run time and block late execution is enabled, the action will not be executed in any case.",selector:"number"}),"\n",(0,a.jsx)(t.h2,{id:"additional-notes",children:"Additional Notes"}),"\n",(0,a.jsx)(t.h3,{id:"helper---storage-input",children:"Helper - Storage Input"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"helper_storage"})," (Helper - Storage) input serves as a permanent storage area for the automation. The stored info is used to implement the blueprint's core functionality. When setting up this blueprint, manually create a new ",(0,a.jsx)(t.code,{children:"input_text"})," entity and provide it in the inputs section."]}),"\n",(0,a.jsx)(t.admonition,{type:"caution",children:(0,a.jsxs)(t.p,{children:["Make sure the text input is not altered by any other agent. The provided entity is used as a permanent storage area for just a single automation; any change to its state not carried out by the respective automation could lead to inconsistencies and unexpected behaviour. Therefore, you should create a ",(0,a.jsx)(t.strong,{children:"separate text input for each automation you're configuring with this blueprint"}),"."]})}),"\n",(0,a.jsx)(t.h3,{id:"advanced-scheduling",children:"Advanced scheduling"}),"\n",(0,a.jsx)(t.p,{children:"For more advanced scheduling options you can configure multiple automation with this blueprint, having the same action but with a different scheduling configuration.\nLet's say that you want to set up an action to run every two weeks on Monday, at 12:00 and also every week on Wednesday, at 13:00. You can setup two distinct automations with the same action and the following scheduling configuration (only scheduling-relevant inputs are provided):"}),"\n",(0,a.jsx)(t.p,{children:"Automation 1: Every two weeks, on Monday, at 12:00:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"weeks_frequency: 2\nday_monday: true\ntime_entity: input_datetime.automation_1 # its value need to be set at 12:00\n"})}),"\n",(0,a.jsx)(t.p,{children:"Automation 2: Every week, on Wednesday, at 13:00:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"weeks_frequency: 1\nday_wednesday: true\ntime_entity: input_datetime.automation_2 # its value need to be set at 13:00\n"})}),"\n",(0,a.jsx)(t.h3,{id:"dynamic-scheduling-eg-sunrisesunset",children:"Dynamic scheduling (e.g. sunrise/sunset)"}),"\n",(0,a.jsxs)(t.p,{children:["Using an ",(0,a.jsx)(t.code,{children:"input_datetime"})," entity to provide the time the automation should run allows to flexibly configure the scheduled time, without providing an hardcoded value. This can be really useful when configuring schedules based on a dynamic time of the day, such as sunrise or sunset based automations. In the latter case, you can provide an ",(0,a.jsx)(t.code,{children:"input_datetime"})," entity configured as follows:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"# input_datetime configuration\ninput_datetime:\n  automation_1:\n    name: Automation 1 Execution Time\n    has_date: false\n    has_time: true\n\n# your automations.yaml file\n- id: automation_1_datetime_update\n  # whenever you want to update the automation dynamic execution time\n  # in this case at sunset\n  trigger:\n    - platform: sun\n      event: sunset\n  action:\n    - service: input_datetime.set_datetime\n      target:\n        entity_id: input_datetime.automation_1\n      data:\n        time: \"{{ now().strftime('%H:%M:%S') }}\"\n"})}),"\n",(0,a.jsx)(t.h2,{id:"changelog",children:"Changelog"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"2021-10-22"}),": first blueprint version ","\ud83c\udf89"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},7017:(e,t,n)=>{n.d(t,{_x:()=>g,pd:()=>l,Kg:()=>h});var i=n(6540),a=n(4848);const s=function(e){let{variant:t,children:n}=e;return(0,a.jsx)("span",{className:`badge badge--${t}`,children:n})},o={action:{type:"Action"},addon:{type:"Add-on"},area:{type:"Area"},boolean:{type:"Boolean"},device:{type:"Device"},entity:{type:"Entity"},virtual:{type:"Virtual"},number:{type:"Number"},object:{type:"Object"},select:{type:"Select"},target:{type:"Target"},text:{type:"Text"},time:{type:"Time"},none:{type:"Text"}},r={inputName:{fontWeight:600},inputDescription:{fontSize:"0.9rem"}};const l=function(e){let{selector:t,required:n,name:i,description:l,deprecated:d,virtual:c}=e;const u=t?o[t]:o.none;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{style:r.inputName,children:[i," ",(0,a.jsx)(s,{variant:"primary",children:u.type})," ",n?(0,a.jsxs)(s,{variant:"warning",children:[n," Required"]}):(0,a.jsx)(s,{variant:"info",children:"Optional"})," ",c&&(0,a.jsx)(s,{variant:"secondary",children:"Virtual"}),d&&(0,a.jsx)(s,{variant:"danger",children:"Deprecated"})]}),(0,a.jsx)("br",{}),(0,a.jsx)("p",{style:r.inputDescription,className:"margin-top--sm",children:l}),(0,a.jsx)("hr",{})]})},d={requirementNameContainer:{paddingBottom:"0.8rem"},requirementName:{display:"inline"}};const c=function(e){let{name:t,required:n,children:i}=e;return(0,a.jsxs)("div",{className:"margin-bottom--lg",children:[(0,a.jsxs)("div",{style:d.requirementNameContainer,children:[(0,a.jsxs)("h3",{style:d.requirementName,children:[t," "]}),n?(0,a.jsxs)(s,{variant:"warning",children:[n," Required"]}):(0,a.jsx)(s,{variant:"info",children:"Optional"})]}),i]})};const u={zigbee2mqtt:function(e){let{required:t,refers:n,children:i}=e;return(0,a.jsxs)(c,{name:"Zigbee2MQTT Integration",required:t,children:[(0,a.jsxs)("p",{children:["If you plan to integrate the ",n," with Zigbee2MQTT, you must have this integration set up. Installation methods differ between different installation types. Check out the documentation for full details on the required hardware and how to set up Zigbee2MQTT on your system."]}),(0,a.jsx)("p",{children:i}),(0,a.jsx)("a",{href:"https://www.zigbee2mqtt.io/",children:"Zigbee2MQTT Docs"})]})},zha:function(e){let{required:t,refers:n,children:i}=e;return(0,a.jsxs)(c,{name:"ZHA Integration",required:t,children:[(0,a.jsxs)("p",{children:["If you plan to integrate the ",n," with ZHA, you must have this integration set up. The ZHA integration can be configured from the Home Assistant UI. Check the documentation for full details on the required hardware and how to set up ZHA on your system."]}),(0,a.jsx)("p",{children:i}),(0,a.jsx)("a",{href:"https://www.home-assistant.io/integrations/zha/",children:"ZHA Integration Docs"})]})},deconz:function(e){let{required:t,refers:n,children:i}=e;return(0,a.jsxs)(c,{name:"deCONZ Integration",required:t,children:[(0,a.jsxs)("p",{children:["If you plan to integrate the ",n," with deCONZ, you must have this integration set up. The deCONZ integration can be configured from the Home Assistant UI and requires an additional container to run deCONZ on. Head over to the documentation for full details on the required hardware and how to set up deCONZ on your system."]}),(0,a.jsx)("p",{children:i}),(0,a.jsx)("a",{href:"https://www.home-assistant.io/integrations/deconz/",children:"deCONZ Integration Docs"})]})},controller:function(e){let{required:t,children:n}=e;return(0,a.jsxs)(c,{name:"Controller Automation",required:t,children:[(0,a.jsxs)("p",{children:["To use this blueprint you need to first create an automation with a Controller blueprint. You can then create an automation with this Hook,"," ",(0,a.jsx)("b",{children:"making sure that you provide the same controller device used in the corresponding Controller blueprint"}),". This key step will link the two automations and ensure the Hook will respond to events fired by the Controller."]}),(0,a.jsx)("p",{children:n}),(0,a.jsx)("a",{href:"#supported-controllers",children:"List of Supported Controllers"})," -"," ",(0,a.jsx)("a",{href:"https://epmatt.github.io/awesome-ha-blueprints/blueprints/controllers",children:"Controllers Docs"})]})}};const h=function(e){let{id:t,required:n,name:i,refers:s,children:o}=e;const r=t?u[t]:c;return(0,a.jsx)(r,{name:i,required:n,refers:s,children:o})};var p=n(6447);const m={myHomeAssistantImage:{width:"100%",maxWidth:212}};const g=function(e){let{category:t,id:n}=e;const[s,o]=(0,i.useState)(!1),r=`https://github.com/EPMatt/awesome-ha-blueprints/blob/main/blueprints/${t}/${n}/${n}.yaml`;return(0,a.jsxs)("div",{className:"card item shadow--md",children:[(0,a.jsx)("div",{className:"card__header margin-bottom--md",children:(0,a.jsx)("h3",{children:"Import this blueprint"})}),(0,a.jsx)("div",{className:"card__body",children:(0,a.jsxs)("div",{className:"row row--no-gutters",children:[(0,a.jsxs)("div",{className:"col col--6",children:[(0,a.jsx)("h5",{children:"My Home Assistant"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("a",{href:`https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=${escape(r)}`,target:"_blank",rel:"noreferrer",children:(0,a.jsx)("img",{src:"https://my.home-assistant.io/badges/blueprint_import.svg",alt:"Open your Home Assistant instance and show the blueprint import dialog with a specific blueprint pre-filled.",style:m.myHomeAssistantImage})}),(0,a.jsx)("br",{}),(0,a.jsx)("small",{children:"(Home Assistant 2024.10.0 or higher)"})]})]}),(0,a.jsxs)("div",{className:"col col--6",children:[(0,a.jsx)("h5",{children:"Direct Link"}),(0,a.jsx)("button",{type:"button",className:"button button--"+(s?"success":"primary"),onClick:async()=>{await navigator.clipboard.writeText(r),o(!0)},children:(0,a.jsxs)("span",{children:[(0,a.jsx)(p.A,{size:16}),(0,a.jsxs)("span",{children:[" ",s?"Link Copied!":"Copy Link"]})]})})]})]})})]})}},6447:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(6540),a=n(5556),s=n.n(a),o=["color","size","title","className"];function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r.apply(null,arguments)}var l=(0,i.forwardRef)((function(e,t){var n=e.color,a=void 0===n?"currentColor":n,s=e.size,l=void 0===s?"1em":s,d=e.title,c=void 0===d?null:d,u=e.className,h=void 0===u?"":u,p=function(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,o);return i.createElement("svg",r({ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:l,height:l,fill:a,className:["bi","bi-clipboard-plus",h].filter(Boolean).join(" ")},p),c?i.createElement("title",null,c):null,i.createElement("path",{fillRule:"evenodd",d:"M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7"}),i.createElement("path",{d:"M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1z"}),i.createElement("path",{d:"M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0z"}))}));l.propTypes={color:s().string,size:s().oneOfType([s().string,s().number]),title:s().string,className:s().string};const d=l},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(6540);const a={},s=i.createContext(a);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);