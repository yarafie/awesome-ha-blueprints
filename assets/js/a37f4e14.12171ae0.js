"use strict";(globalThis.webpackChunkawesome_ha_blueprints_website=globalThis.webpackChunkawesome_ha_blueprints_website||[]).push([[898],{2710:(t,e,r)=>{r.r(e),r.d(e,{default:()=>w});var o=r(3303),a=r(1153),i=r(6285),n=r(4538),l=r(162),s=r(656),d=r(351),c=r(6605),h=r(9441),p=r(2782),y=r(7342),g=r(2941),x=r(2454),m=r(7263),u=r(50),b=r(1929),f=r(1778),j=r(7711);const w=()=>{const[t,e]=(0,o.useState)({loading:!0,error:void 0,totalDownloads:0,byCategory:[],topBlueprints:[],daily:[]}),[r,w]=(0,o.useState)(!1),{loading:S,error:v,totalDownloads:_,byCategory:k,topBlueprints:D,daily:T}=t,B=(0,b.A)(f.A);(0,o.useEffect)(()=>{const t=()=>{const t=document.documentElement.getAttribute("data-theme");w("dark"===t)};t();const e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"data-theme"===e.attributeName&&t()})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,o.useEffect)(()=>{const t=window?.env?.SUPABASE_URL,r=window?.env?.SUPABASE_ANON_KEY;if(!t||!r){const t=1234567,r=[{blueprint_category:"controllers",total:"900000"},{blueprint_category:"hooks",total:"280000"},{blueprint_category:"templates",total:"54000"}],o=[{blueprint_category:"hooks",blueprint_id:"thertetsat_controlv2_30_days_ago",total:"50000"},{blueprint_category:"hooks",blueprint_id:"rgb_light_cycle",total:"45000"},{blueprint_category:"controllers",blueprint_id:"motion_automation",total:"40000"}],a=[{day:new Date(Date.now()-432e6).toISOString().split("T")[0],total:"10"},{day:new Date(Date.now()-3456e5).toISOString().split("T")[0],total:"12"},{day:new Date(Date.now()-2592e5).toISOString().split("T")[0],total:"15"},{day:new Date(Date.now()-1728e5).toISOString().split("T")[0],total:"20"},{day:new Date(Date.now()-864e5).toISOString().split("T")[0],total:"18"},{day:(new Date).toISOString().split("T")[0],total:"22"}].map(t=>({label:new Date(t.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(t.total)})).sort((t,e)=>new Date(t.label).getTime()-new Date(e.label).getTime());return void e(e=>({...e,loading:!1,error:"Supabase variables missing. Showing mock data.",totalDownloads:t,byCategory:r,topBlueprints:o,daily:a}))}const o={"Content-Type":"application/json",apikey:r,Authorization:"Bearer "+r},a=async(t,e,r=3)=>{for(let o=0;o<r;o++)try{const a=await fetch(t,e);if(a.ok)return a;if(429===a.status&&o<r-1){const t=1e3*Math.pow(2,o)+1e3*Math.random();await new Promise(e=>setTimeout(e,t));continue}{const t=await a.text();throw new Error(`HTTP error! Status: ${a.status}. Response: ${t.substring(0,100)}...`)}}catch(v){if(o===r-1)throw v}};!async function(){try{const[r,i,n,l]=await Promise.all([a(`${t}/rest/v1/rpc/get_total_downloads`,{method:"POST",headers:o,body:JSON.stringify({})}),a(`${t}/rest/v1/rpc/get_downloads_by_category`,{method:"POST",headers:o,body:JSON.stringify({})}),a(`${t}/rest/v1/rpc/get_top_blueprints`,{method:"POST",headers:o,body:JSON.stringify({})}),a(`${t}/rest/v1/rpc/get_daily_downloads`,{method:"POST",headers:o,body:JSON.stringify({p_days:30})})]),s=await r.json(),d=await i.json(),c=await n.json(),h=await l.json();let p=0;Array.isArray(s)&&s.length>0?p=Number(s[0].total):"number"==typeof s&&(p=s);const y=Array.isArray(d)?d:[],g=Array.isArray(c)?c:[],x=Array.isArray(h)?h.map(t=>({label:new Date(t.day).toLocaleDateString(void 0,{month:"short",day:"numeric"}),total:Number(t.total)})).sort((t,e)=>{const r=new Date(t.label),o=new Date(e.label);return r.getTime()-o.getTime()}):[];e({loading:!1,error:void 0,totalDownloads:p,byCategory:y,topBlueprints:g,daily:x})}catch(r){console.error("Error fetching download metrics",r),e(t=>({...t,loading:!1,error:`Failed to load metrics from Supabase. Error: ${r.message||"Unknown error."}`}))}}()},[]);const A=t=>t.toLocaleString(),O=k.map(t=>({name:t.blueprint_category,category:t.blueprint_category,value:Number(t.total),total:Number(t.total),label:t.blueprint_category})),C=D.slice(0,10).map(t=>({id:t.blueprint_id,name:t.blueprint_id.length>40?t.blueprint_id.substring(0,37)+"...":t.blueprint_id,value:Number(t.total)})).reverse(),N={bg:r?"#1b1b1d":"#f9fafb",cardBg:r?"#242526":"#ffffff",textPrimary:r?"#e5e7eb":"#1f2937",textSecondary:r?"#9ca3af":"#6b7280",gridLine:r?"#444":"#e5e7eb",tooltipBg:r?"#242526":"#ffffff",tooltipBorder:r?"#444":"#ccc",tooltipText:r?"#e5e7eb":"#333"},P=({active:t,payload:e,label:r})=>{if(t&&e&&e.length){const t=e[0].payload;return(0,j.jsxs)("div",{style:{padding:"10px",backgroundColor:N.tooltipBg,border:`1px solid ${N.tooltipBorder}`,borderRadius:"5px",color:N.tooltipText},children:[(0,j.jsx)("p",{style:{fontWeight:"bold",marginBottom:"5px"},children:t.name||t.id||r}),(0,j.jsxs)("p",{children:["Downloads: ",A(t.value||e[0].value)]})]})}return null},z=t=>{const{x:e,y:r,payload:o}=t;return(0,j.jsx)("g",{transform:`translate(${e},${r})`,children:(0,j.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:N.textSecondary,fontSize:10,title:o.value,children:o.value})})},E={backgroundColor:N.cardBg,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",overflow:"hidden",color:N.textPrimary,minWidth:"0",border:r?"1px solid #333":"none"},$=t=>({backgroundColor:t,color:"white",padding:"12px",fontWeight:"bold",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.05em"}),L={padding:"24px",textAlign:"center"},W={padding:"16px",borderBottom:`1px solid ${N.gridLine}`,margin:0,fontSize:"1.25rem",color:N.textPrimary,fontWeight:"bold"};return(0,j.jsx)(a.A,{title:"Blueprint Download Metrics",description:"Enhanced Metrics Dashboard",children:(0,j.jsxs)("main",{className:"container margin-vert--lg",style:{backgroundColor:N.bg,transition:"background-color 0.3s ease",minHeight:"100vh",padding:"2rem"},children:[(0,j.jsx)("h1",{style:{textAlign:"center",marginBottom:"32px",fontSize:"2rem",fontWeight:"bold",color:N.textPrimary},children:"Blueprint Metrics Dashboard"}),S&&(0,j.jsx)("div",{style:{textAlign:"center",color:N.textPrimary},children:"Loading metrics..."}),!S&&v&&(0,j.jsxs)("div",{className:"alert alert--danger",role:"alert",children:[(0,j.jsx)("h4",{className:"alert__heading",children:"Error loading metrics"}),(0,j.jsx)("p",{children:v})]}),!S&&!v&&(0,j.jsxs)("div",{style:{width:"100%",overflowX:"auto"},children:[(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:E,children:[(0,j.jsx)("div",{style:$("#4f46e5"),children:"Total Downloads"}),(0,j.jsx)("div",{style:L,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#4f46e5",margin:0},children:A(_)})})]}),(0,j.jsxs)("div",{style:E,children:[(0,j.jsx)("div",{style:$("#0d9488"),children:"Unique Categories"}),(0,j.jsx)("div",{style:L,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#0d9488",margin:0},children:A(k.length)})})]}),(0,j.jsxs)("div",{style:E,children:[(0,j.jsx)("div",{style:$("#9333ea"),children:"Tracked Blueprints"}),(0,j.jsx)("div",{style:L,children:(0,j.jsx)("p",{style:{fontSize:"2.5rem",fontWeight:"900",color:"#9333ea",margin:0},children:A(D.length)})})]})]}),(0,j.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"32px",width:"100%"},children:[(0,j.jsxs)("div",{style:E,children:[(0,j.jsx)("h3",{style:W,children:"Daily Downloads"}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(u.Q,{data:T,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"colorTotal",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"5%",stopColor:"#4f46e5",stopOpacity:.8}),(0,j.jsx)("stop",{offset:"95%",stopColor:"#4f46e5",stopOpacity:0})]})}),(0,j.jsx)(c.d,{strokeDasharray:"3 3",stroke:N.gridLine,vertical:!1}),(0,j.jsx)(y.W,{dataKey:"label",stroke:N.textSecondary,tick:{fontSize:10,fill:N.textSecondary}}),(0,j.jsx)(g.h,{allowDecimals:!1,stroke:N.textSecondary,tick:{fontSize:10,fill:N.textSecondary},tickFormatter:A}),(0,j.jsx)(n.m,{content:(0,j.jsx)(P,{})}),(0,j.jsx)(h.Gk,{type:"monotone",dataKey:"total",stroke:"#4f46e5",strokeWidth:3,fill:"url(#colorTotal)"})]})})})]}),(0,j.jsxs)("div",{style:E,children:[(0,j.jsx)("h3",{style:W,children:"Category Distribution"}),(0,j.jsx)("div",{style:{height:"350px",padding:"10px"},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(m.r,{children:[(0,j.jsx)(d.F,{data:O,dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:3,fill:"#8884d8",labelLine:!1,label:({percent:t})=>`${(100*t).toFixed(0)}%`,children:O.map((t,e)=>(0,j.jsx)(s.f,{fill:B(t.category),stroke:r?"#242526":"#fff"},`cell-${e}`))}),(0,j.jsx)(n.m,{content:(0,j.jsx)(P,{})}),(0,j.jsx)(i.s,{iconType:"circle",wrapperStyle:{fontSize:"12px",color:N.textPrimary}})]})})})]})]}),(0,j.jsxs)("section",{style:{...E,paddingBottom:"20px"},children:[(0,j.jsx)("h3",{style:{...W,marginBottom:"20px",borderBottom:"none"},children:"Top 10 Blueprints"}),(0,j.jsx)("div",{style:{height:Math.max(400,40*C.length)},children:(0,j.jsx)(l.u,{width:"100%",height:"100%",children:(0,j.jsxs)(x.E,{data:C,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,j.jsx)(c.d,{strokeDasharray:"3 3",horizontal:!1,stroke:N.gridLine}),(0,j.jsx)(y.W,{type:"number",stroke:N.textSecondary,tick:{fontSize:10,fill:N.textSecondary},tickFormatter:A}),(0,j.jsx)(g.h,{dataKey:"name",type:"category",width:100,tickLine:!1,axisLine:!1,tick:(0,j.jsx)(z,{})}),(0,j.jsx)(n.m,{content:(0,j.jsx)(P,{})}),(0,j.jsx)(p.y,{dataKey:"value",fill:B("top10"),barSize:20,radius:[0,4,4,0]})]})})})]})]})]})})}}}]);