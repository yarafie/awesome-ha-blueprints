# Blueprint Metadata
blueprint:
  name: Controller - IKEA E2489 BILRESA remote control with buttons
  description: |
    # Controller - IKEA E2489 BILRESA remote control with buttons

    â„¹ï¸ Version 2026.02.22

    Controller automation for executing any kind of action triggered by the provided IKEA E2489 BILRESA remote control with buttons.
    Allows to optionally loop an action on a button long press.
    Supports Zigbee2MQTT.

    Automations created with this blueprint can be connected with one or more [Hooks](https://yarafie.github.io/awesome-ha-blueprints/docs/blueprints/hooks) supported by this controller.
    Hooks allow to easily create controller-based automations for interacting with lights, covers, media players, and potentially more.
    See the list of [Hooks available for this controller](https://yarafie.github.io/awesome-ha-blueprints/docs/blueprints/controllers/ikea_e2489/EPMatt/awesome/2026.02.22#available-hooks) for additional details.

    ## More Info

    ðŸ“ [Changelog](https://yarafie.github.io/awesome-ha-blueprints/docs/blueprints/controllers/ikea_e2489/EPMatt/awesome/2026.02.22#changelog)
    ðŸ“• Full documentation regarding this blueprint is available [here](https://yarafie.github.io/awesome-ha-blueprints/docs/blueprints/controllers/ikea_e2489).

    ðŸš€ This blueprint is part of the **[Awesome HA Blueprints](https://yarafie.github.io/awesome-ha-blueprints) project**. Please consider **[leaving a star on GitHub](https://github.com/yarafie/awesome-ha-blueprints)**! ðŸŒŸ

  source_url: https://github.com/yarafie/awesome-ha-blueprints/blob/main/blueprints/controllers/ikea_e2489/EPMatt/awesome/2026.02.22/ikea_e2489.yaml
  domain: automation
  homeassistant:
    min_version: 2024.10.0
  # Device Selector
  input:
    controller_device:
      name: (Zigbee2MQTT, ZHA, deCONZ Required) Controller Device
      description: The controller device to use for the automation. Choose a value only if the remote is integrated with Zigbee2MQTT, ZHA, deCONZ.
      default: ''
      selector:
        device:
          filter:
            # source: https://www.zigbee2mqtt.io/devices/E2489.html#ikea-e2489
            - integration: mqtt
              manufacturer: IKEA
              model: BILRESA remote control with buttons
          multiple: false
    # inputs for custom actions
    action_button_up_short:
      name: (Optional) Up button short press
      description: Action to run on short up button press.
      default: []
      selector:
        action:
    action_button_up_long:
      name: (Optional) Up button long press
      description: Action to run on long up button press.
      default: []
      selector:
        action:
    action_button_up_release:
      name: (Optional) Up button release
      description: Action to run on up button release after long press.
      default: []
      selector:
        action:
    action_button_up_double:
      name: (Optional) Up button double press
      description: Action to run on double up button press.
      default: []
      selector:
        action:
    action_button_down_short:
      name: (Optional) Down button short press
      description: Action to run on short down button press.
      default: []
      selector:
        action:
    action_button_down_long:
      name: (Optional) Down button long press
      description: Action to run on long down button press.
      default: []
      selector:
        action:
    action_button_down_release:
      name: (Optional) Down button release
      description: Action to run on down button release after long press.
      default: []
      selector:
        action:
    action_button_down_double:
      name: (Optional) Down button double press
      description: Action to run on double down button press.
      default: []
      selector:
        action:
    # inputs for looping custom actions on long button press events until the corresponding release event is received
    long_press_options_section:
      name: Long Press options
      icon: mdi:remote
      collapsed: true
      input:
        button_up_long_max_loop_repeats:
          name: (Optional) Up button long press - Maximum loop repeats
          description: >-
            Maximum number of repeats for the custom action, when looping is enabled.
            Use it as a safety limit to prevent an endless loop in case the corresponding stop event is not received.
          default: 20
          selector:
            number:
              min: 1.0
              max: 1000.0
              mode: slider
              step: 1.0
        button_down_long_max_loop_repeats:
          name: (Optional) Down button long press - Maximum loop repeats
          description: >-
            Maximum number of repeats for the custom action, when looping is enabled.
            Use it as a safety limit to prevent an endless loop in case the corresponding stop event is not received.
          default: 20
          selector:
            number:
              min: 1.0
              max: 1000.0
              mode: slider
              step: 1.0
        helper_long_press_delay:
          name: (Optional) Helper - Long Press delay
          description: Max delay between the pushing and releasing of a button long press event. Increase this value if you notice that the long press action is not triggered properly.
          default: 250
          selector:
            number:
              min: 100.0
              max: 5000.0
              unit_of_measurement: milliseconds
              mode: box
              step: 10.0
#
# Automation schema
variables:
  # Controller ID
  controller_id: !input controller_device
  # integration id used to select items in the action mapping
  # integration type is set from trigger.id
  integration_id: '{{ trigger.id.split("-")[0] }}'
  # convert input tags to variables, to be used in templates
  # Button Inputs For Loop
  helper_long_press_delay: !input helper_long_press_delay
  button_up_long_max_loop_repeats: !input button_up_long_max_loop_repeats
  button_down_long_max_loop_repeats: !input button_down_long_max_loop_repeats
  # mapping between actions and integrations
  actions_mapping:
    z2m:
      # source: https://www.zigbee2mqtt.io/devices/E2489.html
      button_up_short: ['on']
      button_up_long: [brightness_move_up]
      button_up_release: [brightness_stop]
      button_up_double: [on_double]
      button_down_short: ['off']
      button_down_long: [brightness_move_down]
      button_down_release: [brightness_stop]
      button_double_double: [off_double]
  # pre-choose actions for buttons based on configured integration
  # mainly used to pass to hooks through ahb_controller_event
  button_up_short: '{{ actions_mapping[integration_id]["button_up_short"] }}'
  button_up_long: '{{ actions_mapping[integration_id]["button_up_long"] }}'
  button_up_release: '{{ actions_mapping[integration_id]["button_up_release"] }}'
  button_up_double: '{{ actions_mapping[integration_id]["button_up_double"] }}'
  button_down_short: '{{ actions_mapping[integration_id]["button_down_short"] }}'
  button_down_long: '{{ actions_mapping[integration_id]["button_down_long"] }}'
  button_down_release: '{{ actions_mapping[integration_id]["button_down_release"] }}'
  button_down_double: '{{ actions_mapping[integration_id]["button_down_double"] }}'
#
# Mode Block
mode: single
max_exceeded: silent
#
# Triggers Block
triggers:
  # triggers for zigbee2mqtt
  # Up Button
  - trigger: device
    id: z2m-button-up-short
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: 'on'
  - trigger: device
    id: z2m-button-up-long
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: brightness_move_up
  - trigger: device
    id: z2m-button-up-release
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: brightness_stop
  - trigger: device
    id: z2m-button-up-double
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: on_double
  # Down Button
  - trigger: device
    id: z2m-button-down-short
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: 'off'
  - trigger: device
    id: z2m-button-down-long
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: brightness_move_down
  - trigger: device
    id: z2m-button-down-release
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: brightness_stop
  - trigger: device
    id: z2m-button-down-double
    domain: mqtt
    device_id: !input controller_device
    type: action
    subtype: off_double
#
# Conditions Block
conditions:
  - condition: and
    conditions:
      # check that the button event is not empty
      - >-
        {%- set trigger_action -%}
        {%- if integration_id == "z2m" -%}
        {{ trigger.payload }}
        {%- elif integration_id == "zha" -%}
        {{ trigger.event.data.command }}{{"_" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join("_") }}
        {%- elif integration_id == "dcz" -%}
        {{ trigger.event.data.event }}
        {%- endif -%}
        {%- endset -%}
        {{ trigger_action not in ["","None","unknown"] }}
#
# Actions Block
actions:
  #
  # choose the sequence to run based on the received button event
  - choose:
      #
      # Actions for Up Button single press
      - conditions:
          - condition: trigger
            id:
              - z2m-button-up-short
        sequence:
          # fire the ahb hook event
          - event: ahb_controller_event
            event_data:
              controller: '{{ controller_id }}'
              action: button_up_short
          # run the custom action
          - choose:
              - conditions: []
                sequence: !input action_button_up_short
      #
      # Actions for Down Button single press
      - conditions:
          - condition: trigger
            id:
              - z2m-button-down-short
        sequence:
          # fire the ahb hook event
          - event: ahb_controller_event
            event_data:
              controller: '{{ controller_id }}'
              action: button_down_short
          # run the custom action
          - choose:
              - conditions: []
                sequence: !input action_button_down_short
      #
      # Actions for Button Up Long Press
      - conditions:
          - condition: trigger
            id:
              - z2m-button-up-long
        sequence:
          # Repeat the Long Press Actions for the set number of loops
          - repeat:
              count: !input button_up_long_max_loop_repeats
              sequence:
                - parallel:
                    - event: ahb_controller_event
                      event_data:
                        controller: '{{ controller_id }}'
                        action: button_up_long
                    - sequence:
                        - choose:
                            - conditions: []
                              sequence: !input action_button_up_long
                    - sequence:
                        - choose:
                            # Wait for z2m/zha/dcz triggers for Button Long Press Release to stop looping
                            - conditions: []
                              sequence:
                                - wait_for_trigger:
                                    - trigger: device
                                      domain: mqtt
                                      device_id: !input controller_device
                                      type: action
                                      subtype: brightness_stop
                                  timeout:
                                    milliseconds: !input helper_long_press_delay
                                  continue_on_timeout: true
                                # If a Button Long Release is triggered wait.trigger.idx will be defined stop the loop before long_max_loop_repeats
                                - if:
                                    - condition: template
                                      value_template: '{{ wait.trigger.idx is defined }}'
                                  then:
                                    # fire the event
                                    - event: ahb_controller_event
                                      event_data:
                                        controller: '{{ controller_id }}'
                                        action: button_up_release
                                    # run the custom action
                                    - choose:
                                        - conditions: []
                                          sequence: !input action_button_up_release
                                    # Stop the repeat loop
                                    - stop: button_up_released
      #
      # Actions for Button Down Long Press
      - conditions:
          - condition: trigger
            id:
              - z2m-button-down-long
        sequence:
          # Repeat the Long Press Actions for the set number of loops
          - repeat:
              count: !input button_down_long_max_loop_repeats
              sequence:
                - parallel:
                    - event: ahb_controller_event
                      event_data:
                        controller: '{{ controller_id }}'
                        action: button_down_long
                    - sequence:
                        - choose:
                            - conditions: []
                              sequence: !input action_button_down_long
                    - sequence:
                        - choose:
                            # Wait for z2m/zha/dcz triggers for Button Long Press Release to stop looping
                            - conditions: []
                              sequence:
                                - wait_for_trigger:
                                    - trigger: device
                                      domain: mqtt
                                      device_id: !input controller_device
                                      type: action
                                      subtype: brightness_stop
                                  timeout:
                                    milliseconds: !input helper_long_press_delay
                                  continue_on_timeout: true
                                # If a Button Long Release is triggered wait.trigger.idx will be defined stop the loop before long_max_loop_repeats
                                - if:
                                    - condition: template
                                      value_template: '{{ wait.trigger.idx is defined }}'
                                  then:
                                    # fire the event
                                    - event: ahb_controller_event
                                      event_data:
                                        controller: '{{ controller_id }}'
                                        action: button_down_release
                                    # run the custom action
                                    - choose:
                                        - conditions: []
                                          sequence: !input action_button_down_release
                                    # Stop the repeat loop
                                    - stop: button_down_released
      #
      # Actions for Up Button double press
      - conditions:
          - condition: trigger
            id:
              - z2m-button-dots1-double
        sequence:
          # fire the ahb hook event
          - event: ahb_controller_event
            event_data:
              controller: '{{ controller_id }}'
              action: button_up_double
          # run the custom action
          - choose:
              - conditions: []
                sequence: !input action_button_up_double
      #
      # Actions for Down Button double press
      - conditions:
          - condition: trigger
            id:
              - z2m-button-down-double
        sequence:
          # fire the ahb hook event
          - event: ahb_controller_event
            event_data:
              controller: '{{ controller_id }}'
              action: button_down_double
          # run the custom action
          - choose:
              - conditions: []
                sequence: !input action_button_down_double
